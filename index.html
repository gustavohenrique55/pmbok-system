<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMBOK 7 Manager Pro - Sistema Completo de Gestão de Projetos</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .notification-enter {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const PMBOKManagerPro = () => {
            // Estados principais
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [showLogin, setShowLogin] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [darkMode, setDarkMode] = useState(false);
            const [activeView, setActiveView] = useState('dashboard');
            const [projects, setProjects] = useState([]);
            const [activeProject, setActiveProject] = useState(null);
            const [showModal, setShowModal] = useState(null);
            const [editingItem, setEditingItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [language, setLanguage] = useState('pt');

            // Estados para artefatos PMBOK
            const [projectCharters, setProjectCharters] = useState([]);
            const [stakeholders, setStakeholders] = useState([]);
            const [risks, setRisks] = useState([]);
            const [wbs, setWbs] = useState([]);
            const [changes, setChanges] = useState([]);
            const [lessons, setLessons] = useState([]);
            const [deliverables, setDeliverables] = useState([]);
            const [qualityMetrics, setQualityMetrics] = useState([]);
            const [communications, setCommunications] = useState([]);
            const [resources, setResources] = useState([]);
            const [tasks, setTasks] = useState([]);

            // Traduções
            const translations = {
                pt: {
                    welcome: "Bem-vindo",
                    dashboard: "Dashboard",
                    projects: "Projetos",
                    logout: "Sair",
                    exportPdf: "Exportar PDF",
                    notifications: "Notificações",
                    settings: "Configurações",
                    newProject: "Novo Projeto",
                    projectName: "Nome do Projeto",
                    description: "Descrição",
                    startDate: "Data Início",
                    endDate: "Data Fim",
                    budget: "Orçamento",
                    save: "Salvar",
                    cancel: "Cancelar",
                    delete: "Deletar",
                    edit: "Editar",
                    status: "Status",
                    active: "Ativo",
                    completed: "Concluído",
                    onHold: "Pausado",
                    planning: "Planejamento"
                },
                en: {
                    welcome: "Welcome",
                    dashboard: "Dashboard",
                    projects: "Projects",
                    logout: "Logout",
                    exportPdf: "Export PDF",
                    notifications: "Notifications",
                    settings: "Settings",
                    newProject: "New Project",
                    projectName: "Project Name",
                    description: "Description",
                    startDate: "Start Date",
                    endDate: "End Date",
                    budget: "Budget",
                    save: "Save",
                    cancel: "Cancel",
                    delete: "Delete",
                    edit: "Edit",
                    status: "Status",
                    active: "Active",
                    completed: "Completed",
                    onHold: "On Hold",
                    planning: "Planning"
                }
            };

            const t = (key) => translations[language][key] || key;

            // Carregar dados do localStorage
            useEffect(() => {
                const loadData = () => {
                    try {
                        const savedUsers = localStorage.getItem('pmbok_users');
                        if (savedUsers) setUsers(JSON.parse(savedUsers));
                        
                        const savedProjects = localStorage.getItem('pmbok_projects');
                        if (savedProjects) setProjects(JSON.parse(savedProjects));
                        
                        const savedCharters = localStorage.getItem('pmbok_charters');
                        if (savedCharters) setProjectCharters(JSON.parse(savedCharters));
                        
                        const savedStakeholders = localStorage.getItem('pmbok_stakeholders');
                        if (savedStakeholders) setStakeholders(JSON.parse(savedStakeholders));
                        
                        const savedRisks = localStorage.getItem('pmbok_risks');
                        if (savedRisks) setRisks(JSON.parse(savedRisks));
                        
                        const savedDarkMode = localStorage.getItem('pmbok_darkMode');
                        if (savedDarkMode) setDarkMode(JSON.parse(savedDarkMode));
                        
                        const savedLanguage = localStorage.getItem('pmbok_language');
                        if (savedLanguage) setLanguage(savedLanguage);
                        
                        const savedTasks = localStorage.getItem('pmbok_tasks');
                        if (savedTasks) setTasks(JSON.parse(savedTasks));
                        
                        // Check for logged in user
                        const loggedUser = localStorage.getItem('pmbok_currentUser');
                        if (loggedUser) {
                            setCurrentUser(JSON.parse(loggedUser));
                            setIsLoggedIn(true);
                            setShowLogin(false);
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                    }
                };
                loadData();
            }, []);

            // Salvar dados no localStorage
            useEffect(() => {
                if (users.length > 0) {
                    localStorage.setItem('pmbok_users', JSON.stringify(users));
                }
            }, [users]);

            useEffect(() => {
                localStorage.setItem('pmbok_projects', JSON.stringify(projects));
            }, [projects]);

            useEffect(() => {
                localStorage.setItem('pmbok_charters', JSON.stringify(projectCharters));
            }, [projectCharters]);

            useEffect(() => {
                localStorage.setItem('pmbok_stakeholders', JSON.stringify(stakeholders));
            }, [stakeholders]);

            useEffect(() => {
                localStorage.setItem('pmbok_risks', JSON.stringify(risks));
            }, [risks]);

            useEffect(() => {
                localStorage.setItem('pmbok_tasks', JSON.stringify(tasks));
            }, [tasks]);

            useEffect(() => {
                localStorage.setItem('pmbok_darkMode', JSON.stringify(darkMode));
            }, [darkMode]);

            useEffect(() => {
                localStorage.setItem('pmbok_language', language);
            }, [language]);

            // Sistema de Notificações
            const addNotification = (type, title, message) => {
                const notification = {
                    id: Date.now(),
                    type,
                    title,
                    message,
                    timestamp: new Date().toISOString()
                };
                setNotifications(prev => [...prev, notification]);
                
                // Auto remove após 5 segundos
                setTimeout(() => {
                    removeNotification(notification.id);
                }, 5000);
            };

            const removeNotification = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            // Verificar tarefas vencendo
            useEffect(() => {
                if (isLoggedIn && tasks.length > 0) {
                    const checkDeadlines = () => {
                        const today = new Date();
                        const tomorrow = new Date(today);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        
                        tasks.forEach(task => {
                            if (task.dueDate) {
                                const dueDate = new Date(task.dueDate);
                                const diffTime = dueDate - today;
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                
                                if (diffDays === 1) {
                                    addNotification('warning', 'Tarefa Vencendo', `${task.title} vence amanhã!`);
                                } else if (diffDays === 0) {
                                    addNotification('error', 'Tarefa Vence Hoje', `${task.title} vence hoje!`);
                                } else if (diffDays < 0 && task.status !== 'done') {
                                    addNotification('error', 'Tarefa Atrasada', `${task.title} está atrasada!`);
                                }
                            }
                        });
                    };
                    
                    checkDeadlines();
                    const interval = setInterval(checkDeadlines, 3600000); // Check every hour
                    return () => clearInterval(interval);
                }
            }, [isLoggedIn, tasks]);

            // Componente de Login/Registro
            const LoginSystem = () => {
                const [isRegister, setIsRegister] = useState(false);
                const [formData, setFormData] = useState({
                    email: '',
                    password: '',
                    name: '',
                    company: '',
                    role: ''
                });

                const handleLogin = (e) => {
                    e.preventDefault();
                    const user = users.find(u => u.email === formData.email && u.password === formData.password);
                    
                    if (user) {
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                        setShowLogin(false);
                        localStorage.setItem('pmbok_currentUser', JSON.stringify(user));
                        addNotification('success', 'Login Realizado', `Bem-vindo de volta, ${user.name}!`);
                    } else {
                        addNotification('error', 'Erro no Login', 'Email ou senha incorretos');
                    }
                };

                const handleRegister = (e) => {
                    e.preventDefault();
                    const newUser = {
                        id: Date.now(),
                        ...formData,
                        createdAt: new Date().toISOString()
                    };
                    
                    setUsers(prev => [...prev, newUser]);
                    setCurrentUser(newUser);
                    setIsLoggedIn(true);
                    setShowLogin(false);
                    localStorage.setItem('pmbok_currentUser', JSON.stringify(newUser));
                    addNotification('success', 'Conta Criada', 'Bem-vindo ao PMBOK Manager Pro!');
                };

                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800">PMBOK 7 Manager Pro</h1>
                                <p className="text-gray-600 mt-2">Sistema Profissional de Gestão de Projetos</p>
                            </div>
                            
                            <form onSubmit={isRegister ? handleRegister : handleLogin}>
                                {isRegister && (
                                    <>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Nome Completo</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                required
                                                value={formData.name}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Empresa</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                value={formData.company}
                                                onChange={(e) => setFormData({...formData, company: e.target.value})}
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Cargo</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                value={formData.role}
                                                onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            />
                                        </div>
                                    </>
                                )}
                                
                                <div className="mb-4">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">Email</label>
                                    <input
                                        type="email"
                                        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                        required
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    />
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                                    <input
                                        type="password"
                                        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                        required
                                        value={formData.password}
                                        onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    />
                                </div>
                                
                                <button
                                    type="submit"
                                    className="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300"
                                >
                                    {isRegister ? 'Criar Conta' : 'Entrar'}
                                </button>
                            </form>
                            
                            <div className="mt-6 text-center">
                                <button
                                    onClick={() => setIsRegister(!isRegister)}
                                    className="text-blue-500 hover:underline"
                                >
                                    {isRegister ? 'Já tem conta? Faça login' : 'Não tem conta? Registre-se'}
                                </button>
                            </div>
                            
                            <div className="mt-4 text-center">
                                <button
                                    onClick={() => {
                                        const demoUser = {
                                            id: 0,
                                            name: 'Usuário Demo',
                                            email: 'demo@pmbok.com',
                                            company: 'Demo Company',
                                            role: 'Project Manager'
                                        };
                                        setCurrentUser(demoUser);
                                        setIsLoggedIn(true);
                                        setShowLogin(false);
                                        addNotification('info', 'Modo Demo', 'Você entrou no modo demonstração');
                                    }}
                                    className="text-gray-500 hover:underline text-sm"
                                >
                                    Entrar no Modo Demo
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Notificações
            const NotificationSystem = () => {
                return (
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {notifications.map(notification => (
                            <div
                                key={notification.id}
                                className={`notification-enter bg-white shadow-lg rounded-lg p-4 max-w-sm border-l-4 ${
                                    notification.type === 'success' ? 'border-green-500' :
                                    notification.type === 'error' ? 'border-red-500' :
                                    notification.type === 'warning' ? 'border-yellow-500' :
                                    'border-blue-500'
                                }`}
                            >
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h4 className="font-semibold">{notification.title}</h4>
                                        <p className="text-sm text-gray-600">{notification.message}</p>
                                    </div>
                                    <button
                                        onClick={() => removeNotification(notification.id)}
                                        className="ml-4 text-gray-400 hover:text-gray-600"
                                    >
                                        <i data-lucide="x" className="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            // Função para exportar PDF
            const exportToPDF = async () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configurar fonte
                doc.setFontSize(20);
                doc.text('Relatório do Projeto', 20, 20);
                
                if (activeProject) {
                    doc.setFontSize(16);
                    doc.text(activeProject.name, 20, 35);
                    
                    doc.setFontSize(12);
                    doc.text(`Descrição: ${activeProject.description || 'N/A'}`, 20, 50);
                    doc.text(`Data Início: ${activeProject.startDate || 'N/A'}`, 20, 60);
                    doc.text(`Data Fim: ${activeProject.endDate || 'N/A'}`, 20, 70);
                    doc.text(`Orçamento: ${activeProject.budget || 'N/A'}`, 20, 80);
                    doc.text(`Status: ${activeProject.status || 'N/A'}`, 20, 90);
                    
                    // Adicionar riscos
                    const projectRisks = risks.filter(r => r.projectId === activeProject.id);
                    if (projectRisks.length > 0) {
                        doc.text('Riscos:', 20, 110);
                        let yPos = 120;
                        projectRisks.forEach((risk, idx) => {
                            doc.text(`${idx + 1}. ${risk.description}`, 25, yPos);
                            yPos += 10;
                        });
                    }
                    
                    // Adicionar stakeholders
                    const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject.id);
                    if (projectStakeholders.length > 0 && yPos < 250) {
                        doc.text('Stakeholders:', 20, yPos + 10);
                        yPos += 20;
                        projectStakeholders.forEach((stakeholder, idx) => {
                            if (yPos < 270) {
                                doc.text(`${idx + 1}. ${stakeholder.name} - ${stakeholder.role}`, 25, yPos);
                                yPos += 10;
                            }
                        });
                    }
                }
                
                // Adicionar data de geração
                const today = new Date().toLocaleDateString('pt-BR');
                doc.setFontSize(10);
                doc.text(`Gerado em: ${today}`, 20, 280);
                doc.text(`Por: ${currentUser?.name || 'Usuário'}`, 100, 280);
                
                // Salvar PDF
                doc.save(`projeto-${activeProject?.name || 'relatorio'}.pdf`);
                addNotification('success', 'PDF Exportado', 'Relatório salvo com sucesso!');
            };

            // Integração com Google Calendar (simulada)
            const syncWithGoogleCalendar = () => {
                // Em produção, isso usaria a API do Google Calendar
                const events = tasks.map(task => ({
                    title: task.title,
                    start: task.dueDate,
                    description: task.description
                }));
                
                // Simular exportação
                const calendarData = {
                    events,
                    projectName: activeProject?.name,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(calendarData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `calendar-${activeProject?.name || 'events'}.json`;
                a.click();
                
                addNotification('success', 'Calendário Exportado', 'Eventos prontos para importação no Google Calendar');
            };

            // Dashboard Avançado
            const Dashboard = () => {
                const chartRef = useRef(null);
                const progressChartRef = useRef(null);
                const chartInstance = useRef(null);
                const progressChartInstance = useRef(null);

                useEffect(() => {
                    if (chartRef.current) {
                        const ctx = chartRef.current.getContext('2d');
                        
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        
                        chartInstance.current = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['Riscos', 'Tarefas', 'Entregas', 'Stakeholders'],
                                datasets: [{
                                    label: 'Quantidade',
                                    data: [
                                        risks.filter(r => r.projectId === activeProject?.id).length,
                                        tasks.filter(t => t.projectId === activeProject?.id).length,
                                        deliverables.filter(d => d.projectId === activeProject?.id).length,
                                        stakeholders.filter(s => s.projectId === activeProject?.id).length
                                    ],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.5)',
                                        'rgba(54, 162, 235, 0.5)',
                                        'rgba(255, 206, 86, 0.5)',
                                        'rgba(75, 192, 192, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    if (progressChartRef.current) {
                        const ctx = progressChartRef.current.getContext('2d');
                        
                        if (progressChartInstance.current) {
                            progressChartInstance.current.destroy();
                        }
                        
                        const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                        const completedTasks = projectTasks.filter(t => t.status === 'done').length;
                        const inProgressTasks = projectTasks.filter(t => t.status === 'in_progress').length;
                        const todoTasks = projectTasks.filter(t => t.status === 'todo').length;
                        
                        progressChartInstance.current = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Concluídas', 'Em Progresso', 'A Fazer'],
                                datasets: [{
                                    data: [completedTasks, inProgressTasks, todoTasks],
                                    backgroundColor: [
                                        'rgba(75, 192, 192, 0.5)',
                                        'rgba(255, 206, 86, 0.5)',
                                        'rgba(255, 99, 132, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(255, 99, 132, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        if (progressChartInstance.current) {
                            progressChartInstance.current.destroy();
                        }
                    };
                }, [activeProject, risks, tasks, deliverables, stakeholders]);

                if (!activeProject) {
                    return (
                        <div className="flex items-center justify-center h-full">
                            <div className="text-center">
                                <i data-lucide="folder-open" className="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                <h3 className="text-lg font-medium text-gray-900">{t('projects')}</h3>
                                <p className="text-gray-500">Selecione ou crie um projeto para começar</p>
                                <button
                                    onClick={() => setShowModal('project')}
                                    className="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                >
                                    {t('newProject')}
                                </button>
                            </div>
                        </div>
                    );
                }

                const projectTasks = tasks.filter(t => t.projectId === activeProject.id);
                const upcomingDeadlines = projectTasks
                    .filter(t => t.dueDate && t.status !== 'done')
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                    .slice(0, 5);

                return (
                    <div className="space-y-6">
                        {/* Header do Projeto */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-900">{activeProject.name}</h2>
                                    <p className="text-gray-600 mt-1">{activeProject.description}</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportToPDF}
                                        className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="download" className="w-4 h-4"></i>
                                        {t('exportPdf')}
                                    </button>
                                    <button
                                        onClick={syncWithGoogleCalendar}
                                        className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="calendar" className="w-4 h-4"></i>
                                        Sync Calendar
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* KPIs */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Total de Tarefas</p>
                                        <p className="text-2xl font-bold">{projectTasks.length}</p>
                                    </div>
                                    <i data-lucide="check-square" className="w-8 h-8 text-blue-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Concluídas</p>
                                        <p className="text-2xl font-bold">
                                            {projectTasks.filter(t => t.status === 'done').length}
                                        </p>
                                    </div>
                                    <i data-lucide="check-circle" className="w-8 h-8 text-green-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Riscos Abertos</p>
                                        <p className="text-2xl font-bold">
                                            {risks.filter(r => r.projectId === activeProject.id && r.status === 'open').length}
                                        </p>
                                    </div>
                                    <i data-lucide="alert-triangle" className="w-8 h-8 text-orange-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Stakeholders</p>
                                        <p className="text-2xl font-bold">
                                            {stakeholders.filter(s => s.projectId === activeProject.id).length}
                                        </p>
                                    </div>
                                    <i data-lucide="users" className="w-8 h-8 text-purple-500"></i>
                                </div>
                            </div>
                        </div>

                        {/* Gráficos */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Visão Geral do Projeto</h3>
                                <div className="h-64">
                                    <canvas ref={chartRef}></canvas>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Progresso das Tarefas</h3>
                                <div className="h-64">
                                    <canvas ref={progressChartRef}></canvas>
                                </div>
                            </div>
                        </div>

                        {/* Próximos Prazos */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Próximos Prazos</h3>
                            {upcomingDeadlines.length > 0 ? (
                                <div className="space-y-2">
                                    {upcomingDeadlines.map(task => (
                                        <div key={task.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                                            <div>
                                                <h4 className="font-medium">{task.title}</h4>
                                                <p className="text-sm text-gray-500">{task.description}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-sm font-medium">
                                                    {new Date(task.dueDate).toLocaleDateString('pt-BR')}
                                                </p>
                                                <p className="text-xs text-gray-500">
                                                    {Math.ceil((new Date(task.dueDate) - new Date()) / (1000 * 60 * 60 * 24))} dias
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-gray-500">Nenhum prazo próximo</p>
                            )}
                        </div>
                    </div>
                );
            };

            // Modal de Projeto
            const ProjectModal = ({ project, onSave, onClose }) => {
                const [formData, setFormData] = useState(project || {
                    name: '',
                    description: '',
                    startDate: '',
                    endDate: '',
                    budget: '',
                    status: 'planning',
                    manager: currentUser?.name || ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        ...formData,
                        id: project?.id || Date.now(),
                        userId: currentUser?.id,
                        createdAt: project?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md">
                            <h3 className="text-xl font-bold mb-4">
                                {project ? 'Editar Projeto' : t('newProject')}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('projectName')}</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('description')}</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="3"
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">{t('startDate')}</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.startDate}
                                                onChange={(e) => setFormData({...formData, startDate: e.target.value})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">{t('endDate')}</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.endDate}
                                                onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('budget')}</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="R$ 0,00"
                                            value={formData.budget}
                                            onChange={(e) => setFormData({...formData, budget: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('status')}</label>
                                        <select
                                            className="w-full border rounded px-3 py-2"
                                            value={formData.status}
                                            onChange={(e) => setFormData({...formData, status: e.target.value})}
                                        >
                                            <option value="planning">{t('planning')}</option>
                                            <option value="active">{t('active')}</option>
                                            <option value="on-hold">{t('onHold')}</option>
                                            <option value="completed">{t('completed')}</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 border rounded hover:bg-gray-50"
                                    >
                                        {t('cancel')}
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                    >
                                        {t('save')}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Layout Principal
            const MainLayout = () => {
                const handleLogout = () => {
                    setCurrentUser(null);
                    setIsLoggedIn(false);
                    setShowLogin(true);
                    localStorage.removeItem('pmbok_currentUser');
                    addNotification('info', 'Logout', 'Você saiu do sistema');
                };

                const menuItems = [
                    { id: 'dashboard', name: t('dashboard'), icon: 'layout-dashboard' },
                    { id: 'projects', name: t('projects'), icon: 'folder' },
                    { id: 'tasks', name: 'Tarefas', icon: 'check-square' },
                    { id: 'risks', name: 'Riscos', icon: 'alert-triangle' },
                    { id: 'stakeholders', name: 'Stakeholders', icon: 'users' },
                    { id: 'reports', name: 'Relatórios', icon: 'file-text' },
                    { id: 'settings', name: t('settings'), icon: 'settings' }
                ];

                return (
                    <div className={`min-h-screen ${darkMode ? 'dark bg-gray-900' : 'bg-gray-50'}`}>
                        {/* Header */}
                        <header className="bg-white shadow-sm border-b">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex justify-between items-center h-16">
                                    <div className="flex items-center">
                                        <h1 className="text-xl font-bold">PMBOK 7 Manager Pro</h1>
                                        <select
                                            className="ml-4 border rounded px-2 py-1"
                                            value={activeProject?.id || ''}
                                            onChange={(e) => {
                                                const project = projects.find(p => p.id === parseInt(e.target.value));
                                                setActiveProject(project);
                                            }}
                                        >
                                            <option value="">Selecione um projeto</option>
                                            {projects
                                                .filter(p => !currentUser || p.userId === currentUser.id)
                                                .map(project => (
                                                    <option key={project.id} value={project.id}>{project.name}</option>
                                                ))}
                                        </select>
                                        <button
                                            onClick={() => setShowModal('project')}
                                            className="ml-2 px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600"
                                        >
                                            <i data-lucide="plus" className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <button
                                            onClick={() => setDarkMode(!darkMode)}
                                            className="p-2 rounded hover:bg-gray-100"
                                        >
                                            <i data-lucide={darkMode ? 'sun' : 'moon'} className="w-5 h-5"></i>
                                        </button>
                                        <button
                                            onClick={() => setLanguage(language === 'pt' ? 'en' : 'pt')}
                                            className="px-3 py-1 border rounded text-sm"
                                        >
                                            {language === 'pt' ? 'EN' : 'PT'}
                                        </button>
                                        <div className="flex items-center gap-2">
                                            <span className="text-sm">{currentUser?.name}</span>
                                            <button
                                                onClick={handleLogout}
                                                className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                            >
                                                {t('logout')}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="flex">
                            {/* Sidebar */}
                            <div className="w-64 bg-white shadow-md h-screen">
                                <nav className="p-4">
                                    <ul className="space-y-2">
                                        {menuItems.map(item => (
                                            <li key={item.id}>
                                                <button
                                                    onClick={() => setActiveView(item.id)}
                                                    className={`w-full text-left px-3 py-2 rounded flex items-center gap-3 ${
                                                        activeView === item.id 
                                                            ? 'bg-blue-50 text-blue-600' 
                                                            : 'text-gray-700 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    <i data-lucide={item.icon} className="w-4 h-4"></i>
                                                    {item.name}
                                                </button>
                                            </li>
                                        ))}
                                    </ul>
                                </nav>
                            </div>

                            {/* Main Content */}
                            <div className="flex-1 p-6">
                                {activeView === 'dashboard' && <Dashboard />}
                                {activeView === 'projects' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">{t('projects')}</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {projects
                                                .filter(p => !currentUser || p.userId === currentUser.id)
                                                .map(project => (
                                                    <div key={project.id} className="border rounded-lg p-4 hover:shadow-lg transition-shadow">
                                                        <h3 className="font-semibold">{project.name}</h3>
                                                        <p className="text-sm text-gray-600 mt-1">{project.description}</p>
                                                        <div className="mt-3 flex justify-between items-center">
                                                            <span className={`px-2 py-1 text-xs rounded ${
                                                                project.status === 'active' ? 'bg-green-100 text-green-800' :
                                                                project.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                                                project.status === 'on-hold' ? 'bg-yellow-100 text-yellow-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`}>
                                                                {project.status}
                                                            </span>
                                                            <button
                                                                onClick={() => setActiveProject(project)}
                                                                className="text-blue-500 hover:underline text-sm"
                                                            >
                                                                Abrir
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                        </div>
                                    </div>
                                )}
                                {activeView === 'settings' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">{t('settings')}</h2>
                                        <div className="space-y-4">
                                            <div>
                                                <h3 className="font-semibold mb-2">Perfil do Usuário</h3>
                                                <p>Nome: {currentUser?.name}</p>
                                                <p>Email: {currentUser?.email}</p>
                                                <p>Empresa: {currentUser?.company}</p>
                                                <p>Cargo: {currentUser?.role}</p>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Preferências</h3>
                                                <label className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={darkMode}
                                                        onChange={(e) => setDarkMode(e.target.checked)}
                                                    />
                                                    Modo Escuro
                                                </label>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Idioma</h3>
                                                <select
                                                    value={language}
                                                    onChange={(e) => setLanguage(e.target.value)}
                                                    className="border rounded px-3 py-2"
                                                >
                                                    <option value="pt">Português</option>
                                                    <option value="en">English</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {activeView === 'tasks' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">Tarefas</h2>
                                        {/* Implementar lista de tarefas */}
                                        <p className="text-gray-500">Sistema de tarefas em desenvolvimento...</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Modals */}
                        {showModal === 'project' && (
                            <ProjectModal
                                project={editingItem}
                                onSave={(project) => {
                                    if (editingItem) {
                                        setProjects(projects.map(p => p.id === project.id ? project : p));
                                    } else {
                                        setProjects([...projects, project]);
                                        setActiveProject(project);
                                    }
                                    setShowModal(null);
                                    setEditingItem(null);
                                    addNotification('success', 'Sucesso', 'Projeto salvo com sucesso!');
                                }}
                                onClose={() => {
                                    setShowModal(null);
                                    setEditingItem(null);
                                }}
                            />
                        )}
                    </div>
                );
            };

            // Renderização principal
            if (showLogin && !isLoggedIn) {
                return (
                    <>
                        <LoginSystem />
                        <NotificationSystem />
                    </>
                );
            }

            return (
                <>
                    <MainLayout />
                    <NotificationSystem />
                </>
            );
        };

        // Renderizar aplicação
        ReactDOM.createRoot(document.getElementById('root')).render(<PMBOKManagerPro />);
        
        // Inicializar ícones
        setTimeout(() => {
            lucide.createIcons();
        }, 100);
    </script>
</body>
</html>
