<!DOCTYPE html>
<!--
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Project Manager System Pro
Copyright ¬© 2024 Gustavo Henrique
TODOS OS DIREITOS RESERVADOS

LICEN√áA PROPRIET√ÅRIA
Este software √© propriedade exclusiva de Gustavo Henrique.
Uso comercial requer licen√ßa. Veja arquivo LICENSE.

Autor: Gustavo Henrique
GitHub: @gustavohenrique55
Data: Novembro 2024
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Manager System Pro - Sistema Completo de Gest√£o de Projetos</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        .notification-enter {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const PMBOKManagerPro = () => {
            // Estados principais
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [showLogin, setShowLogin] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [darkMode, setDarkMode] = useState(false);
            const [activeView, setActiveView] = useState('dashboard');
            const [projects, setProjects] = useState([]);
            const [activeProject, setActiveProject] = useState(null);
            const [showModal, setShowModal] = useState(null);
            const [editingItem, setEditingItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [language, setLanguage] = useState('pt');

            // Estados para artefatos PMBOK
            const [projectCharters, setProjectCharters] = useState([]);
            const [stakeholders, setStakeholders] = useState([]);
            const [risks, setRisks] = useState([]);
            const [wbs, setWbs] = useState([]);
            const [changes, setChanges] = useState([]);
            const [lessons, setLessons] = useState([]);
            const [deliverables, setDeliverables] = useState([]);
            const [qualityMetrics, setQualityMetrics] = useState([]);
            const [communications, setCommunications] = useState([]);
            const [resources, setResources] = useState([]);
            const [tasks, setTasks] = useState([]);

            // Estados para IA
            const [aiChatOpen, setAiChatOpen] = useState(false);
            const [aiMessages, setAiMessages] = useState([]);
            const [aiLoading, setAiLoading] = useState(false);
            const [geminiApiKey, setGeminiApiKey] = useState(''); // Usu√°rio deve configurar sua pr√≥pria chave

            // Estados para Firebase
            const [firebaseConfig, setFirebaseConfig] = useState(null);
            const [firebaseInitialized, setFirebaseInitialized] = useState(false);
            const [firebaseAuth, setFirebaseAuth] = useState(null);
            const [firebaseDb, setFirebaseDb] = useState(null);
            const [syncEnabled, setSyncEnabled] = useState(false);
            const [syncStatus, setSyncStatus] = useState('disconnected'); // disconnected, connecting, connected, syncing, error
            const [teamMembers, setTeamMembers] = useState([]);
            const [pendingInvites, setPendingInvites] = useState([]);

            // Estados para ClickUp
            const [clickupApiKey, setClickupApiKey] = useState('');
            const [clickupWorkspaceId, setClickupWorkspaceId] = useState('');
            const [clickupSpaceId, setClickupSpaceId] = useState('');
            const [clickupConnected, setClickupConnected] = useState(false);
            const [clickupSyncEnabled, setClickupSyncEnabled] = useState(false);

            // Estados para Trello
            const [trelloApiKey, setTrelloApiKey] = useState('');
            const [trelloToken, setTrelloToken] = useState('');
            const [trelloBoardId, setTrelloBoardId] = useState('');
            const [trelloConnected, setTrelloConnected] = useState(false);

            // Estados para Microsoft Planner
            const [plannerAccessToken, setPlannerAccessToken] = useState('');
            const [plannerPlanId, setPlannerPlanId] = useState('');
            const [plannerConnected, setPlannerConnected] = useState(false);

            // Base de Conhecimento do Manual do Usu√°rio
            const userManualKnowledge = {
                'dashboard': {
                    keywords: ['dashboard', 'vis√£o geral', 'kpi', 'gr√°ficos', 'overview'],
                    content: `DASHBOARD: Mostra vis√£o geral do projeto com KPIs:
                    - Total de tarefas, riscos, stakeholders
                    - Gr√°ficos de status de tarefas, distribui√ß√£o de riscos, or√ßamento
                    - Acesso r√°pido a todos os m√≥dulos`
                },
                'projetos': {
                    keywords: ['projeto', 'criar projeto', 'novo projeto', 'editar projeto'],
                    content: `GEST√ÉO DE PROJETOS:
                    - Criar: Clicar no bot√£o "+" no topo, preencher nome, descri√ß√£o, datas, or√ßamento
                    - Campos: Nome, Descri√ß√£o, Data In√≠cio, Data Fim, Or√ßamento, Status, Gerente
                    - Status: Planejamento, Em andamento, Conclu√≠do, Cancelado
                    - Use a IA para gerar descri√ß√£o autom√°tica do projeto`
                },
                'tarefas': {
                    keywords: ['tarefa', 'task', 'kanban', 'board', 'arrastar', 'drag'],
                    content: `GEST√ÉO DE TAREFAS (KANBAN):
                    - Colunas: A Fazer, Em Progresso, Em Revis√£o, Conclu√≠do
                    - Criar: Clicar em "+" na coluna desejada
                    - Campos: T√≠tulo, Descri√ß√£o, Respons√°vel, Prioridade, Data
                    - Arrastar e soltar entre colunas para mudar status
                    - Use IA para gerar lista de tarefas sugeridas`
                },
                'riscos': {
                    keywords: ['risco', 'risk', 'matriz', 'probabilidade', 'impacto', 'amea√ßa', 'oportunidade'],
                    content: `GEST√ÉO DE RISCOS:
                    - Matriz 5x5 (Probabilidade x Impacto)
                    - Tipos: Amea√ßa ou Oportunidade
                    - Probabilidade: 1-5 (Muito Baixa a Muito Alta)
                    - Impacto: 1-5 (Muito Baixo a Muito Alto)
                    - Severidade: Calculada automaticamente (P x I)
                    - N√≠veis: Baixo (1-5), M√©dio (6-12), Alto (13-18), Cr√≠tico (19-25)
                    - Campos: T√≠tulo, Descri√ß√£o, Categoria, Plano de Mitiga√ß√£o
                    - Use IA para identificar riscos automaticamente`
                },
                'stakeholders': {
                    keywords: ['stakeholder', 'parte interessada', 'poder', 'interesse', 'matriz stakeholder'],
                    content: `GEST√ÉO DE STAKEHOLDERS:
                    - Matriz 2x2 (Poder x Interesse)
                    - Poder: 1-5 (influ√™ncia sobre o projeto)
                    - Interesse: 1-5 (n√≠vel de interesse no projeto)
                    - Estrat√©gias autom√°ticas:
                      * Monitorar (Baixo Poder + Baixo Interesse)
                      * Manter Informado (Baixo Poder + Alto Interesse)
                      * Manter Satisfeito (Alto Poder + Baixo Interesse)
                      * Gerenciar de Perto (Alto Poder + Alto Interesse)
                    - Campos: Nome, Cargo, Email, Telefone, Expectativas
                    - Use IA para an√°lise de stakeholders`
                },
                'wbs': {
                    keywords: ['wbs', 'estrutura anal√≠tica', 'decomposi√ß√£o', 'work breakdown'],
                    content: `WBS (WORK BREAKDOWN STRUCTURE):
                    - Decomposi√ß√£o hier√°rquica do trabalho
                    - N√≠veis: Projeto > Fase > Pacote de Trabalho > Atividade
                    - Campos: Nome, Descri√ß√£o, N√≠vel, Respons√°vel, Status
                    - Use IA para gerar WBS completa automaticamente`
                },
                'mudancas': {
                    keywords: ['mudan√ßa', 'change', 'solicita√ß√£o', 'aprova√ß√£o'],
                    content: `GEST√ÉO DE MUDAN√áAS:
                    - Workflow: Pendente > Aprovada/Rejeitada > Implementada
                    - Campos: T√≠tulo, Descri√ß√£o, Solicitante, Justificativa, Impacto, Custo
                    - Rastreamento completo de solicita√ß√µes
                    - Aprova√ß√£o/Rejei√ß√£o com coment√°rios`
                },
                'licoes': {
                    keywords: ['li√ß√£o', 'li√ß√µes aprendidas', 'aprendizado', 'lessons learned'],
                    content: `LI√á√ïES APRENDIDAS:
                    - Tipos: Positivo ou Negativo
                    - Categorias: T√©cnico, Gest√£o, Comunica√ß√£o, Riscos, Qualidade, Recursos
                    - Campos: T√≠tulo, Descri√ß√£o, Categoria, Recomenda√ß√£o, Fase
                    - Base de conhecimento para projetos futuros`
                },
                'entregas': {
                    keywords: ['entrega', 'deliverable', 'produto', 'resultado'],
                    content: `GEST√ÉO DE ENTREGAS (DELIVERABLES):
                    - Status: Planejado, Em desenvolvimento, Em revis√£o, Entregue
                    - Campos: Nome, Descri√ß√£o, Respons√°vel, Data Prevista, Data Real
                    - Acompanhamento de produtos e resultados do projeto`
                },
                'qualidade': {
                    keywords: ['qualidade', 'quality', 'm√©trica', 'padr√£o', 'indicador'],
                    content: `M√âTRICAS DE QUALIDADE:
                    - Tipos de m√©tricas personalizadas
                    - Campos: Nome, Descri√ß√£o, Meta, Valor Atual, Unidade, Frequ√™ncia
                    - Acompanhamento de KPIs de qualidade
                    - Compara√ß√£o Meta vs Real`
                },
                'comunicacoes': {
                    keywords: ['comunica√ß√£o', 'communication', 'plano', 'stakeholder comunica√ß√£o'],
                    content: `PLANO DE COMUNICA√á√ïES:
                    - Matriz de comunica√ß√£o do projeto
                    - Campos: Tipo, Descri√ß√£o, P√∫blico-alvo, Frequ√™ncia, Respons√°vel, Canal
                    - Frequ√™ncias: Di√°ria, Semanal, Quinzenal, Mensal, Trimestral, Conforme necess√°rio
                    - Canais: Email, Reuni√£o, Relat√≥rio, Dashboard, Apresenta√ß√£o`
                },
                'recursos': {
                    keywords: ['recurso', 'resource', 'equipe', 'material', 'aloca√ß√£o'],
                    content: `GEST√ÉO DE RECURSOS:
                    - Tipos: Humano ou Material
                    - Campos: Nome, Tipo, Quantidade, Custo/Hora ou Custo/Unidade, Disponibilidade
                    - Aloca√ß√£o de pessoas e materiais ao projeto
                    - Controle de custos e disponibilidade`
                },
                'custos': {
                    keywords: ['custo', 'cost', 'evm', 'valor agregado', 'or√ßamento', 'budget', 'cpi', 'spi'],
                    content: `GEST√ÉO DE CUSTOS & EVM (EARNED VALUE MANAGEMENT):
                    - Campos: Categoria, Descri√ß√£o, Valor Planejado (PV), Valor Agregado (EV), Custo Real (AC)
                    - Indicadores calculados automaticamente:
                      * CV (Cost Variance) = EV - AC
                      * SV (Schedule Variance) = EV - PV
                      * CPI (Cost Performance Index) = EV / AC (>1 = bom)
                      * SPI (Schedule Performance Index) = EV / PV (>1 = bom)
                    - Dashboard de an√°lise de valor agregado
                    - Categorias: Recursos Humanos, Materiais, Equipamentos, Servi√ßos, Outros`
                },
                'issues': {
                    keywords: ['issue', 'problema', 'impedimento', 'bloqueio'],
                    content: `GEST√ÉO DE ISSUES (PROBLEMAS):
                    - Status: Aberto, Em andamento, Resolvido, Fechado
                    - Prioridade: Baixa, M√©dia, Alta, Cr√≠tica
                    - Campos: T√≠tulo, Descri√ß√£o, Respons√°vel, Data Identifica√ß√£o, Data Resolu√ß√£o
                    - Rastreamento de impedimentos e bloqueios`
                },
                'relatorios': {
                    keywords: ['relat√≥rio', 'report', 'pdf', 'exportar', 'executivo'],
                    content: `SISTEMA DE RELAT√ìRIOS:
                    - Tipos: Executivo, Detalhado, Riscos, Stakeholders
                    - Formatos: Visualizar ou Exportar PDF
                    - Relat√≥rio Executivo: Resumo geral do projeto
                    - Relat√≥rio Detalhado: Informa√ß√µes completas de todos os m√≥dulos
                    - Relat√≥rio de Riscos: An√°lise detalhada da matriz de riscos
                    - Relat√≥rio de Stakeholders: An√°lise da matriz de stakeholders`
                },
                'ia': {
                    keywords: ['ia', 'ai', 'intelig√™ncia artificial', 'gemini', 'assistente', 'chatbot'],
                    content: `ASSISTENTE DE IA (GOOGLE GEMINI):
                    - Bot√£o flutuante ü§ñ no canto inferior direito
                    - 6 Fun√ß√µes especializadas:
                      1. Gerar Descri√ß√£o de Projeto
                      2. Sugerir Tarefas
                      3. Identificar Riscos
                      4. Analisar Stakeholders
                      5. Gerar WBS
                      6. Gerar Relat√≥rio Executivo
                    - Chat livre para perguntas sobre gest√£o de projetos e PMBOK 7
                    - Context-aware: conhece o projeto ativo`
                },
                'backup': {
                    keywords: ['backup', 'restore', 'exportar', 'importar', 'salvar dados'],
                    content: `BACKUP E RESTORE:
                    - Exportar Dados: Ir em Configura√ß√µes > Exportar Dados > Salvar arquivo JSON
                    - Importar Dados: Ir em Configura√ß√µes > Importar Dados > Selecionar arquivo JSON
                    - Dados inclu√≠dos: Todos os projetos, tarefas, riscos, stakeholders, etc.
                    - Importante: Fazer backup regularmente pois dados ficam no navegador`
                },
                'login': {
                    keywords: ['login', 'entrar', 'cadastro', 'criar conta', 'modo demo'],
                    content: `ACESSO AO SISTEMA:
                    - Modo Demo: Acesso r√°pido sem cadastro (dados tempor√°rios)
                    - Criar Conta: Email e senha (dados salvos localmente)
                    - Login: Email e senha cadastrados
                    - Dados armazenados no navegador (LocalStorage)`
                }
            };

            // ==================== FIREBASE FUNCTIONS ====================

            // Inicializar Firebase
            const initializeFirebase = (config) => {
                try {
                    if (!window.firebase) {
                        addNotification('error', 'Erro', 'Firebase SDK n√£o carregado');
                        return false;
                    }

                    if (!firebase.apps.length) {
                        firebase.initializeApp(config);
                    }

                    const auth = firebase.auth();
                    const db = firebase.firestore();

                    setFirebaseAuth(auth);
                    setFirebaseDb(db);
                    setFirebaseInitialized(true);
                    setSyncStatus('connected');

                    addNotification('success', 'Firebase', 'Conectado com sucesso!');

                    // Listener de autentica√ß√£o
                    auth.onAuthStateChanged((user) => {
                        if (user) {
                            setCurrentUser({
                                id: user.uid,
                                name: user.displayName || user.email,
                                email: user.email,
                                photoURL: user.photoURL
                            });
                            setIsLoggedIn(true);
                            setShowLogin(false);

                            // Carregar projetos do usu√°rio
                            loadUserProjects(user.uid, db);
                        } else {
                            // Usu√°rio deslogado - manter dados locais
                            if (!currentUser) {
                                setShowLogin(true);
                            }
                        }
                    });

                    return true;
                } catch (error) {
                    console.error('Erro ao inicializar Firebase:', error);
                    addNotification('error', 'Erro Firebase', error.message);
                    setSyncStatus('error');
                    return false;
                }
            };

            // Autentica√ß√£o com Email/Senha
            const signUpWithFirebase = async (email, password, displayName) => {
                try {
                    if (!firebaseAuth) {
                        throw new Error('Firebase n√£o inicializado');
                    }

                    const userCredential = await firebaseAuth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;

                    // Atualizar perfil
                    await user.updateProfile({ displayName });

                    // Criar documento do usu√°rio no Firestore
                    await firebaseDb.collection('users').doc(user.uid).set({
                        name: displayName,
                        email: email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        photoURL: null
                    });

                    addNotification('success', 'Conta Criada', `Bem-vindo, ${displayName}!`);
                    return true;
                } catch (error) {
                    console.error('Erro ao criar conta:', error);
                    addNotification('error', 'Erro', error.message);
                    return false;
                }
            };

            const signInWithFirebase = async (email, password) => {
                try {
                    if (!firebaseAuth) {
                        throw new Error('Firebase n√£o inicializado');
                    }

                    await firebaseAuth.signInWithEmailAndPassword(email, password);
                    addNotification('success', 'Login', 'Login realizado com sucesso!');
                    return true;
                } catch (error) {
                    console.error('Erro ao fazer login:', error);
                    addNotification('error', 'Erro', error.message);
                    return false;
                }
            };

            const signInWithGoogle = async () => {
                try {
                    if (!firebaseAuth) {
                        throw new Error('Firebase n√£o inicializado');
                    }

                    const provider = new firebase.auth.GoogleAuthProvider();
                    await firebaseAuth.signInWithPopup(provider);
                    addNotification('success', 'Login', 'Login com Google realizado!');
                    return true;
                } catch (error) {
                    console.error('Erro ao fazer login com Google:', error);
                    addNotification('error', 'Erro', error.message);
                    return false;
                }
            };

            const signOutFirebase = async () => {
                try {
                    if (!firebaseAuth) return;

                    await firebaseAuth.signOut();
                    setIsLoggedIn(false);
                    setCurrentUser(null);
                    setShowLogin(true);
                    addNotification('success', 'Logout', 'Sess√£o encerrada');
                } catch (error) {
                    console.error('Erro ao fazer logout:', error);
                    addNotification('error', 'Erro', error.message);
                }
            };

            // Carregar projetos do usu√°rio
            const loadUserProjects = async (userId, db) => {
                try {
                    setSyncStatus('syncing');

                    const projectsRef = db.collection('projects');
                    const query = projectsRef.where('ownerId', '==', userId);

                    // Listener em tempo real
                    query.onSnapshot((snapshot) => {
                        const loadedProjects = [];
                        snapshot.forEach((doc) => {
                            loadedProjects.push({ id: doc.id, ...doc.data() });
                        });

                        setProjects(loadedProjects);
                        setSyncStatus('connected');
                    });

                } catch (error) {
                    console.error('Erro ao carregar projetos:', error);
                    setSyncStatus('error');
                }
            };

            // Salvar projeto no Firestore
            const saveProjectToFirebase = async (project) => {
                if (!firebaseDb || !syncEnabled) return;

                try {
                    setSyncStatus('syncing');

                    const projectData = {
                        ...project,
                        ownerId: currentUser.id,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        members: {
                            [currentUser.id]: {
                                role: 'owner',
                                name: currentUser.name,
                                email: currentUser.email
                            }
                        }
                    };

                    if (project.id) {
                        // Atualizar existente
                        await firebaseDb.collection('projects').doc(project.id).update(projectData);
                    } else {
                        // Criar novo
                        const docRef = await firebaseDb.collection('projects').add({
                            ...projectData,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        project.id = docRef.id;
                    }

                    setSyncStatus('connected');
                } catch (error) {
                    console.error('Erro ao salvar projeto:', error);
                    setSyncStatus('error');
                }
            };

            // Salvar tarefa no Firestore
            const saveTaskToFirebase = async (task, projectId) => {
                if (!firebaseDb || !syncEnabled || !projectId) return;

                try {
                    const taskData = {
                        ...task,
                        projectId: projectId,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const taskRef = firebaseDb.collection('projects').doc(projectId).collection('tasks');

                    if (task.id) {
                        await taskRef.doc(task.id).update(taskData);
                    } else {
                        const docRef = await taskRef.add({
                            ...taskData,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        task.id = docRef.id;
                    }
                } catch (error) {
                    console.error('Erro ao salvar tarefa:', error);
                }
            };

            // Carregar tarefas do projeto
            const loadProjectTasks = (projectId) => {
                if (!firebaseDb || !projectId) return;

                const tasksRef = firebaseDb.collection('projects').doc(projectId).collection('tasks');

                tasksRef.onSnapshot((snapshot) => {
                    const loadedTasks = [];
                    snapshot.forEach((doc) => {
                        loadedTasks.push({ id: doc.id, ...doc.data() });
                    });
                    setTasks(loadedTasks);
                });
            };

            // Adicionar membro √† equipe
            const addTeamMember = async (projectId, memberEmail, role = 'editor') => {
                if (!firebaseDb) return;

                try {
                    // Buscar usu√°rio por email
                    const usersRef = firebaseDb.collection('users');
                    const userQuery = await usersRef.where('email', '==', memberEmail).get();

                    if (userQuery.empty) {
                        addNotification('error', 'Erro', 'Usu√°rio n√£o encontrado');
                        return false;
                    }

                    const memberDoc = userQuery.docs[0];
                    const memberId = memberDoc.id;
                    const memberData = memberDoc.data();

                    // Adicionar ao projeto
                    await firebaseDb.collection('projects').doc(projectId).update({
                        [`members.${memberId}`]: {
                            role: role,
                            name: memberData.name,
                            email: memberData.email,
                            addedAt: firebase.firestore.FieldValue.serverTimestamp()
                        }
                    });

                    addNotification('success', 'Equipe', `${memberData.name} adicionado(a) ao projeto`);
                    return true;
                } catch (error) {
                    console.error('Erro ao adicionar membro:', error);
                    addNotification('error', 'Erro', error.message);
                    return false;
                }
            };

            // Migrar dados locais para Firebase
            const migrateLocalToFirebase = async () => {
                if (!firebaseDb || !currentUser) {
                    addNotification('error', 'Erro', 'Firebase n√£o configurado ou usu√°rio n√£o logado');
                    return;
                }

                try {
                    setSyncStatus('syncing');
                    addNotification('info', 'Migra√ß√£o', 'Iniciando migra√ß√£o de dados...');

                    const localProjects = JSON.parse(localStorage.getItem('pmbok_projects') || '[]');
                    const localTasks = JSON.parse(localStorage.getItem('pmbok_tasks') || '[]');
                    const localRisks = JSON.parse(localStorage.getItem('pmbok_risks') || '[]');

                    let migratedProjects = 0;
                    let migratedTasks = 0;
                    let migratedRisks = 0;

                    // Migrar projetos
                    for (const project of localProjects) {
                        await saveProjectToFirebase(project);
                        migratedProjects++;
                    }

                    // Migrar tarefas
                    for (const task of localTasks) {
                        if (task.projectId) {
                            await saveTaskToFirebase(task, task.projectId);
                            migratedTasks++;
                        }
                    }

                    // Migrar riscos (similar)
                    for (const risk of localRisks) {
                        if (risk.projectId) {
                            await firebaseDb.collection('projects').doc(risk.projectId)
                                .collection('risks').add(risk);
                            migratedRisks++;
                        }
                    }

                    setSyncStatus('connected');
                    setSyncEnabled(true);

                    addNotification('success', 'Migra√ß√£o Conclu√≠da',
                        `${migratedProjects} projetos, ${migratedTasks} tarefas, ${migratedRisks} riscos migrados`);

                } catch (error) {
                    console.error('Erro na migra√ß√£o:', error);
                    setSyncStatus('error');
                    addNotification('error', 'Erro', 'Falha na migra√ß√£o: ' + error.message);
                }
            };

            // ==================== FIM FIREBASE FUNCTIONS ====================

            // ==================== CLICKUP FUNCTIONS ====================

            // Testar conex√£o ClickUp
            const testClickUpConnection = async (apiKey) => {
                try {
                    const response = await fetch('https://api.clickup.com/api/v2/team', {
                        headers: {
                            'Authorization': apiKey
                        }
                    });

                    if (!response.ok) {
                        throw new Error('API Key inv√°lida');
                    }

                    const data = await response.json();
                    return { success: true, teams: data.teams };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            };

            // Importar tarefas do ClickUp
            const importFromClickUp = async (listId) => {
                if (!clickupApiKey) {
                    addNotification('error', 'Erro', 'Configure a API Key do ClickUp primeiro');
                    return;
                }

                try {
                    const response = await fetch(`https://api.clickup.com/api/v2/list/${listId}/task`, {
                        headers: {
                            'Authorization': clickupApiKey
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Erro ao buscar tarefas');
                    }

                    const data = await response.json();
                    const importedTasks = data.tasks.map(task => ({
                        id: task.id,
                        title: task.name,
                        description: task.description || '',
                        status: mapClickUpStatus(task.status.status),
                        priority: mapClickUpPriority(task.priority),
                        assignee: task.assignees[0]?.username || '',
                        dueDate: task.due_date ? new Date(parseInt(task.due_date)).toISOString().split('T')[0] : '',
                        projectId: activeProject?.id
                    }));

                    setTasks([...tasks, ...importedTasks]);
                    addNotification('success', 'ClickUp', `${importedTasks.length} tarefas importadas`);
                } catch (error) {
                    addNotification('error', 'Erro ClickUp', error.message);
                }
            };

            // Exportar tarefas para ClickUp
            const exportToClickUp = async (listId) => {
                if (!clickupApiKey) {
                    addNotification('error', 'Erro', 'Configure a API Key do ClickUp primeiro');
                    return;
                }

                try {
                    const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                    let created = 0;

                    for (const task of projectTasks) {
                        const clickupTask = {
                            name: task.title,
                            description: task.description || '',
                            status: mapToClickUpStatus(task.status),
                            priority: mapToClickUpPriority(task.priority),
                            due_date: task.dueDate ? new Date(task.dueDate).getTime() : null
                        };

                        const response = await fetch(`https://api.clickup.com/api/v2/list/${listId}/task`, {
                            method: 'POST',
                            headers: {
                                'Authorization': clickupApiKey,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(clickupTask)
                        });

                        if (response.ok) created++;
                    }

                    addNotification('success', 'ClickUp', `${created} tarefas exportadas`);
                } catch (error) {
                    addNotification('error', 'Erro ClickUp', error.message);
                }
            };

            // Mapear status ClickUp ‚Üí System Pro
            const mapClickUpStatus = (status) => {
                const statusMap = {
                    'to do': 'todo',
                    'in progress': 'in-progress',
                    'complete': 'done'
                };
                return statusMap[status.toLowerCase()] || 'todo';
            };

            // Mapear status System Pro ‚Üí ClickUp
            const mapToClickUpStatus = (status) => {
                const statusMap = {
                    'todo': 'to do',
                    'in-progress': 'in progress',
                    'done': 'complete'
                };
                return statusMap[status] || 'to do';
            };

            // Mapear prioridade ClickUp ‚Üí System Pro
            const mapClickUpPriority = (priority) => {
                if (!priority) return 'medium';
                const priorityMap = {
                    1: 'urgent',
                    2: 'high',
                    3: 'medium',
                    4: 'low'
                };
                return priorityMap[priority.priority] || 'medium';
            };

            // Mapear prioridade System Pro ‚Üí ClickUp
            const mapToClickUpPriority = (priority) => {
                const priorityMap = {
                    'urgent': 1,
                    'high': 2,
                    'medium': 3,
                    'low': 4
                };
                return priorityMap[priority] || 3;
            };

            // ==================== FIM CLICKUP FUNCTIONS ====================

            // ==================== TRELLO FUNCTIONS ====================

            // Testar conex√£o Trello
            const testTrelloConnection = async () => {
                if (!trelloApiKey || !trelloToken) {
                    addNotification('error', 'Erro', 'Preencha API Key e Token do Trello');
                    return;
                }
                try {
                    const response = await fetch(`https://api.trello.com/1/members/me?key=${trelloApiKey}&token=${trelloToken}`);
                    if (response.ok) {
                        setTrelloConnected(true);
                        addNotification('success', 'Trello', 'Conectado com sucesso!');
                    } else {
                        throw new Error('Credenciais inv√°lidas');
                    }
                } catch (error) {
                    setTrelloConnected(false);
                    addNotification('error', 'Erro Trello', error.message);
                }
            };

            // Importar cards do Trello
            const importFromTrello = async () => {
                if (!trelloConnected || !trelloBoardId) {
                    addNotification('error', 'Erro', 'Configure e conecte o Trello primeiro');
                    return;
                }
                try {
                    const response = await fetch(
                        `https://api.trello.com/1/boards/${trelloBoardId}/cards?key=${trelloApiKey}&token=${trelloToken}`
                    );
                    const cards = await response.json();

                    const importedTasks = cards.map(card => ({
                        id: Date.now() + Math.random(),
                        projectId: activeProject?.id,
                        title: card.name,
                        description: card.desc,
                        status: mapTrelloStatus(card.idList),
                        priority: 'medium',
                        createdAt: card.dateLastActivity,
                        trelloId: card.id
                    }));

                    setTasks(prev => [...prev, ...importedTasks]);
                    addNotification('success', 'Trello', `${importedTasks.length} cards importados`);
                } catch (error) {
                    addNotification('error', 'Erro Trello', error.message);
                }
            };

            // Exportar tarefas para Trello
            const exportToTrello = async () => {
                if (!trelloConnected || !trelloBoardId) {
                    addNotification('error', 'Erro', 'Configure e conecte o Trello primeiro');
                    return;
                }
                try {
                    // Obter listas do board
                    const listsResponse = await fetch(
                        `https://api.trello.com/1/boards/${trelloBoardId}/lists?key=${trelloApiKey}&token=${trelloToken}`
                    );
                    const lists = await listsResponse.json();
                    const defaultList = lists[0]?.id;

                    if (!defaultList) {
                        throw new Error('Nenhuma lista encontrada no board');
                    }

                    const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                    let created = 0;

                    for (const task of projectTasks) {
                        await fetch(`https://api.trello.com/1/cards?key=${trelloApiKey}&token=${trelloToken}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                idList: defaultList,
                                name: task.title,
                                desc: task.description || ''
                            })
                        });
                        created++;
                    }
                    addNotification('success', 'Trello', `${created} tarefas exportadas`);
                } catch (error) {
                    addNotification('error', 'Erro Trello', error.message);
                }
            };

            // Mapear status Trello (simplificado)
            const mapTrelloStatus = (listId) => {
                // Por padr√£o, retorna 'todo'. O usu√°rio pode personalizar
                return 'todo';
            };

            // ==================== FIM TRELLO FUNCTIONS ====================

            // ==================== PLANNER FUNCTIONS ====================

            // Testar conex√£o Microsoft Planner
            const testPlannerConnection = async () => {
                if (!plannerAccessToken) {
                    addNotification('error', 'Erro', 'Preencha o Access Token do Microsoft Graph');
                    return;
                }
                try {
                    const response = await fetch('https://graph.microsoft.com/v1.0/me', {
                        headers: { 'Authorization': `Bearer ${plannerAccessToken}` }
                    });
                    if (response.ok) {
                        setPlannerConnected(true);
                        addNotification('success', 'Planner', 'Conectado com sucesso!');
                    } else {
                        throw new Error('Token inv√°lido ou expirado');
                    }
                } catch (error) {
                    setPlannerConnected(false);
                    addNotification('error', 'Erro Planner', error.message);
                }
            };

            // Importar tarefas do Planner
            const importFromPlanner = async () => {
                if (!plannerConnected || !plannerPlanId) {
                    addNotification('error', 'Erro', 'Configure e conecte o Planner primeiro');
                    return;
                }
                try {
                    const response = await fetch(
                        `https://graph.microsoft.com/v1.0/planner/plans/${plannerPlanId}/tasks`,
                        { headers: { 'Authorization': `Bearer ${plannerAccessToken}` } }
                    );
                    const data = await response.json();

                    const importedTasks = data.value.map(task => ({
                        id: Date.now() + Math.random(),
                        projectId: activeProject?.id,
                        title: task.title,
                        description: '',
                        status: mapPlannerStatus(task.percentComplete),
                        priority: mapPlannerPriority(task.priority),
                        dueDate: task.dueDateTime,
                        plannerId: task.id
                    }));

                    setTasks(prev => [...prev, ...importedTasks]);
                    addNotification('success', 'Planner', `${importedTasks.length} tarefas importadas`);
                } catch (error) {
                    addNotification('error', 'Erro Planner', error.message);
                }
            };

            // Exportar tarefas para Planner
            const exportToPlanner = async () => {
                if (!plannerConnected || !plannerPlanId) {
                    addNotification('error', 'Erro', 'Configure e conecte o Planner primeiro');
                    return;
                }
                try {
                    // Obter buckets do plano
                    const bucketsResponse = await fetch(
                        `https://graph.microsoft.com/v1.0/planner/plans/${plannerPlanId}/buckets`,
                        { headers: { 'Authorization': `Bearer ${plannerAccessToken}` } }
                    );
                    const buckets = await bucketsResponse.json();
                    const defaultBucket = buckets.value[0]?.id;

                    if (!defaultBucket) {
                        throw new Error('Nenhum bucket encontrado no plano');
                    }

                    const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                    let created = 0;

                    for (const task of projectTasks) {
                        await fetch('https://graph.microsoft.com/v1.0/planner/tasks', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${plannerAccessToken}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                planId: plannerPlanId,
                                bucketId: defaultBucket,
                                title: task.title
                            })
                        });
                        created++;
                    }
                    addNotification('success', 'Planner', `${created} tarefas exportadas`);
                } catch (error) {
                    addNotification('error', 'Erro Planner', error.message);
                }
            };

            // Mapear status Planner ‚Üí System Pro
            const mapPlannerStatus = (percentComplete) => {
                if (percentComplete === 100) return 'done';
                if (percentComplete > 0) return 'in-progress';
                return 'todo';
            };

            // Mapear prioridade Planner ‚Üí System Pro
            const mapPlannerPriority = (priority) => {
                const priorityMap = { 1: 'urgent', 3: 'high', 5: 'medium', 9: 'low' };
                return priorityMap[priority] || 'medium';
            };

            // ==================== FIM PLANNER FUNCTIONS ====================

            // ==================== MS PROJECT FUNCTIONS ====================

            // Exportar para MS Project XML
            const exportToMSProject = () => {
                if (!activeProject) {
                    addNotification('error', 'Erro', 'Selecione um projeto primeiro');
                    return;
                }

                try {
                    const projectTasks = tasks.filter(t => t.projectId === activeProject.id);

                    // Gerar XML no formato MS Project
                    let xml = `<?xml version="1.0" encoding="UTF-8"?>
<Project xmlns="http://schemas.microsoft.com/project">
  <Name>${activeProject.name}</Name>
  <Title>${activeProject.name}</Title>
  <Manager>${activeProject.manager || currentUser.name}</Manager>
  <StartDate>${activeProject.startDate || new Date().toISOString()}</StartDate>
  <FinishDate>${activeProject.endDate || new Date().toISOString()}</FinishDate>

  <Tasks>`;

                    projectTasks.forEach((task, index) => {
                        xml += `
    <Task>
      <UID>${index + 1}</UID>
      <ID>${index + 1}</ID>
      <Name>${escapeXml(task.title)}</Name>
      <Notes>${escapeXml(task.description || '')}</Notes>
      <Priority>${getPriorityNumber(task.priority)}</Priority>
      <PercentComplete>${task.status === 'done' ? 100 : task.status === 'in-progress' ? 50 : 0}</PercentComplete>
      <Start>${task.dueDate || activeProject.startDate || new Date().toISOString()}</Start>
      <Finish>${task.dueDate || activeProject.endDate || new Date().toISOString()}</Finish>
      <Duration>PT8H</Duration>
      <ResourceNames>${escapeXml(task.assignee || '')}</ResourceNames>
    </Task>`;
                    });

                    xml += `
  </Tasks>
</Project>`;

                    // Download do arquivo XML
                    const blob = new Blob([xml], { type: 'application/xml' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${activeProject.name.replace(/\s+/g, '-')}.xml`;
                    a.click();

                    addNotification('success', 'MS Project', 'Projeto exportado com sucesso!');
                } catch (error) {
                    addNotification('error', 'Erro', 'Falha ao exportar: ' + error.message);
                }
            };

            // Importar de MS Project XML
            const importFromMSProject = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.xml';

                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const xmlText = event.target.result;
                            const parser = new DOMParser();
                            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                            // Extrair informa√ß√µes do projeto
                            const projectName = xmlDoc.getElementsByTagName('Name')[0]?.textContent || 'Projeto Importado';
                            const manager = xmlDoc.getElementsByTagName('Manager')[0]?.textContent || currentUser.name;
                            const startDate = xmlDoc.getElementsByTagName('StartDate')[0]?.textContent || new Date().toISOString();
                            const finishDate = xmlDoc.getElementsByTagName('FinishDate')[0]?.textContent || new Date().toISOString();

                            // Criar projeto
                            const newProject = {
                                id: Date.now(),
                                name: projectName,
                                description: 'Importado do MS Project',
                                manager: manager,
                                startDate: startDate.split('T')[0],
                                endDate: finishDate.split('T')[0],
                                status: 'active',
                                userId: currentUser.id,
                                createdAt: new Date().toISOString()
                            };

                            setProjects([...projects, newProject]);
                            setActiveProject(newProject);

                            // Extrair tarefas
                            const taskElements = xmlDoc.getElementsByTagName('Task');
                            const importedTasks = [];

                            for (let i = 0; i < taskElements.length; i++) {
                                const taskEl = taskElements[i];
                                const name = taskEl.getElementsByTagName('Name')[0]?.textContent || '';
                                const notes = taskEl.getElementsByTagName('Notes')[0]?.textContent || '';
                                const priority = taskEl.getElementsByTagName('Priority')[0]?.textContent || '500';
                                const percentComplete = parseInt(taskEl.getElementsByTagName('PercentComplete')[0]?.textContent || '0');
                                const finish = taskEl.getElementsByTagName('Finish')[0]?.textContent || '';
                                const resource = taskEl.getElementsByTagName('ResourceNames')[0]?.textContent || '';

                                importedTasks.push({
                                    id: Date.now() + i,
                                    title: name,
                                    description: notes,
                                    priority: getPriorityFromNumber(priority),
                                    status: percentComplete === 100 ? 'done' : percentComplete > 0 ? 'in-progress' : 'todo',
                                    dueDate: finish ? finish.split('T')[0] : '',
                                    assignee: resource,
                                    projectId: newProject.id
                                });
                            }

                            setTasks([...tasks, ...importedTasks]);
                            addNotification('success', 'MS Project', `Projeto e ${importedTasks.length} tarefas importados!`);
                        } catch (error) {
                            addNotification('error', 'Erro', 'Falha ao importar XML: ' + error.message);
                        }
                    };

                    reader.readAsText(file);
                };

                input.click();
            };

            // Fun√ß√µes auxiliares para MS Project
            const escapeXml = (str) => {
                if (!str) return '';
                return str
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&apos;');
            };

            const getPriorityNumber = (priority) => {
                const map = { 'low': 200, 'medium': 500, 'high': 800, 'urgent': 1000 };
                return map[priority] || 500;
            };

            const getPriorityFromNumber = (num) => {
                const priority = parseInt(num);
                if (priority >= 800) return 'high';
                if (priority >= 500) return 'medium';
                return 'low';
            };

            // ==================== FIM MS PROJECT FUNCTIONS ====================

            // Fun√ß√£o para buscar no manual do usu√°rio
            const searchUserManual = (userQuestion) => {
                const questionLower = userQuestion.toLowerCase();
                let relevantSections = [];

                // Busca por palavras-chave em cada se√ß√£o
                Object.keys(userManualKnowledge).forEach(section => {
                    const { keywords, content } = userManualKnowledge[section];

                    // Verifica se alguma palavra-chave aparece na pergunta
                    const hasMatch = keywords.some(keyword => questionLower.includes(keyword));

                    if (hasMatch) {
                        relevantSections.push(content);
                    }
                });

                // Se encontrou se√ß√µes relevantes, retorna como contexto
                if (relevantSections.length > 0) {
                    return `\n\nINFORMA√á√ïES DO MANUAL DO SISTEMA:\n${relevantSections.join('\n\n')}\n\n`;
                }

                return '';
            };

            // Fun√ß√£o para chamar API do Google Gemini
            const callGeminiAPI = async (prompt, context = '') => {
                if (!geminiApiKey) {
                    addNotification('error', 'Erro', 'API Key do Gemini n√£o configurada');
                    return null;
                }

                try {
                    setAiLoading(true);
                    const fullPrompt = context ? `${context}\n\n${prompt}` : prompt;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${geminiApiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: fullPrompt
                                }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Erro na requisi√ß√£o √† API');
                    }

                    const data = await response.json();
                    const aiResponse = data.candidates[0]?.content?.parts[0]?.text || 'Desculpe, n√£o consegui gerar uma resposta.';

                    setAiLoading(false);
                    return aiResponse;
                } catch (error) {
                    console.error('Erro ao chamar Gemini API:', error);
                    addNotification('error', 'Erro de IA', 'N√£o foi poss√≠vel conectar com a IA');
                    setAiLoading(false);
                    return null;
                }
            };

            // Fun√ß√µes espec√≠ficas de IA para cada m√≥dulo
            const aiGenerateProjectDescription = async (projectName, projectType) => {
                const prompt = `Voc√™ √© um especialista em gest√£o de projetos PMBOK 7.

Gere uma descri√ß√£o profissional e detalhada para um projeto chamado "${projectName}" do tipo "${projectType}".

A descri√ß√£o deve incluir:
- Objetivo principal
- Escopo resumido
- Benef√≠cios esperados
- P√∫blico-alvo

Limite a 200 palavras. Seja profissional e direto.`;

                return await callGeminiAPI(prompt);
            };

            const aiGenerateTasks = async (projectName, projectDescription) => {
                const prompt = `Voc√™ √© um especialista em gest√£o de projetos PMBOK 7.

Com base neste projeto:
Nome: ${projectName}
Descri√ß√£o: ${projectDescription}

Gere uma lista de 8-10 tarefas principais necess√°rias para o projeto.

Para cada tarefa, forne√ßa no formato:
- T√≠tulo da tarefa
- Descri√ß√£o breve
- Prioridade sugerida (Alta/M√©dia/Baixa)
- Dura√ß√£o estimada em dias

Formato de resposta:
TAREFA 1: [t√≠tulo]
Descri√ß√£o: [descri√ß√£o]
Prioridade: [prioridade]
Dura√ß√£o: [X dias]

(repita para todas as tarefas)`;

                return await callGeminiAPI(prompt);
            };

            const aiIdentifyRisks = async (projectName, projectDescription) => {
                const prompt = `Voc√™ √© um especialista em gest√£o de riscos e PMBOK 7.

Analise este projeto:
Nome: ${projectName}
Descri√ß√£o: ${projectDescription}

Identifique os 6-8 principais riscos potenciais.

Para cada risco, forne√ßa:
- Descri√ß√£o do risco
- Categoria (T√©cnico/Financeiro/Operacional/Externo)
- Probabilidade (1-5)
- Impacto (1-5)
- Plano de mitiga√ß√£o sugerido

Formato:
RISCO 1: [descri√ß√£o]
Categoria: [categoria]
Probabilidade: [1-5]
Impacto: [1-5]
Mitiga√ß√£o: [plano]

(repita para todos)`;

                return await callGeminiAPI(prompt);
            };

            const aiAnalyzeStakeholders = async (projectName, projectDescription) => {
                const prompt = `Voc√™ √© um especialista em gest√£o de stakeholders e PMBOK 7.

Para este projeto:
Nome: ${projectName}
Descri√ß√£o: ${projectDescription}

Identifique 6-8 stakeholders principais que devem ser considerados.

Para cada stakeholder, forne√ßa:
- Nome/Cargo
- Organiza√ß√£o/√Årea
- N√≠vel de Poder (1-5)
- N√≠vel de Interesse (1-5)
- Expectativas principais
- Estrat√©gia de engajamento recomendada

Formato:
STAKEHOLDER 1: [nome/cargo]
Organiza√ß√£o: [organiza√ß√£o]
Poder: [1-5]
Interesse: [1-5]
Expectativas: [texto]
Estrat√©gia: [texto]

(repita para todos)`;

                return await callGeminiAPI(prompt);
            };

            const aiGenerateWBS = async (projectName, projectDescription) => {
                const prompt = `Voc√™ √© um especialista em WBS (Work Breakdown Structure) e PMBOK 7.

Para o projeto:
Nome: ${projectName}
Descri√ß√£o: ${projectDescription}

Crie uma estrutura anal√≠tica de trabalho (WBS) hier√°rquica com 3 n√≠veis:
- N√≠vel 1: Fases principais (4-6 fases)
- N√≠vel 2: Entregas principais por fase (2-4 por fase)
- N√≠vel 3: Pacotes de trabalho (2-3 por entrega)

Use numera√ß√£o hier√°rquica (1.0, 1.1, 1.1.1, etc.)

Formato:
1.0 [Fase 1]
  1.1 [Entrega 1.1]
    1.1.1 [Pacote de trabalho]
    1.1.2 [Pacote de trabalho]
  1.2 [Entrega 1.2]
    1.2.1 [Pacote de trabalho]

Continue para todas as fases.`;

                return await callGeminiAPI(prompt);
            };

            const aiGenerateExecutiveReport = async (projectData) => {
                const prompt = `Voc√™ √© um especialista em relat√≥rios executivos e PMBOK 7.

Gere um relat√≥rio executivo profissional baseado nestes dados:

Projeto: ${projectData.name}
Status: ${projectData.status}
Progresso: ${projectData.progress || 0}%
Tarefas: ${projectData.totalTasks} total, ${projectData.completedTasks} conclu√≠das
Riscos: ${projectData.totalRisks} identificados, ${projectData.openRisks} abertos
Stakeholders: ${projectData.totalStakeholders}

O relat√≥rio deve incluir:
1. Resumo Executivo (3-4 par√°grafos)
2. Status Geral do Projeto
3. Principais Conquistas
4. Desafios e Riscos
5. Pr√≥ximos Passos
6. Recomenda√ß√µes

Seja profissional, conciso e use linguagem executiva.`;

                return await callGeminiAPI(prompt);
            };

            // Tradu√ß√µes
            const translations = {
                pt: {
                    welcome: "Bem-vindo",
                    dashboard: "Dashboard",
                    projects: "Projetos",
                    logout: "Sair",
                    exportPdf: "Exportar PDF",
                    notifications: "Notifica√ß√µes",
                    settings: "Configura√ß√µes",
                    newProject: "Novo Projeto",
                    projectName: "Nome do Projeto",
                    description: "Descri√ß√£o",
                    startDate: "Data In√≠cio",
                    endDate: "Data Fim",
                    budget: "Or√ßamento",
                    save: "Salvar",
                    cancel: "Cancelar",
                    delete: "Deletar",
                    edit: "Editar",
                    status: "Status",
                    active: "Ativo",
                    completed: "Conclu√≠do",
                    onHold: "Pausado",
                    planning: "Planejamento"
                },
                en: {
                    welcome: "Welcome",
                    dashboard: "Dashboard",
                    projects: "Projects",
                    logout: "Logout",
                    exportPdf: "Export PDF",
                    notifications: "Notifications",
                    settings: "Settings",
                    newProject: "New Project",
                    projectName: "Project Name",
                    description: "Description",
                    startDate: "Start Date",
                    endDate: "End Date",
                    budget: "Budget",
                    save: "Save",
                    cancel: "Cancel",
                    delete: "Delete",
                    edit: "Edit",
                    status: "Status",
                    active: "Active",
                    completed: "Completed",
                    onHold: "On Hold",
                    planning: "Planning"
                }
            };

            const t = (key) => translations[language][key] || key;

            // Carregar dados do localStorage
            useEffect(() => {
                const loadData = () => {
                    try {
                        const savedUsers = localStorage.getItem('pmbok_users');
                        if (savedUsers) setUsers(JSON.parse(savedUsers));
                        
                        const savedProjects = localStorage.getItem('pmbok_projects');
                        if (savedProjects) setProjects(JSON.parse(savedProjects));
                        
                        const savedCharters = localStorage.getItem('pmbok_charters');
                        if (savedCharters) setProjectCharters(JSON.parse(savedCharters));
                        
                        const savedStakeholders = localStorage.getItem('pmbok_stakeholders');
                        if (savedStakeholders) setStakeholders(JSON.parse(savedStakeholders));
                        
                        const savedRisks = localStorage.getItem('pmbok_risks');
                        if (savedRisks) setRisks(JSON.parse(savedRisks));
                        
                        const savedDarkMode = localStorage.getItem('pmbok_darkMode');
                        if (savedDarkMode) setDarkMode(JSON.parse(savedDarkMode));
                        
                        const savedLanguage = localStorage.getItem('pmbok_language');
                        if (savedLanguage) setLanguage(savedLanguage);
                        
                        const savedTasks = localStorage.getItem('pmbok_tasks');
                        if (savedTasks) setTasks(JSON.parse(savedTasks));
                        
                        // Check for logged in user
                        const loggedUser = localStorage.getItem('pmbok_currentUser');
                        if (loggedUser) {
                            setCurrentUser(JSON.parse(loggedUser));
                            setIsLoggedIn(true);
                            setShowLogin(false);
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                    }
                };
                loadData();
            }, []);

            // Salvar dados no localStorage
            useEffect(() => {
                if (users.length > 0) {
                    localStorage.setItem('pmbok_users', JSON.stringify(users));
                }
            }, [users]);

            useEffect(() => {
                localStorage.setItem('pmbok_projects', JSON.stringify(projects));
            }, [projects]);

            useEffect(() => {
                localStorage.setItem('pmbok_charters', JSON.stringify(projectCharters));
            }, [projectCharters]);

            useEffect(() => {
                localStorage.setItem('pmbok_stakeholders', JSON.stringify(stakeholders));
            }, [stakeholders]);

            useEffect(() => {
                localStorage.setItem('pmbok_risks', JSON.stringify(risks));
            }, [risks]);

            useEffect(() => {
                localStorage.setItem('pmbok_tasks', JSON.stringify(tasks));
            }, [tasks]);

            useEffect(() => {
                localStorage.setItem('pmbok_darkMode', JSON.stringify(darkMode));
            }, [darkMode]);

            useEffect(() => {
                localStorage.setItem('pmbok_language', language);
            }, [language]);

            // Sistema de Notifica√ß√µes
            const addNotification = (type, title, message) => {
                const notification = {
                    id: Date.now(),
                    type,
                    title,
                    message,
                    timestamp: new Date().toISOString()
                };
                setNotifications(prev => [...prev, notification]);
                
                // Auto remove ap√≥s 5 segundos
                setTimeout(() => {
                    removeNotification(notification.id);
                }, 5000);
            };

            const removeNotification = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            // Verificar tarefas vencendo
            useEffect(() => {
                if (isLoggedIn && tasks.length > 0) {
                    const checkDeadlines = () => {
                        const today = new Date();
                        const tomorrow = new Date(today);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        
                        tasks.forEach(task => {
                            if (task.dueDate) {
                                const dueDate = new Date(task.dueDate);
                                const diffTime = dueDate - today;
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                
                                if (diffDays === 1) {
                                    addNotification('warning', 'Tarefa Vencendo', `${task.title} vence amanh√£!`);
                                } else if (diffDays === 0) {
                                    addNotification('error', 'Tarefa Vence Hoje', `${task.title} vence hoje!`);
                                } else if (diffDays < 0 && task.status !== 'done') {
                                    addNotification('error', 'Tarefa Atrasada', `${task.title} est√° atrasada!`);
                                }
                            }
                        });
                    };
                    
                    checkDeadlines();
                    const interval = setInterval(checkDeadlines, 3600000); // Check every hour
                    return () => clearInterval(interval);
                }
            }, [isLoggedIn, tasks]);

            // Componente de Login/Registro
            const LoginSystem = () => {
                const [isRegister, setIsRegister] = useState(false);
                const [formData, setFormData] = useState({
                    email: '',
                    password: '',
                    name: '',
                    company: '',
                    role: ''
                });

                const handleLogin = (e) => {
                    e.preventDefault();
                    const user = users.find(u => u.email === formData.email && u.password === formData.password);
                    
                    if (user) {
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                        setShowLogin(false);
                        localStorage.setItem('pmbok_currentUser', JSON.stringify(user));
                        addNotification('success', 'Login Realizado', `Bem-vindo de volta, ${user.name}!`);
                    } else {
                        addNotification('error', 'Erro no Login', 'Email ou senha incorretos');
                    }
                };

                const handleRegister = (e) => {
                    e.preventDefault();
                    const newUser = {
                        id: Date.now(),
                        ...formData,
                        createdAt: new Date().toISOString()
                    };
                    
                    setUsers(prev => [...prev, newUser]);
                    setCurrentUser(newUser);
                    setIsLoggedIn(true);
                    setShowLogin(false);
                    localStorage.setItem('pmbok_currentUser', JSON.stringify(newUser));
                    addNotification('success', 'Conta Criada', 'Bem-vindo ao Project Manager System Pro!');
                };

                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800">Project Manager System Pro</h1>
                                <p className="text-gray-600 mt-2">Sistema Profissional de Gest√£o de Projetos</p>
                            </div>
                            
                            <form onSubmit={isRegister ? handleRegister : handleLogin}>
                                {isRegister && (
                                    <>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Nome Completo</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                required
                                                value={formData.name}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Empresa</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                value={formData.company}
                                                onChange={(e) => setFormData({...formData, company: e.target.value})}
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Cargo</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                value={formData.role}
                                                onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            />
                                        </div>
                                    </>
                                )}
                                
                                <div className="mb-4">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">Email</label>
                                    <input
                                        type="email"
                                        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                        required
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    />
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                                    <input
                                        type="password"
                                        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                        required
                                        value={formData.password}
                                        onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    />
                                </div>
                                
                                <button
                                    type="submit"
                                    className="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300"
                                >
                                    {isRegister ? 'Criar Conta' : 'Entrar'}
                                </button>
                            </form>
                            
                            <div className="mt-6 text-center">
                                <button
                                    onClick={() => setIsRegister(!isRegister)}
                                    className="text-blue-500 hover:underline"
                                >
                                    {isRegister ? 'J√° tem conta? Fa√ßa login' : 'N√£o tem conta? Registre-se'}
                                </button>
                            </div>
                            
                            <div className="mt-4 text-center">
                                <button
                                    onClick={() => {
                                        const demoUser = {
                                            id: 0,
                                            name: 'Usu√°rio Demo',
                                            email: 'demo@pmbok.com',
                                            company: 'Demo Company',
                                            role: 'Project Manager'
                                        };
                                        setCurrentUser(demoUser);
                                        setIsLoggedIn(true);
                                        setShowLogin(false);
                                        addNotification('info', 'Modo Demo', 'Voc√™ entrou no modo demonstra√ß√£o');
                                    }}
                                    className="text-gray-500 hover:underline text-sm"
                                >
                                    Entrar no Modo Demo
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Notifica√ß√µes
            const NotificationSystem = () => {
                return (
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {notifications.map(notification => (
                            <div
                                key={notification.id}
                                className={`notification-enter bg-white shadow-lg rounded-lg p-4 max-w-sm border-l-4 ${
                                    notification.type === 'success' ? 'border-green-500' :
                                    notification.type === 'error' ? 'border-red-500' :
                                    notification.type === 'warning' ? 'border-yellow-500' :
                                    'border-blue-500'
                                }`}
                            >
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h4 className="font-semibold">{notification.title}</h4>
                                        <p className="text-sm text-gray-600">{notification.message}</p>
                                    </div>
                                    <button
                                        onClick={() => removeNotification(notification.id)}
                                        className="ml-4 text-gray-400 hover:text-gray-600"
                                    >
                                        <i data-lucide="x" className="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            // Fun√ß√£o para exportar PDF
            const exportToPDF = async () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configurar fonte
                doc.setFontSize(20);
                doc.text('Relat√≥rio do Projeto', 20, 20);
                
                if (activeProject) {
                    doc.setFontSize(16);
                    doc.text(activeProject.name, 20, 35);
                    
                    doc.setFontSize(12);
                    doc.text(`Descri√ß√£o: ${activeProject.description || 'N/A'}`, 20, 50);
                    doc.text(`Data In√≠cio: ${activeProject.startDate || 'N/A'}`, 20, 60);
                    doc.text(`Data Fim: ${activeProject.endDate || 'N/A'}`, 20, 70);
                    doc.text(`Or√ßamento: ${activeProject.budget || 'N/A'}`, 20, 80);
                    doc.text(`Status: ${activeProject.status || 'N/A'}`, 20, 90);
                    
                    // Adicionar riscos
                    const projectRisks = risks.filter(r => r.projectId === activeProject.id);
                    if (projectRisks.length > 0) {
                        doc.text('Riscos:', 20, 110);
                        let yPos = 120;
                        projectRisks.forEach((risk, idx) => {
                            doc.text(`${idx + 1}. ${risk.description}`, 25, yPos);
                            yPos += 10;
                        });
                    }
                    
                    // Adicionar stakeholders
                    const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject.id);
                    if (projectStakeholders.length > 0 && yPos < 250) {
                        doc.text('Stakeholders:', 20, yPos + 10);
                        yPos += 20;
                        projectStakeholders.forEach((stakeholder, idx) => {
                            if (yPos < 270) {
                                doc.text(`${idx + 1}. ${stakeholder.name} - ${stakeholder.role}`, 25, yPos);
                                yPos += 10;
                            }
                        });
                    }
                }
                
                // Adicionar data de gera√ß√£o
                const today = new Date().toLocaleDateString('pt-BR');
                doc.setFontSize(10);
                doc.text(`Gerado em: ${today}`, 20, 280);
                doc.text(`Por: ${currentUser?.name || 'Usu√°rio'}`, 100, 280);
                
                // Salvar PDF
                doc.save(`projeto-${activeProject?.name || 'relatorio'}.pdf`);
                addNotification('success', 'PDF Exportado', 'Relat√≥rio salvo com sucesso!');
            };

            // Integra√ß√£o com Google Calendar (simulada)
            const syncWithGoogleCalendar = () => {
                // Em produ√ß√£o, isso usaria a API do Google Calendar
                const events = tasks.map(task => ({
                    title: task.title,
                    start: task.dueDate,
                    description: task.description
                }));
                
                // Simular exporta√ß√£o
                const calendarData = {
                    events,
                    projectName: activeProject?.name,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(calendarData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `calendar-${activeProject?.name || 'events'}.json`;
                a.click();
                
                addNotification('success', 'Calend√°rio Exportado', 'Eventos prontos para importa√ß√£o no Google Calendar');
            };

            // Dashboard Avan√ßado
            const Dashboard = () => {
                const chartRef = useRef(null);
                const progressChartRef = useRef(null);
                const chartInstance = useRef(null);
                const progressChartInstance = useRef(null);

                useEffect(() => {
                    if (chartRef.current) {
                        const ctx = chartRef.current.getContext('2d');
                        
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        
                        chartInstance.current = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['Riscos', 'Tarefas', 'Entregas', 'Stakeholders'],
                                datasets: [{
                                    label: 'Quantidade',
                                    data: [
                                        risks.filter(r => r.projectId === activeProject?.id).length,
                                        tasks.filter(t => t.projectId === activeProject?.id).length,
                                        deliverables.filter(d => d.projectId === activeProject?.id).length,
                                        stakeholders.filter(s => s.projectId === activeProject?.id).length
                                    ],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.5)',
                                        'rgba(54, 162, 235, 0.5)',
                                        'rgba(255, 206, 86, 0.5)',
                                        'rgba(75, 192, 192, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    if (progressChartRef.current) {
                        const ctx = progressChartRef.current.getContext('2d');
                        
                        if (progressChartInstance.current) {
                            progressChartInstance.current.destroy();
                        }
                        
                        const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                        const completedTasks = projectTasks.filter(t => t.status === 'done').length;
                        const inProgressTasks = projectTasks.filter(t => t.status === 'in_progress').length;
                        const todoTasks = projectTasks.filter(t => t.status === 'todo').length;
                        
                        progressChartInstance.current = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Conclu√≠das', 'Em Progresso', 'A Fazer'],
                                datasets: [{
                                    data: [completedTasks, inProgressTasks, todoTasks],
                                    backgroundColor: [
                                        'rgba(75, 192, 192, 0.5)',
                                        'rgba(255, 206, 86, 0.5)',
                                        'rgba(255, 99, 132, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(255, 99, 132, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        if (progressChartInstance.current) {
                            progressChartInstance.current.destroy();
                        }
                    };
                }, [activeProject, risks, tasks, deliverables, stakeholders]);

                if (!activeProject) {
                    return (
                        <div className="flex items-center justify-center h-full">
                            <div className="text-center">
                                <i data-lucide="folder-open" className="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                <h3 className="text-lg font-medium text-gray-900">{t('projects')}</h3>
                                <p className="text-gray-500">Selecione ou crie um projeto para come√ßar</p>
                                <button
                                    onClick={() => setShowModal('project')}
                                    className="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                >
                                    {t('newProject')}
                                </button>
                            </div>
                        </div>
                    );
                }

                const projectTasks = tasks.filter(t => t.projectId === activeProject.id);
                const upcomingDeadlines = projectTasks
                    .filter(t => t.dueDate && t.status !== 'done')
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                    .slice(0, 5);

                return (
                    <div className="space-y-6">
                        {/* Header do Projeto */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-900">{activeProject.name}</h2>
                                    <p className="text-gray-600 mt-1">{activeProject.description}</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportToPDF}
                                        className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="download" className="w-4 h-4"></i>
                                        {t('exportPdf')}
                                    </button>
                                    <button
                                        onClick={syncWithGoogleCalendar}
                                        className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="calendar" className="w-4 h-4"></i>
                                        Sync Calendar
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* KPIs */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Total de Tarefas</p>
                                        <p className="text-2xl font-bold">{projectTasks.length}</p>
                                    </div>
                                    <i data-lucide="check-square" className="w-8 h-8 text-blue-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Conclu√≠das</p>
                                        <p className="text-2xl font-bold">
                                            {projectTasks.filter(t => t.status === 'done').length}
                                        </p>
                                    </div>
                                    <i data-lucide="check-circle" className="w-8 h-8 text-green-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Riscos Abertos</p>
                                        <p className="text-2xl font-bold">
                                            {risks.filter(r => r.projectId === activeProject.id && r.status === 'open').length}
                                        </p>
                                    </div>
                                    <i data-lucide="alert-triangle" className="w-8 h-8 text-orange-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Stakeholders</p>
                                        <p className="text-2xl font-bold">
                                            {stakeholders.filter(s => s.projectId === activeProject.id).length}
                                        </p>
                                    </div>
                                    <i data-lucide="users" className="w-8 h-8 text-purple-500"></i>
                                </div>
                            </div>
                        </div>

                        {/* Gr√°ficos */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Vis√£o Geral do Projeto</h3>
                                <div className="h-64">
                                    <canvas ref={chartRef}></canvas>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Progresso das Tarefas</h3>
                                <div className="h-64">
                                    <canvas ref={progressChartRef}></canvas>
                                </div>
                            </div>
                        </div>

                        {/* Pr√≥ximos Prazos */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Pr√≥ximos Prazos</h3>
                            {upcomingDeadlines.length > 0 ? (
                                <div className="space-y-2">
                                    {upcomingDeadlines.map(task => (
                                        <div key={task.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                                            <div>
                                                <h4 className="font-medium">{task.title}</h4>
                                                <p className="text-sm text-gray-500">{task.description}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-sm font-medium">
                                                    {new Date(task.dueDate).toLocaleDateString('pt-BR')}
                                                </p>
                                                <p className="text-xs text-gray-500">
                                                    {Math.ceil((new Date(task.dueDate) - new Date()) / (1000 * 60 * 60 * 24))} dias
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-gray-500">Nenhum prazo pr√≥ximo</p>
                            )}
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Tarefas (Kanban + Lista)
            const TasksView = () => {
                const [viewMode, setViewMode] = useState('kanban'); // 'kanban' ou 'list'
                const [showTaskModal, setShowTaskModal] = useState(false);
                const [editingTask, setEditingTask] = useState(null);
                const [filterPriority, setFilterPriority] = useState('all');
                const [draggedTask, setDraggedTask] = useState(null);

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar tarefas</p>
                        </div>
                    );
                }

                const projectTasks = tasks.filter(t => t.projectId === activeProject.id);
                const filteredTasks = filterPriority === 'all'
                    ? projectTasks
                    : projectTasks.filter(t => t.priority === filterPriority);

                const todoTasks = filteredTasks.filter(t => t.status === 'todo');
                const inProgressTasks = filteredTasks.filter(t => t.status === 'in_progress');
                const doneTasks = filteredTasks.filter(t => t.status === 'done');

                const handleDragStart = (task) => {
                    setDraggedTask(task);
                };

                const handleDragOver = (e) => {
                    e.preventDefault();
                };

                const handleDrop = (newStatus) => {
                    if (draggedTask) {
                        setTasks(tasks.map(t =>
                            t.id === draggedTask.id ? { ...t, status: newStatus } : t
                        ));
                        setDraggedTask(null);
                        addNotification('success', 'Tarefa Atualizada', 'Status alterado com sucesso!');
                    }
                };

                const deleteTask = (taskId) => {
                    if (confirm('Deseja realmente deletar esta tarefa?')) {
                        setTasks(tasks.filter(t => t.id !== taskId));
                        addNotification('success', 'Tarefa Deletada', 'Tarefa removida com sucesso!');
                    }
                };

                const TaskCard = ({ task }) => (
                    <div
                        draggable
                        onDragStart={() => handleDragStart(task)}
                        className="bg-white border rounded-lg p-3 mb-2 cursor-move hover:shadow-md transition-shadow"
                    >
                        <div className="flex justify-between items-start mb-2">
                            <h4 className="font-semibold text-sm">{task.title}</h4>
                            <span className={`text-xs px-2 py-1 rounded ${
                                task.priority === 'high' ? 'bg-red-100 text-red-800' :
                                task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-green-100 text-green-800'
                            }`}>
                                {task.priority}
                            </span>
                        </div>
                        <p className="text-xs text-gray-600 mb-2">{task.description}</p>
                        {task.dueDate && (
                            <p className="text-xs text-gray-500 mb-2">
                                üìÖ {new Date(task.dueDate).toLocaleDateString('pt-BR')}
                            </p>
                        )}
                        {task.assignedTo && (
                            <p className="text-xs text-gray-500 mb-2">üë§ {task.assignedTo}</p>
                        )}
                        <div className="flex gap-1 mt-2">
                            <button
                                onClick={() => {
                                    setEditingTask(task);
                                    setShowTaskModal(true);
                                }}
                                className="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
                            >
                                Editar
                            </button>
                            <button
                                onClick={() => deleteTask(task.id)}
                                className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                            >
                                Deletar
                            </button>
                        </div>
                    </div>
                );

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gest√£o de Tarefas - {activeProject.name}</h2>
                            <div className="flex gap-2">
                                <select
                                    value={filterPriority}
                                    onChange={(e) => setFilterPriority(e.target.value)}
                                    className="border rounded px-3 py-2 text-sm"
                                >
                                    <option value="all">Todas Prioridades</option>
                                    <option value="high">Alta</option>
                                    <option value="medium">M√©dia</option>
                                    <option value="low">Baixa</option>
                                </select>
                                <button
                                    onClick={() => setViewMode(viewMode === 'kanban' ? 'list' : 'kanban')}
                                    className="px-3 py-2 border rounded text-sm hover:bg-gray-50"
                                >
                                    {viewMode === 'kanban' ? 'üìã Lista' : 'üìä Kanban'}
                                </button>
                                <button
                                    onClick={() => {
                                        setEditingTask(null);
                                        setShowTaskModal(true);
                                    }}
                                    className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                >
                                    + Nova Tarefa
                                </button>
                            </div>
                        </div>

                        {viewMode === 'kanban' ? (
                            <div className="grid grid-cols-3 gap-4">
                                {/* Coluna A Fazer */}
                                <div
                                    onDragOver={handleDragOver}
                                    onDrop={() => handleDrop('todo')}
                                    className="bg-gray-50 rounded-lg p-4"
                                >
                                    <h3 className="font-semibold mb-3 flex items-center gap-2">
                                        <span className="w-3 h-3 bg-gray-400 rounded-full"></span>
                                        A Fazer ({todoTasks.length})
                                    </h3>
                                    <div className="space-y-2">
                                        {todoTasks.map(task => <TaskCard key={task.id} task={task} />)}
                                    </div>
                                </div>

                                {/* Coluna Em Progresso */}
                                <div
                                    onDragOver={handleDragOver}
                                    onDrop={() => handleDrop('in_progress')}
                                    className="bg-blue-50 rounded-lg p-4"
                                >
                                    <h3 className="font-semibold mb-3 flex items-center gap-2">
                                        <span className="w-3 h-3 bg-blue-500 rounded-full"></span>
                                        Em Progresso ({inProgressTasks.length})
                                    </h3>
                                    <div className="space-y-2">
                                        {inProgressTasks.map(task => <TaskCard key={task.id} task={task} />)}
                                    </div>
                                </div>

                                {/* Coluna Conclu√≠do */}
                                <div
                                    onDragOver={handleDragOver}
                                    onDrop={() => handleDrop('done')}
                                    className="bg-green-50 rounded-lg p-4"
                                >
                                    <h3 className="font-semibold mb-3 flex items-center gap-2">
                                        <span className="w-3 h-3 bg-green-500 rounded-full"></span>
                                        Conclu√≠do ({doneTasks.length})
                                    </h3>
                                    <div className="space-y-2">
                                        {doneTasks.map(task => <TaskCard key={task.id} task={task} />)}
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                <table className="w-full">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="text-left p-3">Tarefa</th>
                                            <th className="text-left p-3">Prioridade</th>
                                            <th className="text-left p-3">Status</th>
                                            <th className="text-left p-3">Respons√°vel</th>
                                            <th className="text-left p-3">Prazo</th>
                                            <th className="text-left p-3">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredTasks.map(task => (
                                            <tr key={task.id} className="border-b hover:bg-gray-50">
                                                <td className="p-3">
                                                    <div>
                                                        <p className="font-semibold">{task.title}</p>
                                                        <p className="text-sm text-gray-600">{task.description}</p>
                                                    </div>
                                                </td>
                                                <td className="p-3">
                                                    <span className={`text-xs px-2 py-1 rounded ${
                                                        task.priority === 'high' ? 'bg-red-100 text-red-800' :
                                                        task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-green-100 text-green-800'
                                                    }`}>
                                                        {task.priority}
                                                    </span>
                                                </td>
                                                <td className="p-3">
                                                    <select
                                                        value={task.status}
                                                        onChange={(e) => {
                                                            setTasks(tasks.map(t =>
                                                                t.id === task.id ? { ...t, status: e.target.value } : t
                                                            ));
                                                        }}
                                                        className="border rounded px-2 py-1 text-sm"
                                                    >
                                                        <option value="todo">A Fazer</option>
                                                        <option value="in_progress">Em Progresso</option>
                                                        <option value="done">Conclu√≠do</option>
                                                    </select>
                                                </td>
                                                <td className="p-3">{task.assignedTo || '-'}</td>
                                                <td className="p-3">
                                                    {task.dueDate ? new Date(task.dueDate).toLocaleDateString('pt-BR') : '-'}
                                                </td>
                                                <td className="p-3">
                                                    <div className="flex gap-1">
                                                        <button
                                                            onClick={() => {
                                                                setEditingTask(task);
                                                                setShowTaskModal(true);
                                                            }}
                                                            className="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                        >
                                                            Editar
                                                        </button>
                                                        <button
                                                            onClick={() => deleteTask(task.id)}
                                                            className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                                                        >
                                                            Deletar
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {/* Modal de Tarefa */}
                        {showTaskModal && (
                            <TaskModal
                                task={editingTask}
                                projectId={activeProject.id}
                                onSave={(task) => {
                                    if (editingTask) {
                                        setTasks(tasks.map(t => t.id === task.id ? task : t));
                                        addNotification('success', 'Tarefa Atualizada', 'Tarefa editada com sucesso!');
                                    } else {
                                        setTasks([...tasks, task]);
                                        addNotification('success', 'Tarefa Criada', 'Nova tarefa adicionada!');
                                    }
                                    setShowTaskModal(false);
                                    setEditingTask(null);
                                }}
                                onClose={() => {
                                    setShowTaskModal(false);
                                    setEditingTask(null);
                                }}
                            />
                        )}
                    </div>
                );
            };

            // Modal de Tarefa
            const TaskModal = ({ task, projectId, onSave, onClose }) => {
                const [formData, setFormData] = useState(task || {
                    title: '',
                    description: '',
                    priority: 'medium',
                    status: 'todo',
                    dueDate: '',
                    assignedTo: '',
                    estimatedHours: '',
                    tags: ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        ...formData,
                        id: task?.id || Date.now(),
                        projectId: projectId,
                        createdAt: task?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg p-6 w-full max-w-lg">
                            <h3 className="text-xl font-bold mb-4">
                                {task ? 'Editar Tarefa' : 'Nova Tarefa'}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">T√≠tulo</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            required
                                            value={formData.title}
                                            onChange={(e) => setFormData({...formData, title: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Descri√ß√£o</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="3"
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Prioridade</label>
                                            <select
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.priority}
                                                onChange={(e) => setFormData({...formData, priority: e.target.value})}
                                            >
                                                <option value="low">Baixa</option>
                                                <option value="medium">M√©dia</option>
                                                <option value="high">Alta</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Status</label>
                                            <select
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.status}
                                                onChange={(e) => setFormData({...formData, status: e.target.value})}
                                            >
                                                <option value="todo">A Fazer</option>
                                                <option value="in_progress">Em Progresso</option>
                                                <option value="done">Conclu√≠do</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Prazo</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.dueDate}
                                                onChange={(e) => setFormData({...formData, dueDate: e.target.value})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Horas Estimadas</label>
                                            <input
                                                type="number"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.estimatedHours}
                                                onChange={(e) => setFormData({...formData, estimatedHours: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Respons√°vel</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="Nome do respons√°vel"
                                            value={formData.assignedTo}
                                            onChange={(e) => setFormData({...formData, assignedTo: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Tags (separadas por v√≠rgula)</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="frontend, urgente, bug"
                                            value={formData.tags}
                                            onChange={(e) => setFormData({...formData, tags: e.target.value})}
                                        />
                                    </div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 border rounded hover:bg-gray-50"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                    >
                                        Salvar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Riscos
            const RisksView = () => {
                const [showRiskModal, setShowRiskModal] = useState(false);
                const [editingRisk, setEditingRisk] = useState(null);
                const [viewMode, setViewMode] = useState('list'); // 'list' ou 'matrix'

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar riscos</p>
                        </div>
                    );
                }

                const projectRisks = risks.filter(r => r.projectId === activeProject.id);

                const deleteRisk = (riskId) => {
                    if (confirm('Deseja realmente deletar este risco?')) {
                        setRisks(risks.filter(r => r.id !== riskId));
                        addNotification('success', 'Risco Deletado', 'Risco removido com sucesso!');
                    }
                };

                const getRiskLevel = (probability, impact) => {
                    const score = probability * impact;
                    if (score >= 15) return { level: 'Cr√≠tico', color: 'bg-red-500' };
                    if (score >= 10) return { level: 'Alto', color: 'bg-orange-500' };
                    if (score >= 5) return { level: 'M√©dio', color: 'bg-yellow-500' };
                    return { level: 'Baixo', color: 'bg-green-500' };
                };

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gest√£o de Riscos - {activeProject.name}</h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setViewMode(viewMode === 'list' ? 'matrix' : 'list')}
                                    className="px-3 py-2 border rounded text-sm hover:bg-gray-50"
                                >
                                    {viewMode === 'list' ? 'üìä Matriz' : 'üìã Lista'}
                                </button>
                                <button
                                    onClick={() => {
                                        setEditingRisk(null);
                                        setShowRiskModal(true);
                                    }}
                                    className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                                >
                                    + Novo Risco
                                </button>
                            </div>
                        </div>

                        {viewMode === 'list' ? (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="text-left p-3">Risco</th>
                                            <th className="text-left p-3">Categoria</th>
                                            <th className="text-left p-3">Probabilidade</th>
                                            <th className="text-left p-3">Impacto</th>
                                            <th className="text-left p-3">N√≠vel</th>
                                            <th className="text-left p-3">Status</th>
                                            <th className="text-left p-3">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {projectRisks.map(risk => {
                                            const riskLevel = getRiskLevel(risk.probability, risk.impact);
                                            return (
                                                <tr key={risk.id} className="border-b hover:bg-gray-50">
                                                    <td className="p-3">
                                                        <div>
                                                            <p className="font-semibold">{risk.title}</p>
                                                            <p className="text-sm text-gray-600">{risk.description}</p>
                                                        </div>
                                                    </td>
                                                    <td className="p-3">
                                                        <span className="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded">
                                                            {risk.category}
                                                        </span>
                                                    </td>
                                                    <td className="p-3">{risk.probability}/5</td>
                                                    <td className="p-3">{risk.impact}/5</td>
                                                    <td className="p-3">
                                                        <span className={`text-xs px-2 py-1 ${riskLevel.color} text-white rounded`}>
                                                            {riskLevel.level}
                                                        </span>
                                                    </td>
                                                    <td className="p-3">
                                                        <span className={`text-xs px-2 py-1 rounded ${
                                                            risk.status === 'open' ? 'bg-red-100 text-red-800' :
                                                            risk.status === 'mitigated' ? 'bg-green-100 text-green-800' :
                                                            'bg-gray-100 text-gray-800'
                                                        }`}>
                                                            {risk.status}
                                                        </span>
                                                    </td>
                                                    <td className="p-3">
                                                        <div className="flex gap-1">
                                                            <button
                                                                onClick={() => {
                                                                    setEditingRisk(risk);
                                                                    setShowRiskModal(true);
                                                                }}
                                                                className="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                            >
                                                                Editar
                                                            </button>
                                                            <button
                                                                onClick={() => deleteRisk(risk.id)}
                                                                className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                                                            >
                                                                Deletar
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div>
                                <h3 className="font-semibold mb-4">Matriz de Probabilidade x Impacto</h3>
                                <div className="grid grid-cols-6 gap-1">
                                    <div></div>
                                    <div className="text-center text-sm font-semibold">1</div>
                                    <div className="text-center text-sm font-semibold">2</div>
                                    <div className="text-center text-sm font-semibold">3</div>
                                    <div className="text-center text-sm font-semibold">4</div>
                                    <div className="text-center text-sm font-semibold">5</div>

                                    {[5, 4, 3, 2, 1].map(prob => (
                                        <React.Fragment key={prob}>
                                            <div className="text-right text-sm font-semibold pr-2">{prob}</div>
                                            {[1, 2, 3, 4, 5].map(imp => {
                                                const score = prob * imp;
                                                const cellRisks = projectRisks.filter(r => r.probability === prob && r.impact === imp);
                                                const bgColor = score >= 15 ? 'bg-red-100' :
                                                              score >= 10 ? 'bg-orange-100' :
                                                              score >= 5 ? 'bg-yellow-100' : 'bg-green-100';
                                                return (
                                                    <div key={`${prob}-${imp}`} className={`${bgColor} border p-2 min-h-[60px] text-xs`}>
                                                        {cellRisks.map(r => (
                                                            <div key={r.id} className="mb-1 p-1 bg-white rounded text-xs">
                                                                {r.title}
                                                            </div>
                                                        ))}
                                                    </div>
                                                );
                                            })}
                                        </React.Fragment>
                                    ))}
                                </div>
                                <div className="mt-4 text-sm text-gray-600">
                                    <p><strong>Eixo Vertical:</strong> Probabilidade (1=Muito Baixa, 5=Muito Alta)</p>
                                    <p><strong>Eixo Horizontal:</strong> Impacto (1=Muito Baixo, 5=Muito Alto)</p>
                                </div>
                            </div>
                        )}

                        {showRiskModal && (
                            <RiskModal
                                risk={editingRisk}
                                projectId={activeProject.id}
                                onSave={(risk) => {
                                    if (editingRisk) {
                                        setRisks(risks.map(r => r.id === risk.id ? risk : r));
                                        addNotification('success', 'Risco Atualizado', 'Risco editado com sucesso!');
                                    } else {
                                        setRisks([...risks, risk]);
                                        addNotification('success', 'Risco Criado', 'Novo risco adicionado!');
                                    }
                                    setShowRiskModal(false);
                                    setEditingRisk(null);
                                }}
                                onClose={() => {
                                    setShowRiskModal(false);
                                    setEditingRisk(null);
                                }}
                            />
                        )}
                    </div>
                );
            };

            // Modal de Risco
            const RiskModal = ({ risk, projectId, onSave, onClose }) => {
                const [formData, setFormData] = useState(risk || {
                    title: '',
                    description: '',
                    category: 'technical',
                    probability: 3,
                    impact: 3,
                    status: 'open',
                    mitigation: '',
                    owner: ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        ...formData,
                        id: risk?.id || Date.now(),
                        projectId: projectId,
                        createdAt: risk?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg p-6 w-full max-w-lg">
                            <h3 className="text-xl font-bold mb-4">
                                {risk ? 'Editar Risco' : 'Novo Risco'}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">T√≠tulo do Risco</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            required
                                            value={formData.title}
                                            onChange={(e) => setFormData({...formData, title: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Descri√ß√£o</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="3"
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Categoria</label>
                                            <select
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.category}
                                                onChange={(e) => setFormData({...formData, category: e.target.value})}
                                            >
                                                <option value="technical">T√©cnico</option>
                                                <option value="financial">Financeiro</option>
                                                <option value="operational">Operacional</option>
                                                <option value="external">Externo</option>
                                                <option value="organizational">Organizacional</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Status</label>
                                            <select
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.status}
                                                onChange={(e) => setFormData({...formData, status: e.target.value})}
                                            >
                                                <option value="open">Aberto</option>
                                                <option value="mitigated">Mitigado</option>
                                                <option value="closed">Fechado</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Probabilidade (1-5)</label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="5"
                                                className="w-full"
                                                value={formData.probability}
                                                onChange={(e) => setFormData({...formData, probability: parseInt(e.target.value)})}
                                            />
                                            <div className="text-center text-sm font-semibold">{formData.probability}</div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Impacto (1-5)</label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="5"
                                                className="w-full"
                                                value={formData.impact}
                                                onChange={(e) => setFormData({...formData, impact: parseInt(e.target.value)})}
                                            />
                                            <div className="text-center text-sm font-semibold">{formData.impact}</div>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Plano de Mitiga√ß√£o</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="3"
                                            value={formData.mitigation}
                                            onChange={(e) => setFormData({...formData, mitigation: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Respons√°vel</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            value={formData.owner}
                                            onChange={(e) => setFormData({...formData, owner: e.target.value})}
                                        />
                                    </div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 border rounded hover:bg-gray-50"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                                    >
                                        Salvar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Stakeholders
            const StakeholdersView = () => {
                const [showStakeholderModal, setShowStakeholderModal] = useState(false);
                const [editingStakeholder, setEditingStakeholder] = useState(null);
                const [viewMode, setViewMode] = useState('list'); // 'list' ou 'matrix'

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar stakeholders</p>
                        </div>
                    );
                }

                const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject.id);

                const deleteStakeholder = (stakeholderId) => {
                    if (confirm('Deseja realmente deletar este stakeholder?')) {
                        setStakeholders(stakeholders.filter(s => s.id !== stakeholderId));
                        addNotification('success', 'Stakeholder Deletado', 'Stakeholder removido com sucesso!');
                    }
                };

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gest√£o de Stakeholders - {activeProject.name}</h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setViewMode(viewMode === 'list' ? 'matrix' : 'list')}
                                    className="px-3 py-2 border rounded text-sm hover:bg-gray-50"
                                >
                                    {viewMode === 'list' ? 'üìä Matriz' : 'üìã Lista'}
                                </button>
                                <button
                                    onClick={() => {
                                        setEditingStakeholder(null);
                                        setShowStakeholderModal(true);
                                    }}
                                    className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
                                >
                                    + Novo Stakeholder
                                </button>
                            </div>
                        </div>

                        {viewMode === 'list' ? (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="text-left p-3">Nome</th>
                                            <th className="text-left p-3">Cargo</th>
                                            <th className="text-left p-3">Organiza√ß√£o</th>
                                            <th className="text-left p-3">Poder</th>
                                            <th className="text-left p-3">Interesse</th>
                                            <th className="text-left p-3">Estrat√©gia</th>
                                            <th className="text-left p-3">Contato</th>
                                            <th className="text-left p-3">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {projectStakeholders.map(stakeholder => (
                                            <tr key={stakeholder.id} className="border-b hover:bg-gray-50">
                                                <td className="p-3 font-semibold">{stakeholder.name}</td>
                                                <td className="p-3">{stakeholder.role}</td>
                                                <td className="p-3">{stakeholder.organization}</td>
                                                <td className="p-3">
                                                    <span className={`text-xs px-2 py-1 rounded ${
                                                        stakeholder.power >= 4 ? 'bg-red-100 text-red-800' :
                                                        stakeholder.power >= 3 ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-green-100 text-green-800'
                                                    }`}>
                                                        {stakeholder.power}/5
                                                    </span>
                                                </td>
                                                <td className="p-3">
                                                    <span className={`text-xs px-2 py-1 rounded ${
                                                        stakeholder.interest >= 4 ? 'bg-blue-100 text-blue-800' :
                                                        stakeholder.interest >= 3 ? 'bg-indigo-100 text-indigo-800' :
                                                        'bg-gray-100 text-gray-800'
                                                    }`}>
                                                        {stakeholder.interest}/5
                                                    </span>
                                                </td>
                                                <td className="p-3">
                                                    <span className="text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded">
                                                        {stakeholder.strategy}
                                                    </span>
                                                </td>
                                                <td className="p-3 text-sm">{stakeholder.contact}</td>
                                                <td className="p-3">
                                                    <div className="flex gap-1">
                                                        <button
                                                            onClick={() => {
                                                                setEditingStakeholder(stakeholder);
                                                                setShowStakeholderModal(true);
                                                            }}
                                                            className="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                        >
                                                            Editar
                                                        </button>
                                                        <button
                                                            onClick={() => deleteStakeholder(stakeholder.id)}
                                                            className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                                                        >
                                                            Deletar
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div>
                                <h3 className="font-semibold mb-4">Matriz Poder x Interesse</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="border-2 border-orange-500 p-4 min-h-[200px] bg-orange-50">
                                        <h4 className="font-semibold mb-2">Gerenciar de Perto</h4>
                                        <p className="text-xs text-gray-600 mb-2">Alto Poder + Alto Interesse</p>
                                        {projectStakeholders
                                            .filter(s => s.power >= 4 && s.interest >= 4)
                                            .map(s => (
                                                <div key={s.id} className="bg-white p-2 mb-2 rounded text-sm">
                                                    <strong>{s.name}</strong> - {s.role}
                                                </div>
                                            ))}
                                    </div>
                                    <div className="border-2 border-blue-500 p-4 min-h-[200px] bg-blue-50">
                                        <h4 className="font-semibold mb-2">Manter Satisfeito</h4>
                                        <p className="text-xs text-gray-600 mb-2">Alto Poder + Baixo Interesse</p>
                                        {projectStakeholders
                                            .filter(s => s.power >= 4 && s.interest < 4)
                                            .map(s => (
                                                <div key={s.id} className="bg-white p-2 mb-2 rounded text-sm">
                                                    <strong>{s.name}</strong> - {s.role}
                                                </div>
                                            ))}
                                    </div>
                                    <div className="border-2 border-green-500 p-4 min-h-[200px] bg-green-50">
                                        <h4 className="font-semibold mb-2">Manter Informado</h4>
                                        <p className="text-xs text-gray-600 mb-2">Baixo Poder + Alto Interesse</p>
                                        {projectStakeholders
                                            .filter(s => s.power < 4 && s.interest >= 4)
                                            .map(s => (
                                                <div key={s.id} className="bg-white p-2 mb-2 rounded text-sm">
                                                    <strong>{s.name}</strong> - {s.role}
                                                </div>
                                            ))}
                                    </div>
                                    <div className="border-2 border-gray-500 p-4 min-h-[200px] bg-gray-50">
                                        <h4 className="font-semibold mb-2">Monitorar</h4>
                                        <p className="text-xs text-gray-600 mb-2">Baixo Poder + Baixo Interesse</p>
                                        {projectStakeholders
                                            .filter(s => s.power < 4 && s.interest < 4)
                                            .map(s => (
                                                <div key={s.id} className="bg-white p-2 mb-2 rounded text-sm">
                                                    <strong>{s.name}</strong> - {s.role}
                                                </div>
                                            ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {showStakeholderModal && (
                            <StakeholderModal
                                stakeholder={editingStakeholder}
                                projectId={activeProject.id}
                                onSave={(stakeholder) => {
                                    if (editingStakeholder) {
                                        setStakeholders(stakeholders.map(s => s.id === stakeholder.id ? stakeholder : s));
                                        addNotification('success', 'Stakeholder Atualizado', 'Stakeholder editado com sucesso!');
                                    } else {
                                        setStakeholders([...stakeholders, stakeholder]);
                                        addNotification('success', 'Stakeholder Criado', 'Novo stakeholder adicionado!');
                                    }
                                    setShowStakeholderModal(false);
                                    setEditingStakeholder(null);
                                }}
                                onClose={() => {
                                    setShowStakeholderModal(false);
                                    setEditingStakeholder(null);
                                }}
                            />
                        )}
                    </div>
                );
            };

            // Modal de Stakeholder
            const StakeholderModal = ({ stakeholder, projectId, onSave, onClose }) => {
                const [formData, setFormData] = useState(stakeholder || {
                    name: '',
                    role: '',
                    organization: '',
                    power: 3,
                    interest: 3,
                    strategy: 'manage',
                    contact: '',
                    expectations: '',
                    influence: ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();

                    // Auto-determinar estrat√©gia baseada em poder e interesse
                    let strategy = 'monitor';
                    if (formData.power >= 4 && formData.interest >= 4) strategy = 'manage';
                    else if (formData.power >= 4 && formData.interest < 4) strategy = 'satisfy';
                    else if (formData.power < 4 && formData.interest >= 4) strategy = 'inform';

                    onSave({
                        ...formData,
                        strategy,
                        id: stakeholder?.id || Date.now(),
                        projectId: projectId,
                        createdAt: stakeholder?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto">
                            <h3 className="text-xl font-bold mb-4">
                                {stakeholder ? 'Editar Stakeholder' : 'Novo Stakeholder'}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Nome Completo</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Cargo</label>
                                            <input
                                                type="text"
                                                className="w-full border rounded px-3 py-2"
                                                required
                                                value={formData.role}
                                                onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Organiza√ß√£o</label>
                                            <input
                                                type="text"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.organization}
                                                onChange={(e) => setFormData({...formData, organization: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Poder/Influ√™ncia (1-5)</label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="5"
                                                className="w-full"
                                                value={formData.power}
                                                onChange={(e) => setFormData({...formData, power: parseInt(e.target.value)})}
                                            />
                                            <div className="text-center text-sm font-semibold">{formData.power}</div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Interesse (1-5)</label>
                                            <input
                                                type="range"
                                                min="1"
                                                max="5"
                                                className="w-full"
                                                value={formData.interest}
                                                onChange={(e) => setFormData({...formData, interest: parseInt(e.target.value)})}
                                            />
                                            <div className="text-center text-sm font-semibold">{formData.interest}</div>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Contato (Email/Telefone)</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            value={formData.contact}
                                            onChange={(e) => setFormData({...formData, contact: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Expectativas</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="2"
                                            value={formData.expectations}
                                            onChange={(e) => setFormData({...formData, expectations: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Forma de Influ√™ncia</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="2"
                                            value={formData.influence}
                                            onChange={(e) => setFormData({...formData, influence: e.target.value})}
                                        />
                                    </div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 border rounded hover:bg-gray-50"
                                    >
                                        Cancelar
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
                                    >
                                        Salvar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Componente WBS (Work Breakdown Structure)
            const WBSView = () => {
                const [wbsItems, setWbsItems] = useState([]);
                const [showWBSModal, setShowWBSModal] = useState(false);

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar WBS</p>
                        </div>
                    );
                }

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">WBS - {activeProject.name}</h2>
                            <button
                                onClick={() => setShowWBSModal(true)}
                                className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                            >
                                + Adicionar Item WBS
                            </button>
                        </div>
                        <div className="border rounded p-4">
                            <div className="mb-4">
                                <h3 className="font-semibold text-lg">{activeProject.name}</h3>
                                <p className="text-sm text-gray-600">Estrutura Anal√≠tica do Projeto</p>
                            </div>
                            <div className="pl-6">
                                <p className="text-gray-500 italic">Configure a estrutura hier√°rquica de trabalho do projeto</p>
                                <p className="text-sm text-gray-400 mt-2">Decomponha o projeto em componentes menores e gerenci√°veis</p>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Mudan√ßas
            const ChangesView = () => {
                const [showChangeModal, setShowChangeModal] = useState(false);

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar mudan√ßas</p>
                        </div>
                    );
                }

                const projectChanges = changes.filter(c => c.projectId === activeProject.id);

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gest√£o de Mudan√ßas - {activeProject.name}</h2>
                            <button
                                onClick={() => setShowChangeModal(true)}
                                className="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"
                            >
                                + Solicitar Mudan√ßa
                            </button>
                        </div>
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="text-left p-3">ID</th>
                                    <th className="text-left p-3">Descri√ß√£o</th>
                                    <th className="text-left p-3">Status</th>
                                    <th className="text-left p-3">Impacto</th>
                                    <th className="text-left p-3">Data</th>
                                </tr>
                            </thead>
                            <tbody>
                                {projectChanges.length === 0 ? (
                                    <tr>
                                        <td colSpan="5" className="text-center p-4 text-gray-500">Nenhuma mudan√ßa registrada</td>
                                    </tr>
                                ) : (
                                    projectChanges.map(change => (
                                        <tr key={change.id} className="border-b">
                                            <td className="p-3">#{change.id}</td>
                                            <td className="p-3">{change.description}</td>
                                            <td className="p-3">
                                                <span className={`text-xs px-2 py-1 rounded ${
                                                    change.status === 'approved' ? 'bg-green-100 text-green-800' :
                                                    change.status === 'rejected' ? 'bg-red-100 text-red-800' :
                                                    'bg-yellow-100 text-yellow-800'
                                                }`}>
                                                    {change.status}
                                                </span>
                                            </td>
                                            <td className="p-3">{change.impact}</td>
                                            <td className="p-3">{new Date(change.createdAt).toLocaleDateString('pt-BR')}</td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    </div>
                );
            };

            // Componente de Li√ß√µes Aprendidas
            const LessonsView = () => {
                const [showLessonModal, setShowLessonModal] = useState(false);

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para registrar li√ß√µes aprendidas</p>
                        </div>
                    );
                }

                const projectLessons = lessons.filter(l => l.projectId === activeProject.id);

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Li√ß√µes Aprendidas - {activeProject.name}</h2>
                            <button
                                onClick={() => setShowLessonModal(true)}
                                className="px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600"
                            >
                                + Registrar Li√ß√£o
                            </button>
                        </div>
                        <div className="grid grid-cols-1 gap-4">
                            {projectLessons.length === 0 ? (
                                <p className="text-gray-500 text-center p-4">Nenhuma li√ß√£o registrada ainda</p>
                            ) : (
                                projectLessons.map(lesson => (
                                    <div key={lesson.id} className="border rounded p-4">
                                        <div className="flex justify-between items-start mb-2">
                                            <h3 className="font-semibold">{lesson.title}</h3>
                                            <span className="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded">
                                                {lesson.category}
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-2">{lesson.description}</p>
                                        <p className="text-xs text-gray-500">
                                            {new Date(lesson.createdAt).toLocaleDateString('pt-BR')}
                                        </p>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Entregas
            const DeliverablesView = () => {
                const [showDeliverableModal, setShowDeliverableModal] = useState(false);

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar entregas</p>
                        </div>
                    );
                }

                const projectDeliverables = deliverables.filter(d => d.projectId === activeProject.id);

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gest√£o de Entregas - {activeProject.name}</h2>
                            <button
                                onClick={() => setShowDeliverableModal(true)}
                                className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                            >
                                + Nova Entrega
                            </button>
                        </div>
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="text-left p-3">Entrega</th>
                                    <th className="text-left p-3">Status</th>
                                    <th className="text-left p-3">Prazo</th>
                                    <th className="text-left p-3">Aprovado</th>
                                </tr>
                            </thead>
                            <tbody>
                                {projectDeliverables.length === 0 ? (
                                    <tr>
                                        <td colSpan="4" className="text-center p-4 text-gray-500">Nenhuma entrega cadastrada</td>
                                    </tr>
                                ) : (
                                    projectDeliverables.map(deliverable => (
                                        <tr key={deliverable.id} className="border-b">
                                            <td className="p-3 font-semibold">{deliverable.name}</td>
                                            <td className="p-3">
                                                <span className={`text-xs px-2 py-1 rounded ${
                                                    deliverable.status === 'delivered' ? 'bg-green-100 text-green-800' :
                                                    deliverable.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-gray-100 text-gray-800'
                                                }`}>
                                                    {deliverable.status}
                                                </span>
                                            </td>
                                            <td className="p-3">{deliverable.dueDate ? new Date(deliverable.dueDate).toLocaleDateString('pt-BR') : '-'}</td>
                                            <td className="p-3">{deliverable.approved ? '‚úì' : '-'}</td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    </div>
                );
            };

            // Componente de M√©tricas de Qualidade
            const QualityView = () => {
                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar qualidade</p>
                        </div>
                    );
                }

                const projectQuality = qualityMetrics.filter(q => q.projectId === activeProject.id);

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-6">M√©tricas de Qualidade - {activeProject.name}</h2>
                        <div className="grid grid-cols-2 gap-4 mb-6">
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">√çndice de Qualidade</p>
                                <p className="text-3xl font-bold text-green-600">95%</p>
                            </div>
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Defeitos Encontrados</p>
                                <p className="text-3xl font-bold text-orange-600">{projectQuality.length}</p>
                            </div>
                        </div>
                        <div>
                            <h3 className="font-semibold mb-3">Padr√µes de Qualidade</h3>
                            <ul className="space-y-2">
                                <li className="flex items-center gap-2">
                                    <span className="text-green-500">‚úì</span>
                                    <span>Revis√£o de c√≥digo implementada</span>
                                </li>
                                <li className="flex items-center gap-2">
                                    <span className="text-green-500">‚úì</span>
                                    <span>Testes automatizados configurados</span>
                                </li>
                                <li className="flex items-center gap-2">
                                    <span className="text-green-500">‚úì</span>
                                    <span>Documenta√ß√£o atualizada</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                );
            };

            // Componente de Comunica√ß√µes
            const CommunicationsView = () => {
                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar comunica√ß√µes</p>
                        </div>
                    );
                }

                const projectComms = communications.filter(c => c.projectId === activeProject.id);

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-6">Plano de Comunica√ß√µes - {activeProject.name}</h2>
                        <div className="mb-6">
                            <h3 className="font-semibold mb-3">Matriz de Comunica√ß√£o</h3>
                            <table className="w-full text-sm">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="text-left p-2">Informa√ß√£o</th>
                                        <th className="text-left p-2">P√∫blico</th>
                                        <th className="text-left p-2">Frequ√™ncia</th>
                                        <th className="text-left p-2">M√©todo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr className="border-b">
                                        <td className="p-2">Status Report</td>
                                        <td className="p-2">Stakeholders</td>
                                        <td className="p-2">Semanal</td>
                                        <td className="p-2">Email</td>
                                    </tr>
                                    <tr className="border-b">
                                        <td className="p-2">Daily Standup</td>
                                        <td className="p-2">Equipe</td>
                                        <td className="p-2">Di√°ria</td>
                                        <td className="p-2">Presencial</td>
                                    </tr>
                                    <tr className="border-b">
                                        <td className="p-2">Apresenta√ß√£o Executiva</td>
                                        <td className="p-2">Diretoria</td>
                                        <td className="p-2">Mensal</td>
                                        <td className="p-2">Reuni√£o</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Recursos
            const ResourcesView = () => {
                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar recursos</p>
                        </div>
                    );
                }

                const projectResources = resources.filter(r => r.projectId === activeProject.id);

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-6">Gest√£o de Recursos - {activeProject.name}</h2>
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Recursos Humanos</p>
                                <p className="text-2xl font-bold">{projectResources.filter(r => r.type === 'human').length}</p>
                            </div>
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Recursos Materiais</p>
                                <p className="text-2xl font-bold">{projectResources.filter(r => r.type === 'material').length}</p>
                            </div>
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Taxa de Aloca√ß√£o</p>
                                <p className="text-2xl font-bold">85%</p>
                            </div>
                        </div>
                        <div>
                            <h3 className="font-semibold mb-3">Equipe do Projeto</h3>
                            <div className="space-y-2">
                                <p className="text-gray-500 italic">Configure os recursos necess√°rios para o projeto</p>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Custos
            const CostsView = () => {
                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar custos</p>
                        </div>
                    );
                }

                const budget = parseFloat(activeProject.budget?.replace(/[^0-9.-]+/g,"") || 0);
                const actualCost = budget * 0.65;
                const variance = budget - actualCost;

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-6">Gest√£o de Custos - {activeProject.name}</h2>
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Or√ßamento (BAC)</p>
                                <p className="text-2xl font-bold text-blue-600">
                                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(budget)}
                                </p>
                            </div>
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Custo Real (AC)</p>
                                <p className="text-2xl font-bold text-orange-600">
                                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(actualCost)}
                                </p>
                            </div>
                            <div className="border rounded p-4">
                                <p className="text-sm text-gray-600">Varia√ß√£o (CV)</p>
                                <p className={`text-2xl font-bold ${variance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(variance)}
                                </p>
                            </div>
                        </div>
                        <div className="mb-6">
                            <h3 className="font-semibold mb-2">An√°lise de Valor Agregado (EVM)</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="border rounded p-3">
                                    <p className="text-xs text-gray-600">CPI (Cost Performance Index)</p>
                                    <p className="text-xl font-bold text-green-600">1.15</p>
                                </div>
                                <div className="border rounded p-3">
                                    <p className="text-xs text-gray-600">SPI (Schedule Performance Index)</p>
                                    <p className="text-xl font-bold text-green-600">1.08</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Gest√£o de Issues
            const IssuesView = () => {
                const [showIssueModal, setShowIssueModal] = useState(false);

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerenciar issues</p>
                        </div>
                    );
                }

                const sampleIssues = [
                    { id: 1, title: 'Atraso na entrega do m√≥dulo X', status: 'open', priority: 'high', createdAt: new Date() },
                    { id: 2, title: 'Conflito de recursos', status: 'in_progress', priority: 'medium', createdAt: new Date() }
                ];

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gest√£o de Issues - {activeProject.name}</h2>
                            <button
                                onClick={() => setShowIssueModal(true)}
                                className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
                            >
                                + Registrar Issue
                            </button>
                        </div>
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="text-left p-3">Issue</th>
                                    <th className="text-left p-3">Prioridade</th>
                                    <th className="text-left p-3">Status</th>
                                    <th className="text-left p-3">Data</th>
                                </tr>
                            </thead>
                            <tbody>
                                {sampleIssues.map(issue => (
                                    <tr key={issue.id} className="border-b">
                                        <td className="p-3 font-semibold">{issue.title}</td>
                                        <td className="p-3">
                                            <span className={`text-xs px-2 py-1 rounded ${
                                                issue.priority === 'high' ? 'bg-red-100 text-red-800' :
                                                issue.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-green-100 text-green-800'
                                            }`}>
                                                {issue.priority}
                                            </span>
                                        </td>
                                        <td className="p-3">
                                            <span className={`text-xs px-2 py-1 rounded ${
                                                issue.status === 'open' ? 'bg-red-100 text-red-800' :
                                                issue.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-green-100 text-green-800'
                                            }`}>
                                                {issue.status}
                                            </span>
                                        </td>
                                        <td className="p-3">{new Date(issue.createdAt).toLocaleDateString('pt-BR')}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            };

            // Componente de Relat√≥rios
            const ReportsView = () => {
                const [reportType, setReportType] = useState('executive');

                if (!activeProject) {
                    return (
                        <div className="bg-white rounded-lg shadow p-6">
                            <p className="text-gray-500 text-center">Selecione um projeto para gerar relat√≥rios</p>
                        </div>
                    );
                }

                const projectTasks = tasks.filter(t => t.projectId === activeProject.id);
                const projectRisks = risks.filter(r => r.projectId === activeProject.id);
                const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject.id);

                const completedTasks = projectTasks.filter(t => t.status === 'done').length;
                const totalTasks = projectTasks.length;
                const progress = totalTasks > 0 ? ((completedTasks / totalTasks) * 100).toFixed(1) : 0;

                const openRisks = projectRisks.filter(r => r.status === 'open').length;
                const criticalRisks = projectRisks.filter(r => r.probability * r.impact >= 15).length;

                return (
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Relat√≥rios - {activeProject.name}</h2>
                            <div className="flex gap-2">
                                <select
                                    value={reportType}
                                    onChange={(e) => setReportType(e.target.value)}
                                    className="border rounded px-3 py-2 text-sm"
                                >
                                    <option value="executive">Executivo</option>
                                    <option value="detailed">Detalhado</option>
                                    <option value="risks">Riscos</option>
                                    <option value="stakeholders">Stakeholders</option>
                                </select>
                                <button
                                    onClick={exportToPDF}
                                    className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                >
                                    Exportar PDF
                                </button>
                            </div>
                        </div>

                        {reportType === 'executive' && (
                            <div className="space-y-6">
                                <div>
                                    <h3 className="text-lg font-semibold mb-3">Resumo Executivo</h3>
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div className="border rounded p-4">
                                            <p className="text-sm text-gray-600">Status do Projeto</p>
                                            <p className="text-2xl font-bold capitalize">{activeProject.status}</p>
                                        </div>
                                        <div className="border rounded p-4">
                                            <p className="text-sm text-gray-600">Progresso Geral</p>
                                            <p className="text-2xl font-bold">{progress}%</p>
                                            <div className="w-full bg-gray-200 rounded-full h-2 mt-2">
                                                <div
                                                    className="bg-blue-600 h-2 rounded-full"
                                                    style={{ width: `${progress}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                        <div className="border rounded p-4">
                                            <p className="text-sm text-gray-600">Riscos Abertos</p>
                                            <p className="text-2xl font-bold text-red-600">{openRisks}</p>
                                            <p className="text-xs text-gray-500">({criticalRisks} cr√≠ticos)</p>
                                        </div>
                                        <div className="border rounded p-4">
                                            <p className="text-sm text-gray-600">Stakeholders</p>
                                            <p className="text-2xl font-bold">{projectStakeholders.length}</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 className="font-semibold mb-2">Informa√ß√µes do Projeto</h4>
                                    <div className="space-y-2 text-sm">
                                        <p><strong>Nome:</strong> {activeProject.name}</p>
                                        <p><strong>Descri√ß√£o:</strong> {activeProject.description}</p>
                                        <p><strong>In√≠cio:</strong> {activeProject.startDate ? new Date(activeProject.startDate).toLocaleDateString('pt-BR') : 'N/A'}</p>
                                        <p><strong>T√©rmino:</strong> {activeProject.endDate ? new Date(activeProject.endDate).toLocaleDateString('pt-BR') : 'N/A'}</p>
                                        <p><strong>Or√ßamento:</strong> {activeProject.budget || 'N/A'}</p>
                                        <p><strong>Gerente:</strong> {activeProject.manager || 'N/A'}</p>
                                    </div>
                                </div>

                                <div>
                                    <h4 className="font-semibold mb-2">Principais M√©tricas</h4>
                                    <div className="space-y-2 text-sm">
                                        <p><strong>Total de Tarefas:</strong> {totalTasks}</p>
                                        <p><strong>Tarefas Conclu√≠das:</strong> {completedTasks}</p>
                                        <p><strong>Tarefas Pendentes:</strong> {projectTasks.filter(t => t.status === 'todo').length}</p>
                                        <p><strong>Tarefas em Progresso:</strong> {projectTasks.filter(t => t.status === 'in_progress').length}</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {reportType === 'detailed' && (
                            <div className="space-y-6">
                                <div>
                                    <h3 className="text-lg font-semibold mb-3">Relat√≥rio Detalhado</h3>

                                    <div className="mb-6">
                                        <h4 className="font-semibold mb-2">Lista de Tarefas</h4>
                                        <table className="w-full text-sm">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="text-left p-2">Tarefa</th>
                                                    <th className="text-left p-2">Status</th>
                                                    <th className="text-left p-2">Prioridade</th>
                                                    <th className="text-left p-2">Respons√°vel</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {projectTasks.map(task => (
                                                    <tr key={task.id} className="border-b">
                                                        <td className="p-2">{task.title}</td>
                                                        <td className="p-2">{task.status}</td>
                                                        <td className="p-2">{task.priority}</td>
                                                        <td className="p-2">{task.assignedTo || '-'}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {reportType === 'risks' && (
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold mb-3">Relat√≥rio de Riscos</h3>
                                <table className="w-full text-sm">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="text-left p-2">Risco</th>
                                            <th className="text-left p-2">Categoria</th>
                                            <th className="text-left p-2">Prob.</th>
                                            <th className="text-left p-2">Impacto</th>
                                            <th className="text-left p-2">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {projectRisks.map(risk => (
                                            <tr key={risk.id} className="border-b">
                                                <td className="p-2">{risk.title}</td>
                                                <td className="p-2">{risk.category}</td>
                                                <td className="p-2">{risk.probability}/5</td>
                                                <td className="p-2">{risk.impact}/5</td>
                                                <td className="p-2">{risk.status}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {reportType === 'stakeholders' && (
                            <div className="space-y-4">
                                <h3 className="text-lg font-semibold mb-3">Relat√≥rio de Stakeholders</h3>
                                <table className="w-full text-sm">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="text-left p-2">Nome</th>
                                            <th className="text-left p-2">Cargo</th>
                                            <th className="text-left p-2">Poder</th>
                                            <th className="text-left p-2">Interesse</th>
                                            <th className="text-left p-2">Estrat√©gia</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {projectStakeholders.map(stakeholder => (
                                            <tr key={stakeholder.id} className="border-b">
                                                <td className="p-2">{stakeholder.name}</td>
                                                <td className="p-2">{stakeholder.role}</td>
                                                <td className="p-2">{stakeholder.power}/5</td>
                                                <td className="p-2">{stakeholder.interest}/5</td>
                                                <td className="p-2">{stakeholder.strategy}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                );
            };

            // Componente de Chat Assistente com IA
            const AIChatAssistant = () => {
                const [input, setInput] = useState('');
                const messagesEndRef = useRef(null);

                const scrollToBottom = () => {
                    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                };

                useEffect(() => {
                    scrollToBottom();
                }, [aiMessages]);

                const handleSendMessage = async () => {
                    if (!input.trim() || aiLoading) return;

                    const userMessage = input.trim();
                    setInput('');

                    // Adiciona mensagem do usu√°rio
                    const newMessages = [...aiMessages, { role: 'user', content: userMessage }];
                    setAiMessages(newMessages);

                    // Contexto do projeto atual
                    let context = '';
                    if (activeProject) {
                        context = `Contexto: O usu√°rio est√° trabalhando no projeto "${activeProject.name}". `;
                        if (activeProject.description) context += `Descri√ß√£o: ${activeProject.description}. `;
                    }

                    // Busca no manual do usu√°rio
                    const manualContext = searchUserManual(userMessage);
                    if (manualContext) {
                        context += manualContext;
                        context += '\nUSE AS INFORMA√á√ïES DO MANUAL ACIMA como base principal para responder. Se a pergunta for sobre como usar o sistema, responda APENAS com base no manual.\n';
                    }

                    // Chama a API
                    const aiResponse = await callGeminiAPI(
                        `Voc√™ √© um assistente especializado em gest√£o de projetos e PMBOK 7. Responda de forma profissional, clara e objetiva.\n\nPergunta do usu√°rio: ${userMessage}`,
                        context
                    );

                    if (aiResponse) {
                        setAiMessages([...newMessages, { role: 'assistant', content: aiResponse }]);
                    }
                };

                return (
                    <>
                        {/* Bot√£o Flutuante */}
                        {!aiChatOpen && (
                            <button
                                onClick={() => setAiChatOpen(true)}
                                className="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-200 flex items-center justify-center z-50"
                                title="Assistente IA"
                            >
                                <span className="text-2xl">ü§ñ</span>
                            </button>
                        )}

                        {/* Janela de Chat */}
                        {aiChatOpen && (
                            <div className="fixed bottom-6 right-6 w-96 h-[600px] bg-white rounded-lg shadow-2xl z-50 flex flex-col">
                                {/* Header */}
                                <div className="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-lg flex justify-between items-center">
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl">ü§ñ</span>
                                        <div>
                                            <h3 className="font-bold">Assistente IA PMBOK</h3>
                                            <p className="text-xs opacity-90">Powered by Google Gemini</p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setAiChatOpen(false)}
                                        className="text-white hover:bg-white/20 rounded p-1"
                                    >
                                        ‚úï
                                    </button>
                                </div>

                                {/* Messages */}
                                <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
                                    {aiMessages.length === 0 ? (
                                        <div className="text-center text-gray-500 mt-8">
                                            <p className="text-4xl mb-4">üëã</p>
                                            <p className="font-semibold">Ol√°! Sou seu assistente de IA.</p>
                                            <p className="text-sm mt-2">üí° Agora com busca integrada no Manual do Usu√°rio!</p>
                                            <div className="mt-3 text-xs space-y-1">
                                                <p>‚Ä¢ Como usar o sistema</p>
                                                <p>‚Ä¢ Gest√£o de projetos PMBOK 7</p>
                                                <p>‚Ä¢ An√°lise de riscos</p>
                                                <p>‚Ä¢ Sugest√µes de tarefas</p>
                                                <p>‚Ä¢ Melhores pr√°ticas</p>
                                                <p className="text-blue-600 font-semibold mt-2">üìö Busca autom√°tica no manual!</p>
                                            </div>
                                        </div>
                                    ) : (
                                        aiMessages.map((msg, index) => (
                                            <div
                                                key={index}
                                                className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                                            >
                                                <div
                                                    className={`max-w-[80%] rounded-lg p-3 ${
                                                        msg.role === 'user'
                                                            ? 'bg-blue-500 text-white'
                                                            : 'bg-white border border-gray-200'
                                                    }`}
                                                >
                                                    <p className="text-sm whitespace-pre-wrap">{msg.content}</p>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                    {aiLoading && (
                                        <div className="flex justify-start">
                                            <div className="bg-white border border-gray-200 rounded-lg p-3">
                                                <div className="flex items-center gap-2">
                                                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div>
                                                    <span className="text-sm text-gray-600">Pensando...</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    <div ref={messagesEndRef} />
                                </div>

                                {/* Input */}
                                <div className="p-4 border-t">
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={input}
                                            onChange={(e) => setInput(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                                            placeholder="Digite sua pergunta..."
                                            className="flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            disabled={aiLoading}
                                        />
                                        <button
                                            onClick={handleSendMessage}
                                            disabled={aiLoading || !input.trim()}
                                            className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            ‚û§
                                        </button>
                                    </div>
                                    {activeProject && (
                                        <p className="text-xs text-gray-500 mt-2">
                                            üìÇ Projeto ativo: {activeProject.name}
                                        </p>
                                    )}
                                </div>
                            </div>
                        )}
                    </>
                );
            };

            // Modal de Projeto
            const ProjectModal = ({ project, onSave, onClose }) => {
                const [formData, setFormData] = useState(project || {
                    name: '',
                    description: '',
                    startDate: '',
                    endDate: '',
                    budget: '',
                    status: 'planning',
                    manager: currentUser?.name || ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        ...formData,
                        id: project?.id || Date.now(),
                        userId: currentUser?.id,
                        createdAt: project?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md">
                            <h3 className="text-xl font-bold mb-4">
                                {project ? 'Editar Projeto' : t('newProject')}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('projectName')}</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('description')}</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="3"
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">{t('startDate')}</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.startDate}
                                                onChange={(e) => setFormData({...formData, startDate: e.target.value})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">{t('endDate')}</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.endDate}
                                                onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('budget')}</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="R$ 0,00"
                                            value={formData.budget}
                                            onChange={(e) => setFormData({...formData, budget: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('status')}</label>
                                        <select
                                            className="w-full border rounded px-3 py-2"
                                            value={formData.status}
                                            onChange={(e) => setFormData({...formData, status: e.target.value})}
                                        >
                                            <option value="planning">{t('planning')}</option>
                                            <option value="active">{t('active')}</option>
                                            <option value="on-hold">{t('onHold')}</option>
                                            <option value="completed">{t('completed')}</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 border rounded hover:bg-gray-50"
                                    >
                                        {t('cancel')}
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                    >
                                        {t('save')}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Layout Principal
            const MainLayout = () => {
                const handleLogout = () => {
                    setCurrentUser(null);
                    setIsLoggedIn(false);
                    setShowLogin(true);
                    localStorage.removeItem('pmbok_currentUser');
                    addNotification('info', 'Logout', 'Voc√™ saiu do sistema');
                };

                const menuItems = [
                    { id: 'dashboard', name: t('dashboard'), icon: 'layout-dashboard' },
                    { id: 'projects', name: t('projects'), icon: 'folder' },
                    { id: 'tasks', name: 'Tarefas', icon: 'check-square' },
                    { id: 'risks', name: 'Riscos', icon: 'alert-triangle' },
                    { id: 'stakeholders', name: 'Stakeholders', icon: 'users' },
                    { id: 'wbs', name: 'WBS', icon: 'network' },
                    { id: 'changes', name: 'Mudan√ßas', icon: 'git-pull-request' },
                    { id: 'lessons', name: 'Li√ß√µes', icon: 'book-open' },
                    { id: 'deliverables', name: 'Entregas', icon: 'package' },
                    { id: 'quality', name: 'Qualidade', icon: 'award' },
                    { id: 'communications', name: 'Comunica√ß√µes', icon: 'message-square' },
                    { id: 'resources', name: 'Recursos', icon: 'briefcase' },
                    { id: 'costs', name: 'Custos', icon: 'dollar-sign' },
                    { id: 'issues', name: 'Issues', icon: 'alert-circle' },
                    { id: 'reports', name: 'Relat√≥rios', icon: 'file-text' },
                    { id: 'settings', name: t('settings'), icon: 'settings' }
                ];

                return (
                    <div className={`min-h-screen ${darkMode ? 'dark bg-gray-900' : 'bg-gray-50'}`}>
                        {/* Header */}
                        <header className="bg-white shadow-sm border-b">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex justify-between items-center h-16">
                                    <div className="flex items-center">
                                        <h1 className="text-xl font-bold">Project Manager System Pro</h1>
                                        <select
                                            className="ml-4 border rounded px-2 py-1"
                                            value={activeProject?.id || ''}
                                            onChange={(e) => {
                                                const project = projects.find(p => p.id === parseInt(e.target.value));
                                                setActiveProject(project);
                                            }}
                                        >
                                            <option value="">Selecione um projeto</option>
                                            {projects
                                                .filter(p => !currentUser || p.userId === currentUser.id)
                                                .map(project => (
                                                    <option key={project.id} value={project.id}>{project.name}</option>
                                                ))}
                                        </select>
                                        <button
                                            onClick={() => setShowModal('project')}
                                            className="ml-2 px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600"
                                        >
                                            <i data-lucide="plus" className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <button
                                            onClick={() => setDarkMode(!darkMode)}
                                            className="p-2 rounded hover:bg-gray-100"
                                        >
                                            <i data-lucide={darkMode ? 'sun' : 'moon'} className="w-5 h-5"></i>
                                        </button>
                                        <button
                                            onClick={() => setLanguage(language === 'pt' ? 'en' : 'pt')}
                                            className="px-3 py-1 border rounded text-sm"
                                        >
                                            {language === 'pt' ? 'EN' : 'PT'}
                                        </button>
                                        <div className="flex items-center gap-2">
                                            <span className="text-sm">{currentUser?.name}</span>
                                            <button
                                                onClick={handleLogout}
                                                className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                            >
                                                {t('logout')}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="flex">
                            {/* Sidebar */}
                            <div className="w-64 bg-white shadow-md h-screen">
                                <nav className="p-4">
                                    <ul className="space-y-2">
                                        {menuItems.map(item => (
                                            <li key={item.id}>
                                                <button
                                                    onClick={() => setActiveView(item.id)}
                                                    className={`w-full text-left px-3 py-2 rounded flex items-center gap-3 ${
                                                        activeView === item.id 
                                                            ? 'bg-blue-50 text-blue-600' 
                                                            : 'text-gray-700 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    <i data-lucide={item.icon} className="w-4 h-4"></i>
                                                    {item.name}
                                                </button>
                                            </li>
                                        ))}
                                    </ul>
                                </nav>
                            </div>

                            {/* Main Content */}
                            <div className="flex-1 p-6">
                                {activeView === 'dashboard' && <Dashboard />}
                                {activeView === 'projects' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">{t('projects')}</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {projects
                                                .filter(p => !currentUser || p.userId === currentUser.id)
                                                .map(project => (
                                                    <div key={project.id} className="border rounded-lg p-4 hover:shadow-lg transition-shadow">
                                                        <h3 className="font-semibold">{project.name}</h3>
                                                        <p className="text-sm text-gray-600 mt-1">{project.description}</p>
                                                        <div className="mt-3 flex justify-between items-center">
                                                            <span className={`px-2 py-1 text-xs rounded ${
                                                                project.status === 'active' ? 'bg-green-100 text-green-800' :
                                                                project.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                                                project.status === 'on-hold' ? 'bg-yellow-100 text-yellow-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`}>
                                                                {project.status}
                                                            </span>
                                                            <button
                                                                onClick={() => setActiveProject(project)}
                                                                className="text-blue-500 hover:underline text-sm"
                                                            >
                                                                Abrir
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                        </div>
                                    </div>
                                )}
                                {activeView === 'settings' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">{t('settings')}</h2>
                                        <div className="space-y-4">
                                            <div>
                                                <h3 className="font-semibold mb-2">Perfil do Usu√°rio</h3>
                                                <p>Nome: {currentUser?.name}</p>
                                                <p>Email: {currentUser?.email}</p>
                                                <p>Empresa: {currentUser?.company}</p>
                                                <p>Cargo: {currentUser?.role}</p>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Prefer√™ncias</h3>
                                                <label className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={darkMode}
                                                        onChange={(e) => setDarkMode(e.target.checked)}
                                                    />
                                                    Modo Escuro
                                                </label>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Idioma</h3>
                                                <select
                                                    value={language}
                                                    onChange={(e) => setLanguage(e.target.value)}
                                                    className="border rounded px-3 py-2"
                                                >
                                                    <option value="pt">Portugu√™s</option>
                                                    <option value="en">English</option>
                                                </select>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Backup & Restore</h3>
                                                <div className="space-y-2">
                                                    <button
                                                        onClick={() => {
                                                            const data = {
                                                                projects,
                                                                tasks,
                                                                risks,
                                                                stakeholders,
                                                                changes,
                                                                lessons,
                                                                deliverables,
                                                                qualityMetrics,
                                                                communications,
                                                                resources,
                                                                projectCharters,
                                                                exportDate: new Date().toISOString()
                                                            };
                                                            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                                                            const url = URL.createObjectURL(blob);
                                                            const a = document.createElement('a');
                                                            a.href = url;
                                                            a.download = `pmbok-backup-${new Date().toISOString().split('T')[0]}.json`;
                                                            a.click();
                                                            addNotification('success', 'Backup Criado', 'Dados exportados com sucesso!');
                                                        }}
                                                        className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                                    >
                                                        Exportar Dados (Backup)
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            const input = document.createElement('input');
                                                            input.type = 'file';
                                                            input.accept = '.json';
                                                            input.onchange = (e) => {
                                                                const file = e.target.files[0];
                                                                if (file) {
                                                                    const reader = new FileReader();
                                                                    reader.onload = (event) => {
                                                                        try {
                                                                            const data = JSON.parse(event.target.result);
                                                                            if (data.projects) setProjects(data.projects);
                                                                            if (data.tasks) setTasks(data.tasks);
                                                                            if (data.risks) setRisks(data.risks);
                                                                            if (data.stakeholders) setStakeholders(data.stakeholders);
                                                                            if (data.changes) setChanges(data.changes);
                                                                            if (data.lessons) setLessons(data.lessons);
                                                                            if (data.deliverables) setDeliverables(data.deliverables);
                                                                            if (data.qualityMetrics) setQualityMetrics(data.qualityMetrics);
                                                                            if (data.communications) setCommunications(data.communications);
                                                                            if (data.resources) setResources(data.resources);
                                                                            if (data.projectCharters) setProjectCharters(data.projectCharters);
                                                                            addNotification('success', 'Dados Restaurados', 'Backup importado com sucesso!');
                                                                        } catch (err) {
                                                                            addNotification('error', 'Erro', 'Falha ao importar backup');
                                                                        }
                                                                    };
                                                                    reader.readAsText(file);
                                                                }
                                                            };
                                                            input.click();
                                                        }}
                                                        className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                    >
                                                        Importar Dados (Restore)
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Integra√ß√µes */}
                                            <div className="border-t pt-4">
                                                <h3 className="font-semibold mb-4 text-lg">üîó Integra√ß√µes</h3>

                                                {/* Firebase */}
                                                <div className="mb-6 p-4 bg-gray-50 rounded">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h4 className="font-semibold">üî• Firebase (Colabora√ß√£o)</h4>
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            syncStatus === 'connected' ? 'bg-green-100 text-green-700' :
                                                            syncStatus === 'syncing' ? 'bg-blue-100 text-blue-700' :
                                                            syncStatus === 'error' ? 'bg-red-100 text-red-700' :
                                                            'bg-gray-100 text-gray-700'
                                                        }`}>
                                                            {syncStatus === 'connected' ? '‚úÖ Conectado' :
                                                             syncStatus === 'syncing' ? 'üîÑ Sincronizando' :
                                                             syncStatus === 'error' ? '‚ùå Erro' :
                                                             '‚ö™ Desconectado'}
                                                        </span>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mb-3">
                                                        Sincronize projetos em tempo real e colabore com sua equipe
                                                    </p>
                                                    {!firebaseInitialized ? (
                                                        <div className="space-y-2">
                                                            <textarea
                                                                placeholder='Cole aqui a configura√ß√£o Firebase JSON:
{
  "apiKey": "...",
  "authDomain": "...",
  "projectId": "...",
  "storageBucket": "...",
  "messagingSenderId": "...",
  "appId": "..."
}'
                                                                className="w-full border rounded p-2 text-xs font-mono h-32"
                                                                onChange={(e) => {
                                                                    try {
                                                                        const config = JSON.parse(e.target.value);
                                                                        setFirebaseConfig(config);
                                                                    } catch(err) {
                                                                        // Invalid JSON, ignore
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                onClick={() => {
                                                                    if (firebaseConfig) {
                                                                        initializeFirebase(firebaseConfig);
                                                                    } else {
                                                                        addNotification('error', 'Erro', 'Cole a configura√ß√£o Firebase primeiro');
                                                                    }
                                                                }}
                                                                className="w-full px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600"
                                                            >
                                                                üî• Conectar Firebase
                                                            </button>
                                                            <a
                                                                href="https://console.firebase.google.com/"
                                                                target="_blank"
                                                                className="block text-center text-sm text-blue-600 hover:underline"
                                                            >
                                                                üìñ Ver guia de configura√ß√£o
                                                            </a>
                                                        </div>
                                                    ) : (
                                                        <div className="space-y-2">
                                                            <div className="flex items-center gap-2 text-sm">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={syncEnabled}
                                                                    onChange={(e) => setSyncEnabled(e.target.checked)}
                                                                />
                                                                <label>Ativar sincroniza√ß√£o autom√°tica</label>
                                                            </div>
                                                            <button
                                                                onClick={migrateLocalToFirebase}
                                                                className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
                                                            >
                                                                üì§ Migrar dados locais para Firebase
                                                            </button>
                                                            {activeProject && (
                                                                <div className="mt-3 p-3 bg-white rounded border">
                                                                    <p className="font-semibold text-sm mb-2">Equipe do Projeto:</p>
                                                                    {activeProject.members && Object.keys(activeProject.members).map(memberId => {
                                                                        const member = activeProject.members[memberId];
                                                                        return (
                                                                            <div key={memberId} className="flex items-center justify-between text-sm py-1">
                                                                                <span>{member.name} ({member.role})</span>
                                                                                <span className="text-xs text-gray-500">{member.email}</span>
                                                                            </div>
                                                                        );
                                                                    })}
                                                                    <div className="mt-2 flex gap-2">
                                                                        <input
                                                                            type="email"
                                                                            placeholder="Email do membro"
                                                                            id="newMemberEmail"
                                                                            className="flex-1 border rounded px-2 py-1 text-sm"
                                                                        />
                                                                        <button
                                                                            onClick={() => {
                                                                                const email = document.getElementById('newMemberEmail').value;
                                                                                if (email) {
                                                                                    addTeamMember(activeProject.id, email);
                                                                                    document.getElementById('newMemberEmail').value = '';
                                                                                }
                                                                            }}
                                                                            className="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600"
                                                                        >
                                                                            + Adicionar
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>

                                                {/* ClickUp */}
                                                <div className="mb-6 p-4 bg-gray-50 rounded">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h4 className="font-semibold">‚ö° ClickUp</h4>
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            clickupConnected ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'
                                                        }`}>
                                                            {clickupConnected ? '‚úÖ Conectado' : '‚ö™ Desconectado'}
                                                        </span>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mb-3">
                                                        Sincronize tarefas com o ClickUp
                                                    </p>
                                                    <div className="space-y-2">
                                                        <input
                                                            type="text"
                                                            placeholder="API Key do ClickUp"
                                                            value={clickupApiKey}
                                                            onChange={(e) => setClickupApiKey(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Workspace ID (opcional)"
                                                            value={clickupWorkspaceId}
                                                            onChange={(e) => setClickupWorkspaceId(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Space/List ID para Sync"
                                                            value={clickupSpaceId}
                                                            onChange={(e) => setClickupSpaceId(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <button
                                                            onClick={() => testClickUpConnection(clickupApiKey)}
                                                            className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
                                                        >
                                                            ‚ö° Conectar ClickUp
                                                        </button>

                                                        {clickupConnected && clickupSpaceId && (
                                                            <div className="pt-2 border-t space-y-2">
                                                                <button
                                                                    onClick={() => importFromClickUp(clickupSpaceId)}
                                                                    className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                                >
                                                                    üì• Importar Tarefas do ClickUp
                                                                </button>
                                                                <button
                                                                    onClick={() => exportToClickUp(clickupSpaceId)}
                                                                    className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                                                >
                                                                    üì§ Exportar Tarefas para ClickUp
                                                                </button>
                                                                <label className="flex items-center space-x-2 text-sm">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={clickupSyncEnabled}
                                                                        onChange={(e) => setClickupSyncEnabled(e.target.checked)}
                                                                        className="rounded"
                                                                    />
                                                                    <span>üîÑ Sincroniza√ß√£o Autom√°tica</span>
                                                                </label>
                                                            </div>
                                                        )}

                                                        <a
                                                            href="https://app.clickup.com/settings/apps"
                                                            target="_blank"
                                                            className="block text-center text-sm text-blue-600 hover:underline"
                                                        >
                                                            üîë Obter API Key no ClickUp
                                                        </a>
                                                    </div>
                                                </div>

                                                {/* Trello */}
                                                <div className="mb-6 p-4 bg-gray-50 rounded">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h4 className="font-semibold">üìã Trello</h4>
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            trelloConnected ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'
                                                        }`}>
                                                            {trelloConnected ? '‚úÖ Conectado' : '‚ö™ Desconectado'}
                                                        </span>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mb-3">
                                                        Sincronize cards com o Trello
                                                    </p>
                                                    <div className="space-y-2">
                                                        <input
                                                            type="text"
                                                            placeholder="API Key do Trello"
                                                            value={trelloApiKey}
                                                            onChange={(e) => setTrelloApiKey(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Token do Trello"
                                                            value={trelloToken}
                                                            onChange={(e) => setTrelloToken(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Board ID"
                                                            value={trelloBoardId}
                                                            onChange={(e) => setTrelloBoardId(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <button
                                                            onClick={testTrelloConnection}
                                                            className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                        >
                                                            üìã Conectar Trello
                                                        </button>

                                                        {trelloConnected && trelloBoardId && (
                                                            <div className="pt-2 border-t space-y-2">
                                                                <button
                                                                    onClick={importFromTrello}
                                                                    className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                                >
                                                                    üì• Importar Cards do Trello
                                                                </button>
                                                                <button
                                                                    onClick={exportToTrello}
                                                                    className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                                                >
                                                                    üì§ Exportar Tarefas para Trello
                                                                </button>
                                                            </div>
                                                        )}

                                                        <a
                                                            href="https://trello.com/app-key"
                                                            target="_blank"
                                                            className="block text-center text-sm text-blue-600 hover:underline"
                                                        >
                                                            üîë Obter API Key no Trello
                                                        </a>
                                                    </div>
                                                </div>

                                                {/* Microsoft Planner */}
                                                <div className="mb-6 p-4 bg-gray-50 rounded">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h4 className="font-semibold">üìÖ Microsoft Planner</h4>
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            plannerConnected ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'
                                                        }`}>
                                                            {plannerConnected ? '‚úÖ Conectado' : '‚ö™ Desconectado'}
                                                        </span>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mb-3">
                                                        Sincronize tarefas com o Microsoft Planner
                                                    </p>
                                                    <div className="space-y-2">
                                                        <input
                                                            type="text"
                                                            placeholder="Access Token (Microsoft Graph)"
                                                            value={plannerAccessToken}
                                                            onChange={(e) => setPlannerAccessToken(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <input
                                                            type="text"
                                                            placeholder="Plan ID"
                                                            value={plannerPlanId}
                                                            onChange={(e) => setPlannerPlanId(e.target.value)}
                                                            className="w-full border rounded px-3 py-2 text-sm"
                                                        />
                                                        <button
                                                            onClick={testPlannerConnection}
                                                            className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                        >
                                                            üìÖ Conectar Planner
                                                        </button>

                                                        {plannerConnected && plannerPlanId && (
                                                            <div className="pt-2 border-t space-y-2">
                                                                <button
                                                                    onClick={importFromPlanner}
                                                                    className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                                >
                                                                    üì• Importar Tarefas do Planner
                                                                </button>
                                                                <button
                                                                    onClick={exportToPlanner}
                                                                    className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                                                >
                                                                    üì§ Exportar Tarefas para Planner
                                                                </button>
                                                            </div>
                                                        )}

                                                        <a
                                                            href="https://developer.microsoft.com/graph/graph-explorer"
                                                            target="_blank"
                                                            className="block text-center text-sm text-blue-600 hover:underline"
                                                        >
                                                            üîë Obter Token no Graph Explorer
                                                        </a>
                                                    </div>
                                                </div>

                                                {/* MS Project */}
                                                <div className="p-4 bg-gray-50 rounded">
                                                    <h4 className="font-semibold mb-2">üìä MS Project</h4>
                                                    <p className="text-sm text-gray-600 mb-3">
                                                        Import/Export projetos em formato XML
                                                    </p>
                                                    <div className="space-y-2">
                                                        <button
                                                            onClick={exportToMSProject}
                                                            className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                                        >
                                                            üì§ Exportar para MS Project XML
                                                        </button>
                                                        <button
                                                            onClick={importFromMSProject}
                                                            className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
                                                        >
                                                            üì• Importar de MS Project XML
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {activeView === 'tasks' && <TasksView />}
                                {activeView === 'risks' && <RisksView />}
                                {activeView === 'stakeholders' && <StakeholdersView />}
                                {activeView === 'wbs' && <WBSView />}
                                {activeView === 'changes' && <ChangesView />}
                                {activeView === 'lessons' && <LessonsView />}
                                {activeView === 'deliverables' && <DeliverablesView />}
                                {activeView === 'quality' && <QualityView />}
                                {activeView === 'communications' && <CommunicationsView />}
                                {activeView === 'resources' && <ResourcesView />}
                                {activeView === 'costs' && <CostsView />}
                                {activeView === 'issues' && <IssuesView />}
                                {activeView === 'reports' && <ReportsView />}
                            </div>
                        </div>

                        {/* Modals */}
                        {showModal === 'project' && (
                            <ProjectModal
                                project={editingItem}
                                onSave={(project) => {
                                    if (editingItem) {
                                        setProjects(projects.map(p => p.id === project.id ? project : p));
                                    } else {
                                        setProjects([...projects, project]);
                                        setActiveProject(project);
                                    }
                                    setShowModal(null);
                                    setEditingItem(null);
                                    addNotification('success', 'Sucesso', 'Projeto salvo com sucesso!');
                                }}
                                onClose={() => {
                                    setShowModal(null);
                                    setEditingItem(null);
                                }}
                            />
                        )}

                        {/* Assistente de IA */}
                        <AIChatAssistant />
                    </div>
                );
            };

            // Renderiza√ß√£o principal
            if (showLogin && !isLoggedIn) {
                return (
                    <>
                        <LoginSystem />
                        <NotificationSystem />
                    </>
                );
            }

            return (
                <>
                    <MainLayout />
                    <NotificationSystem />
                </>
            );
        };

        // Renderizar aplica√ß√£o
        ReactDOM.createRoot(document.getElementById('root')).render(<PMBOKManagerPro />);
        
        // Inicializar √≠cones
        setTimeout(() => {
            lucide.createIcons();
        }, 100);
    </script>
</body>
</html>
