<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMBOK 7 Manager Pro - Sistema Completo de Gestão de Projetos</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const PMBOKManagerPro = () => {
            // Estados principais
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [showLogin, setShowLogin] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [darkMode, setDarkMode] = useState(false);
            const [activeView, setActiveView] = useState('dashboard');
            const [projects, setProjects] = useState([]);
            const [activeProject, setActiveProject] = useState(null);
            const [showModal, setShowModal] = useState(null);
            const [editingItem, setEditingItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [language, setLanguage] = useState('pt');

            // Estados para artefatos PMBOK
            const [projectCharters, setProjectCharters] = useState([]);
            const [stakeholders, setStakeholders] = useState([]);
            const [risks, setRisks] = useState([]);
            const [wbs, setWbs] = useState([]);
            const [changes, setChanges] = useState([]);
            const [lessons, setLessons] = useState([]);
            const [deliverables, setDeliverables] = useState([]);
            const [qualityMetrics, setQualityMetrics] = useState([]);
            const [communications, setCommunications] = useState([]);
            const [resources, setResources] = useState([]);
            const [tasks, setTasks] = useState([]);

            // Estados para ISO 9001
            const [suppliers, setSuppliers] = useState([]);
            const [audits, setAudits] = useState([]);
            const [managementReviews, setManagementReviews] = useState([]);
            const [qualityObjectives, setQualityObjectives] = useState([]);
            const [meetingNotes, setMeetingNotes] = useState([]);

            // Estados para Custos e IA Preditiva
            const [costs, setCosts] = useState([]);
            const [costPrediction, setCostPrediction] = useState(null);

            // Estados para IA (Gemini)
            const [geminiApiKey, setGeminiApiKey] = useState('');
            const [aiChatHistory, setAiChatHistory] = useState([]);
            const [showAiChat, setShowAiChat] = useState(false);
            const [aiLoading, setAiLoading] = useState(false);

            // Estados para customização
            const [customTheme, setCustomTheme] = useState({
                primary: '#3B82F6',
                secondary: '#8B5CF6',
                accent: '#10B981'
            });

            // Traduções
            const translations = {
                pt: {
                    welcome: "Bem-vindo",
                    dashboard: "Dashboard",
                    projects: "Projetos",
                    logout: "Sair",
                    exportPdf: "Exportar PDF",
                    notifications: "Notificações",
                    settings: "Configurações",
                    newProject: "Novo Projeto",
                    projectName: "Nome do Projeto",
                    description: "Descrição",
                    startDate: "Data Início",
                    endDate: "Data Fim",
                    budget: "Orçamento",
                    save: "Salvar",
                    cancel: "Cancelar",
                    delete: "Deletar",
                    edit: "Editar",
                    status: "Status",
                    active: "Ativo",
                    completed: "Concluído",
                    onHold: "Pausado",
                    planning: "Planejamento"
                },
                en: {
                    welcome: "Welcome",
                    dashboard: "Dashboard",
                    projects: "Projects",
                    logout: "Logout",
                    exportPdf: "Export PDF",
                    notifications: "Notifications",
                    settings: "Settings",
                    newProject: "New Project",
                    projectName: "Project Name",
                    description: "Description",
                    startDate: "Start Date",
                    endDate: "End Date",
                    budget: "Budget",
                    save: "Save",
                    cancel: "Cancel",
                    delete: "Delete",
                    edit: "Edit",
                    status: "Status",
                    active: "Active",
                    completed: "Completed",
                    onHold: "On Hold",
                    planning: "Planning"
                }
            };

            const t = (key) => translations[language][key] || key;

            // Carregar dados do localStorage
            useEffect(() => {
                const loadData = () => {
                    try {
                        const savedUsers = localStorage.getItem('pmbok_users');
                        if (savedUsers) setUsers(JSON.parse(savedUsers));
                        
                        const savedProjects = localStorage.getItem('pmbok_projects');
                        if (savedProjects) setProjects(JSON.parse(savedProjects));
                        
                        const savedCharters = localStorage.getItem('pmbok_charters');
                        if (savedCharters) setProjectCharters(JSON.parse(savedCharters));
                        
                        const savedStakeholders = localStorage.getItem('pmbok_stakeholders');
                        if (savedStakeholders) setStakeholders(JSON.parse(savedStakeholders));
                        
                        const savedRisks = localStorage.getItem('pmbok_risks');
                        if (savedRisks) setRisks(JSON.parse(savedRisks));
                        
                        const savedDarkMode = localStorage.getItem('pmbok_darkMode');
                        if (savedDarkMode) setDarkMode(JSON.parse(savedDarkMode));
                        
                        const savedLanguage = localStorage.getItem('pmbok_language');
                        if (savedLanguage) setLanguage(savedLanguage);
                        
                        const savedTasks = localStorage.getItem('pmbok_tasks');
                        if (savedTasks) setTasks(JSON.parse(savedTasks));

                        const savedGeminiKey = localStorage.getItem('pmbok_gemini_key');
                        if (savedGeminiKey) setGeminiApiKey(savedGeminiKey);

                        // Check for logged in user
                        const loggedUser = localStorage.getItem('pmbok_currentUser');
                        if (loggedUser) {
                            setCurrentUser(JSON.parse(loggedUser));
                            setIsLoggedIn(true);
                            setShowLogin(false);
                        }
                    } catch (error) {
                        console.error('Error loading data:', error);
                    }
                };
                loadData();
            }, []);

            // Salvar dados no localStorage
            useEffect(() => {
                if (users.length > 0) {
                    localStorage.setItem('pmbok_users', JSON.stringify(users));
                }
            }, [users]);

            useEffect(() => {
                localStorage.setItem('pmbok_projects', JSON.stringify(projects));
            }, [projects]);

            useEffect(() => {
                localStorage.setItem('pmbok_charters', JSON.stringify(projectCharters));
            }, [projectCharters]);

            useEffect(() => {
                localStorage.setItem('pmbok_stakeholders', JSON.stringify(stakeholders));
            }, [stakeholders]);

            useEffect(() => {
                localStorage.setItem('pmbok_risks', JSON.stringify(risks));
            }, [risks]);

            useEffect(() => {
                localStorage.setItem('pmbok_tasks', JSON.stringify(tasks));
            }, [tasks]);

            useEffect(() => {
                localStorage.setItem('pmbok_darkMode', JSON.stringify(darkMode));
            }, [darkMode]);

            useEffect(() => {
                localStorage.setItem('pmbok_language', language);
            }, [language]);

            useEffect(() => {
                if (geminiApiKey) {
                    localStorage.setItem('pmbok_gemini_key', geminiApiKey);
                }
            }, [geminiApiKey]);

            // Sistema de Notificações
            const addNotification = (type, title, message) => {
                const notification = {
                    id: Date.now(),
                    type,
                    title,
                    message,
                    timestamp: new Date().toISOString()
                };
                setNotifications(prev => [...prev, notification]);
                
                // Auto remove após 5 segundos
                setTimeout(() => {
                    removeNotification(notification.id);
                }, 5000);
            };

            const removeNotification = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            // Verificar tarefas vencendo
            useEffect(() => {
                if (isLoggedIn && tasks.length > 0) {
                    const checkDeadlines = () => {
                        const today = new Date();
                        const tomorrow = new Date(today);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        
                        tasks.forEach(task => {
                            if (task.dueDate) {
                                const dueDate = new Date(task.dueDate);
                                const diffTime = dueDate - today;
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                
                                if (diffDays === 1) {
                                    addNotification('warning', 'Tarefa Vencendo', `${task.title} vence amanhã!`);
                                } else if (diffDays === 0) {
                                    addNotification('error', 'Tarefa Vence Hoje', `${task.title} vence hoje!`);
                                } else if (diffDays < 0 && task.status !== 'done') {
                                    addNotification('error', 'Tarefa Atrasada', `${task.title} está atrasada!`);
                                }
                            }
                        });
                    };
                    
                    checkDeadlines();
                    const interval = setInterval(checkDeadlines, 3600000); // Check every hour
                    return () => clearInterval(interval);
                }
            }, [isLoggedIn, tasks]);

            // Funções de IA (Gemini API)
            const callGeminiAPI = async (prompt, systemPrompt = '') => {
                if (!geminiApiKey) {
                    addNotification('error', 'API Key Ausente', 'Configure sua chave API do Gemini nas configurações.');
                    return null;
                }

                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${geminiApiKey}`;

                try {
                    const fullPrompt = systemPrompt ? `${systemPrompt}\n\n${prompt}` : prompt;

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: fullPrompt
                                }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Erro na API do Gemini');
                    }

                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (error) {
                    console.error('Erro ao chamar Gemini API:', error);
                    addNotification('error', 'Erro de IA', error.message || 'Falha ao comunicar com a IA');
                    return null;
                }
            };

            const analyzeRiskWithAI = async (riskDescription) => {
                const prompt = `Você é um especialista em gestão de riscos PMBOK 7.
Analise o seguinte risco e forneça:
1. Probabilidade estimada (1-5, onde 5 é muito provável)
2. Impacto estimado (1-5, onde 5 é impacto crítico)
3. Categoria sugerida (Técnico, Financeiro, Operacional, ou Externo)
4. Plano de mitigação sugerido (2-3 ações práticas)

Risco: ${riskDescription}

Responda em formato JSON:
{
  "probabilidade": número,
  "impacto": número,
  "categoria": "string",
  "mitigacao": "string com ações"
}`;

                setAiLoading(true);
                const result = await callGeminiAPI(prompt);
                setAiLoading(false);

                if (result) {
                    try {
                        // Extract JSON from response
                        const jsonMatch = result.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            return JSON.parse(jsonMatch[0]);
                        }
                    } catch (e) {
                        console.error('Erro ao parsear resposta da IA:', e);
                    }
                }
                return null;
            };

            const generateQualityPolicyWithAI = async (companyName, projectType) => {
                const prompt = `Você é um consultor ISO 9001. Crie uma Política da Qualidade profissional para:
Empresa: ${companyName || 'Organização'}
Tipo de projeto: ${projectType || 'Gestão de Projetos'}

A política deve:
- Ter 3-5 parágrafos
- Seguir ISO 9001:2015
- Mencionar: compromisso com qualidade, melhoria contínua, satisfação do cliente
- Ser formal e profissional
- Incluir comprometimento da alta direção

Gere apenas o texto da política, sem títulos ou formatação extra.`;

                setAiLoading(true);
                const result = await callGeminiAPI(prompt);
                setAiLoading(false);
                return result;
            };

            const analyzeNonConformityWithAI = async (ncDescription) => {
                const prompt = `Você é um auditor ISO 9001. Analise esta Não Conformidade:

${ncDescription}

Forneça:
1. Gravidade estimada (Baixa, Média, Alta, Crítica)
2. Possíveis causas raiz (método 5 Porquês)
3. Ações corretivas sugeridas (2-3 ações)
4. Ações preventivas sugeridas (2-3 ações)

Responda em formato JSON:
{
  "gravidade": "string",
  "causasRaiz": "string",
  "acoesCorretivas": "string",
  "acoesPreventivas": "string"
}`;

                setAiLoading(true);
                const result = await callGeminiAPI(prompt);
                setAiLoading(false);

                if (result) {
                    try {
                        const jsonMatch = result.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            return JSON.parse(jsonMatch[0]);
                        }
                    } catch (e) {
                        console.error('Erro ao parsear resposta da IA:', e);
                    }
                }
                return null;
            };

            const chatWithAI = async (userMessage) => {
                const systemPrompt = `Você é um assistente especializado em PMBOK 7 e ISO 9001.
Ajude o usuário com perguntas sobre gestão de projetos, qualidade, riscos, stakeholders, etc.
Seja conciso, prático e profissional.`;

                setAiLoading(true);
                const result = await callGeminiAPI(userMessage, systemPrompt);
                setAiLoading(false);
                return result;
            };

            // Componente de Login/Registro
            const LoginSystem = () => {
                const [isRegister, setIsRegister] = useState(false);
                const [formData, setFormData] = useState({
                    email: '',
                    password: '',
                    name: '',
                    company: '',
                    role: ''
                });

                const handleLogin = (e) => {
                    e.preventDefault();
                    const user = users.find(u => u.email === formData.email && u.password === formData.password);
                    
                    if (user) {
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                        setShowLogin(false);
                        localStorage.setItem('pmbok_currentUser', JSON.stringify(user));
                        addNotification('success', 'Login Realizado', `Bem-vindo de volta, ${user.name}!`);
                    } else {
                        addNotification('error', 'Erro no Login', 'Email ou senha incorretos');
                    }
                };

                const handleRegister = (e) => {
                    e.preventDefault();
                    const newUser = {
                        id: Date.now(),
                        ...formData,
                        createdAt: new Date().toISOString()
                    };
                    
                    setUsers(prev => [...prev, newUser]);
                    setCurrentUser(newUser);
                    setIsLoggedIn(true);
                    setShowLogin(false);
                    localStorage.setItem('pmbok_currentUser', JSON.stringify(newUser));
                    addNotification('success', 'Conta Criada', 'Bem-vindo ao PMBOK Manager Pro!');
                };

                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800">PMBOK 7 Manager Pro</h1>
                                <p className="text-gray-600 mt-2">Sistema Profissional de Gestão de Projetos</p>
                            </div>
                            
                            <form onSubmit={isRegister ? handleRegister : handleLogin}>
                                {isRegister && (
                                    <>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Nome Completo</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                required
                                                value={formData.name}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Empresa</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                value={formData.company}
                                                onChange={(e) => setFormData({...formData, company: e.target.value})}
                                            />
                                        </div>
                                        <div className="mb-4">
                                            <label className="block text-gray-700 text-sm font-bold mb-2">Cargo</label>
                                            <input
                                                type="text"
                                                className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                                value={formData.role}
                                                onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            />
                                        </div>
                                    </>
                                )}
                                
                                <div className="mb-4">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">Email</label>
                                    <input
                                        type="email"
                                        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                        required
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    />
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                                    <input
                                        type="password"
                                        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
                                        required
                                        value={formData.password}
                                        onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    />
                                </div>
                                
                                <button
                                    type="submit"
                                    className="w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300"
                                >
                                    {isRegister ? 'Criar Conta' : 'Entrar'}
                                </button>
                            </form>
                            
                            <div className="mt-6 text-center">
                                <button
                                    onClick={() => setIsRegister(!isRegister)}
                                    className="text-blue-500 hover:underline"
                                >
                                    {isRegister ? 'Já tem conta? Faça login' : 'Não tem conta? Registre-se'}
                                </button>
                            </div>
                            
                            <div className="mt-4 text-center">
                                <button
                                    onClick={() => {
                                        const demoUser = {
                                            id: 0,
                                            name: 'Usuário Demo',
                                            email: 'demo@pmbok.com',
                                            company: 'Demo Company',
                                            role: 'Project Manager'
                                        };
                                        setCurrentUser(demoUser);
                                        setIsLoggedIn(true);
                                        setShowLogin(false);
                                        addNotification('info', 'Modo Demo', 'Você entrou no modo demonstração');
                                    }}
                                    className="text-gray-500 hover:underline text-sm"
                                >
                                    Entrar no Modo Demo
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Notificações
            const NotificationSystem = () => {
                return (
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {notifications.map(notification => (
                            <div
                                key={notification.id}
                                className={`notification-enter bg-white shadow-lg rounded-lg p-4 max-w-sm border-l-4 ${
                                    notification.type === 'success' ? 'border-green-500' :
                                    notification.type === 'error' ? 'border-red-500' :
                                    notification.type === 'warning' ? 'border-yellow-500' :
                                    'border-blue-500'
                                }`}
                            >
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h4 className="font-semibold">{notification.title}</h4>
                                        <p className="text-sm text-gray-600">{notification.message}</p>
                                    </div>
                                    <button
                                        onClick={() => removeNotification(notification.id)}
                                        className="ml-4 text-gray-400 hover:text-gray-600"
                                    >
                                        <i data-lucide="x" className="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            // Função para exportar PDF
            const exportToPDF = async () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configurar fonte
                doc.setFontSize(20);
                doc.text('Relatório do Projeto', 20, 20);
                
                if (activeProject) {
                    doc.setFontSize(16);
                    doc.text(activeProject.name, 20, 35);
                    
                    doc.setFontSize(12);
                    doc.text(`Descrição: ${activeProject.description || 'N/A'}`, 20, 50);
                    doc.text(`Data Início: ${activeProject.startDate || 'N/A'}`, 20, 60);
                    doc.text(`Data Fim: ${activeProject.endDate || 'N/A'}`, 20, 70);
                    doc.text(`Orçamento: ${activeProject.budget || 'N/A'}`, 20, 80);
                    doc.text(`Status: ${activeProject.status || 'N/A'}`, 20, 90);
                    
                    // Adicionar riscos
                    const projectRisks = risks.filter(r => r.projectId === activeProject.id);
                    if (projectRisks.length > 0) {
                        doc.text('Riscos:', 20, 110);
                        let yPos = 120;
                        projectRisks.forEach((risk, idx) => {
                            doc.text(`${idx + 1}. ${risk.description}`, 25, yPos);
                            yPos += 10;
                        });
                    }
                    
                    // Adicionar stakeholders
                    const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject.id);
                    if (projectStakeholders.length > 0 && yPos < 250) {
                        doc.text('Stakeholders:', 20, yPos + 10);
                        yPos += 20;
                        projectStakeholders.forEach((stakeholder, idx) => {
                            if (yPos < 270) {
                                doc.text(`${idx + 1}. ${stakeholder.name} - ${stakeholder.role}`, 25, yPos);
                                yPos += 10;
                            }
                        });
                    }
                }
                
                // Adicionar data de geração
                const today = new Date().toLocaleDateString('pt-BR');
                doc.setFontSize(10);
                doc.text(`Gerado em: ${today}`, 20, 280);
                doc.text(`Por: ${currentUser?.name || 'Usuário'}`, 100, 280);
                
                // Salvar PDF
                doc.save(`projeto-${activeProject?.name || 'relatorio'}.pdf`);
                addNotification('success', 'PDF Exportado', 'Relatório salvo com sucesso!');
            };

            // Integração com Google Calendar (simulada)
            const syncWithGoogleCalendar = () => {
                // Em produção, isso usaria a API do Google Calendar
                const events = tasks.map(task => ({
                    title: task.title,
                    start: task.dueDate,
                    description: task.description
                }));
                
                // Simular exportação
                const calendarData = {
                    events,
                    projectName: activeProject?.name,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(calendarData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `calendar-${activeProject?.name || 'events'}.json`;
                a.click();
                
                addNotification('success', 'Calendário Exportado', 'Eventos prontos para importação no Google Calendar');
            };

            // Dashboard Avançado
            const Dashboard = () => {
                const chartRef = useRef(null);
                const progressChartRef = useRef(null);
                const chartInstance = useRef(null);
                const progressChartInstance = useRef(null);

                useEffect(() => {
                    if (chartRef.current) {
                        const ctx = chartRef.current.getContext('2d');
                        
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        
                        chartInstance.current = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['Riscos', 'Tarefas', 'Entregas', 'Stakeholders'],
                                datasets: [{
                                    label: 'Quantidade',
                                    data: [
                                        risks.filter(r => r.projectId === activeProject?.id).length,
                                        tasks.filter(t => t.projectId === activeProject?.id).length,
                                        deliverables.filter(d => d.projectId === activeProject?.id).length,
                                        stakeholders.filter(s => s.projectId === activeProject?.id).length
                                    ],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.5)',
                                        'rgba(54, 162, 235, 0.5)',
                                        'rgba(255, 206, 86, 0.5)',
                                        'rgba(75, 192, 192, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                },
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    if (progressChartRef.current) {
                        const ctx = progressChartRef.current.getContext('2d');
                        
                        if (progressChartInstance.current) {
                            progressChartInstance.current.destroy();
                        }
                        
                        const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                        const completedTasks = projectTasks.filter(t => t.status === 'done').length;
                        const inProgressTasks = projectTasks.filter(t => t.status === 'in_progress').length;
                        const todoTasks = projectTasks.filter(t => t.status === 'todo').length;
                        
                        progressChartInstance.current = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Concluídas', 'Em Progresso', 'A Fazer'],
                                datasets: [{
                                    data: [completedTasks, inProgressTasks, todoTasks],
                                    backgroundColor: [
                                        'rgba(75, 192, 192, 0.5)',
                                        'rgba(255, 206, 86, 0.5)',
                                        'rgba(255, 99, 132, 0.5)'
                                    ],
                                    borderColor: [
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(255, 99, 132, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false
                            }
                        });
                    }
                    
                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                        if (progressChartInstance.current) {
                            progressChartInstance.current.destroy();
                        }
                    };
                }, [activeProject, risks, tasks, deliverables, stakeholders]);

                if (!activeProject) {
                    return (
                        <div className="flex items-center justify-center h-full">
                            <div className="text-center">
                                <i data-lucide="folder-open" className="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                <h3 className="text-lg font-medium text-gray-900">{t('projects')}</h3>
                                <p className="text-gray-500">Selecione ou crie um projeto para começar</p>
                                <button
                                    onClick={() => setShowModal('project')}
                                    className="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                >
                                    {t('newProject')}
                                </button>
                            </div>
                        </div>
                    );
                }

                const projectTasks = tasks.filter(t => t.projectId === activeProject.id);
                const upcomingDeadlines = projectTasks
                    .filter(t => t.dueDate && t.status !== 'done')
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
                    .slice(0, 5);

                return (
                    <div className="space-y-6">
                        {/* Header do Projeto */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-900">{activeProject.name}</h2>
                                    <p className="text-gray-600 mt-1">{activeProject.description}</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportToPDF}
                                        className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="download" className="w-4 h-4"></i>
                                        {t('exportPdf')}
                                    </button>
                                    <button
                                        onClick={syncWithGoogleCalendar}
                                        className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="calendar" className="w-4 h-4"></i>
                                        Sync Calendar
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* KPIs */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Total de Tarefas</p>
                                        <p className="text-2xl font-bold">{projectTasks.length}</p>
                                    </div>
                                    <i data-lucide="check-square" className="w-8 h-8 text-blue-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Concluídas</p>
                                        <p className="text-2xl font-bold">
                                            {projectTasks.filter(t => t.status === 'done').length}
                                        </p>
                                    </div>
                                    <i data-lucide="check-circle" className="w-8 h-8 text-green-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Riscos Abertos</p>
                                        <p className="text-2xl font-bold">
                                            {risks.filter(r => r.projectId === activeProject.id && r.status === 'open').length}
                                        </p>
                                    </div>
                                    <i data-lucide="alert-triangle" className="w-8 h-8 text-orange-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-500">Stakeholders</p>
                                        <p className="text-2xl font-bold">
                                            {stakeholders.filter(s => s.projectId === activeProject.id).length}
                                        </p>
                                    </div>
                                    <i data-lucide="users" className="w-8 h-8 text-purple-500"></i>
                                </div>
                            </div>
                        </div>

                        {/* Gráficos */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Visão Geral do Projeto</h3>
                                <div className="h-64">
                                    <canvas ref={chartRef}></canvas>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-lg font-semibold mb-4">Progresso das Tarefas</h3>
                                <div className="h-64">
                                    <canvas ref={progressChartRef}></canvas>
                                </div>
                            </div>
                        </div>

                        {/* Próximos Prazos */}
                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Próximos Prazos</h3>
                            {upcomingDeadlines.length > 0 ? (
                                <div className="space-y-2">
                                    {upcomingDeadlines.map(task => (
                                        <div key={task.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                                            <div>
                                                <h4 className="font-medium">{task.title}</h4>
                                                <p className="text-sm text-gray-500">{task.description}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-sm font-medium">
                                                    {new Date(task.dueDate).toLocaleDateString('pt-BR')}
                                                </p>
                                                <p className="text-xs text-gray-500">
                                                    {Math.ceil((new Date(task.dueDate) - new Date()) / (1000 * 60 * 60 * 24))} dias
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <p className="text-gray-500">Nenhum prazo próximo</p>
                            )}
                        </div>
                    </div>
                );
            };

            // Modal de Projeto
            const ProjectModal = ({ project, onSave, onClose }) => {
                const [formData, setFormData] = useState(project || {
                    name: '',
                    description: '',
                    startDate: '',
                    endDate: '',
                    budget: '',
                    status: 'planning',
                    manager: currentUser?.name || ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        ...formData,
                        id: project?.id || Date.now(),
                        userId: currentUser?.id,
                        createdAt: project?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                };

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-lg p-6 w-full max-w-md">
                            <h3 className="text-xl font-bold mb-4">
                                {project ? 'Editar Projeto' : t('newProject')}
                            </h3>
                            <form onSubmit={handleSubmit}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('projectName')}</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            required
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('description')}</label>
                                        <textarea
                                            className="w-full border rounded px-3 py-2"
                                            rows="3"
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">{t('startDate')}</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.startDate}
                                                onChange={(e) => setFormData({...formData, startDate: e.target.value})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">{t('endDate')}</label>
                                            <input
                                                type="date"
                                                className="w-full border rounded px-3 py-2"
                                                value={formData.endDate}
                                                onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('budget')}</label>
                                        <input
                                            type="text"
                                            className="w-full border rounded px-3 py-2"
                                            placeholder="R$ 0,00"
                                            value={formData.budget}
                                            onChange={(e) => setFormData({...formData, budget: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">{t('status')}</label>
                                        <select
                                            className="w-full border rounded px-3 py-2"
                                            value={formData.status}
                                            onChange={(e) => setFormData({...formData, status: e.target.value})}
                                        >
                                            <option value="planning">{t('planning')}</option>
                                            <option value="active">{t('active')}</option>
                                            <option value="on-hold">{t('onHold')}</option>
                                            <option value="completed">{t('completed')}</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="flex justify-end gap-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 border rounded hover:bg-gray-50"
                                    >
                                        {t('cancel')}
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                                    >
                                        {t('save')}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Sistema de Tarefas Kanban
            const TasksKanban = () => {
                const [taskForm, setTaskForm] = useState({ title: '', description: '', priority: 'medium', dueDate: '', assignee: '' });
                const [showTaskModal, setShowTaskModal] = useState(false);

                const addTask = () => {
                    const newTask = { ...taskForm, id: Date.now(), projectId: activeProject?.id, status: 'todo', createdAt: new Date().toISOString() };
                    setTasks([...tasks, newTask]);
                    setShowTaskModal(false);
                    setTaskForm({ title: '', description: '', priority: 'medium', dueDate: '', assignee: '' });
                    addNotification('success', 'Tarefa Criada', 'Nova tarefa adicionada com sucesso!');
                };

                const moveTask = (taskId, newStatus) => {
                    setTasks(tasks.map(t => t.id === taskId ? { ...t, status: newStatus } : t));
                };

                const deleteTask = (taskId) => {
                    setTasks(tasks.filter(t => t.id !== taskId));
                    addNotification('info', 'Tarefa Removida', 'Tarefa deletada com sucesso');
                };

                const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                const todoTasks = projectTasks.filter(t => t.status === 'todo');
                const inProgressTasks = projectTasks.filter(t => t.status === 'in_progress');
                const doneTasks = projectTasks.filter(t => t.status === 'done');

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Quadro de Tarefas Kanban</h2>
                            <button onClick={() => setShowTaskModal(true)} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2">
                                <i data-lucide="plus" className="w-4 h-4"></i> Nova Tarefa
                            </button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {/* TODO */}
                            <div className="kanban-column">
                                <h3 className="font-bold mb-4 text-gray-700 flex items-center gap-2">
                                    <i data-lucide="circle" className="w-4 h-4"></i> A Fazer ({todoTasks.length})
                                </h3>
                                {todoTasks.map(task => (
                                    <div key={task.id} className="kanban-card">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-semibold">{task.title}</h4>
                                            <span className={`badge ${task.priority === 'high' ? 'badge-danger' : task.priority === 'medium' ? 'badge-warning' : 'badge-info'}`}>
                                                {task.priority}
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-2">{task.description}</p>
                                        {task.dueDate && <p className="text-xs text-gray-500 mb-2">Prazo: {new Date(task.dueDate).toLocaleDateString('pt-BR')}</p>}
                                        <div className="flex gap-2">
                                            <button onClick={() => moveTask(task.id, 'in_progress')} className="text-xs px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">Iniciar</button>
                                            <button onClick={() => deleteTask(task.id)} className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">Excluir</button>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* IN PROGRESS */}
                            <div className="kanban-column">
                                <h3 className="font-bold mb-4 text-yellow-700 flex items-center gap-2">
                                    <i data-lucide="loader" className="w-4 h-4"></i> Em Progresso ({inProgressTasks.length})
                                </h3>
                                {inProgressTasks.map(task => (
                                    <div key={task.id} className="kanban-card border-l-4 border-yellow-500">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-semibold">{task.title}</h4>
                                            <span className={`badge ${task.priority === 'high' ? 'badge-danger' : task.priority === 'medium' ? 'badge-warning' : 'badge-info'}`}>
                                                {task.priority}
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-2">{task.description}</p>
                                        {task.dueDate && <p className="text-xs text-gray-500 mb-2">Prazo: {new Date(task.dueDate).toLocaleDateString('pt-BR')}</p>}
                                        <div className="flex gap-2">
                                            <button onClick={() => moveTask(task.id, 'todo')} className="text-xs px-2 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">Voltar</button>
                                            <button onClick={() => moveTask(task.id, 'done')} className="text-xs px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600">Concluir</button>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* DONE */}
                            <div className="kanban-column">
                                <h3 className="font-bold mb-4 text-green-700 flex items-center gap-2">
                                    <i data-lucide="check-circle" className="w-4 h-4"></i> Concluído ({doneTasks.length})
                                </h3>
                                {doneTasks.map(task => (
                                    <div key={task.id} className="kanban-card border-l-4 border-green-500 opacity-75">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-semibold line-through">{task.title}</h4>
                                            <span className="badge badge-success">Feito</span>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-2">{task.description}</p>
                                        <button onClick={() => deleteTask(task.id)} className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">Excluir</button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Modal Nova Tarefa */}
                        {showTaskModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                    <h3 className="text-xl font-bold mb-4">Nova Tarefa</h3>
                                    <div className="space-y-4">
                                        <input type="text" placeholder="Título da tarefa" className="w-full border rounded px-3 py-2" value={taskForm.title} onChange={(e) => setTaskForm({ ...taskForm, title: e.target.value })} />
                                        <textarea placeholder="Descrição" className="w-full border rounded px-3 py-2" rows="3" value={taskForm.description} onChange={(e) => setTaskForm({ ...taskForm, description: e.target.value })} />
                                        <select className="w-full border rounded px-3 py-2" value={taskForm.priority} onChange={(e) => setTaskForm({ ...taskForm, priority: e.target.value })}>
                                            <option value="low">Baixa Prioridade</option>
                                            <option value="medium">Média Prioridade</option>
                                            <option value="high">Alta Prioridade</option>
                                        </select>
                                        <input type="date" className="w-full border rounded px-3 py-2" value={taskForm.dueDate} onChange={(e) => setTaskForm({ ...taskForm, dueDate: e.target.value })} />
                                        <input type="text" placeholder="Responsável" className="w-full border rounded px-3 py-2" value={taskForm.assignee} onChange={(e) => setTaskForm({ ...taskForm, assignee: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowTaskModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addTask} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Criar Tarefa</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Sistema de Gestão de Riscos
            const RisksManager = () => {
                const [riskForm, setRiskForm] = useState({ description: '', probability: 3, impact: 3, mitigation: '', owner: '', category: 'technical' });
                const [showRiskModal, setShowRiskModal] = useState(false);

                const addRisk = () => {
                    const newRisk = { ...riskForm, id: Date.now(), projectId: activeProject?.id, status: 'open', createdAt: new Date().toISOString(), score: riskForm.probability * riskForm.impact };
                    setRisks([...risks, newRisk]);
                    setShowRiskModal(false);
                    setRiskForm({ description: '', probability: 3, impact: 3, mitigation: '', owner: '', category: 'technical' });
                    addNotification('warning', 'Risco Registrado', 'Novo risco adicionado ao projeto');
                };

                const updateRiskStatus = (riskId, newStatus) => {
                    setRisks(risks.map(r => r.id === riskId ? { ...r, status: newStatus } : r));
                };

                const projectRisks = risks.filter(r => r.projectId === activeProject?.id);

                const getRiskLevel = (score) => {
                    if (score >= 15) return { label: 'Crítico', class: 'risk-critical' };
                    if (score >= 10) return { label: 'Alto', class: 'risk-high' };
                    if (score >= 5) return { label: 'Médio', class: 'risk-medium' };
                    return { label: 'Baixo', class: 'risk-low' };
                };

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gestão de Riscos</h2>
                            <button onClick={() => setShowRiskModal(true)} className="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 flex items-center gap-2">
                                <i data-lucide="alert-triangle" className="w-4 h-4"></i> Novo Risco
                            </button>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div className="card">
                                <h3 className="font-semibold text-red-600 mb-2">Riscos Críticos</h3>
                                <p className="text-3xl font-bold">{projectRisks.filter(r => r.score >= 15 && r.status === 'open').length}</p>
                            </div>
                            <div className="card">
                                <h3 className="font-semibold text-orange-600 mb-2">Riscos Altos</h3>
                                <p className="text-3xl font-bold">{projectRisks.filter(r => r.score >= 10 && r.score < 15 && r.status === 'open').length}</p>
                            </div>
                            <div className="card">
                                <h3 className="font-semibold text-green-600 mb-2">Riscos Mitigados</h3>
                                <p className="text-3xl font-bold">{projectRisks.filter(r => r.status === 'mitigated').length}</p>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Matriz de Riscos</h3>
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b">
                                            <th className="text-left p-2">Descrição</th>
                                            <th className="text-center p-2">Probabilidade</th>
                                            <th className="text-center p-2">Impacto</th>
                                            <th className="text-center p-2">Score</th>
                                            <th className="text-center p-2">Nível</th>
                                            <th className="text-center p-2">Status</th>
                                            <th className="text-center p-2">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {projectRisks.map(risk => {
                                            const level = getRiskLevel(risk.score);
                                            return (
                                                <tr key={risk.id} className="border-b hover:bg-gray-50">
                                                    <td className="p-2">
                                                        <div className="font-medium">{risk.description}</div>
                                                        <div className="text-sm text-gray-600">{risk.mitigation}</div>
                                                    </td>
                                                    <td className="text-center p-2">{risk.probability}/5</td>
                                                    <td className="text-center p-2">{risk.impact}/5</td>
                                                    <td className="text-center p-2 font-bold">{risk.score}</td>
                                                    <td className="text-center p-2">
                                                        <span className={`badge ${level.class}`}>{level.label}</span>
                                                    </td>
                                                    <td className="text-center p-2">
                                                        <span className={`badge ${risk.status === 'open' ? 'badge-danger' : risk.status === 'mitigated' ? 'badge-success' : 'badge-info'}`}>
                                                            {risk.status}
                                                        </span>
                                                    </td>
                                                    <td className="text-center p-2">
                                                        {risk.status === 'open' && (
                                                            <button onClick={() => updateRiskStatus(risk.id, 'mitigated')} className="text-xs px-2 py-1 bg-green-500 text-white rounded">Mitigar</button>
                                                        )}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Modal Novo Risco */}
                        {showRiskModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                    <h3 className="text-xl font-bold mb-4">Registrar Novo Risco</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <textarea placeholder="Descrição do risco" className="w-full border rounded px-3 py-2" rows="3" value={riskForm.description} onChange={(e) => setRiskForm({ ...riskForm, description: e.target.value })} />
                                            {geminiApiKey && riskForm.description.length > 20 && (
                                                <button
                                                    onClick={async () => {
                                                        const analysis = await analyzeRiskWithAI(riskForm.description);
                                                        if (analysis) {
                                                            setRiskForm({
                                                                ...riskForm,
                                                                probability: analysis.probabilidade || riskForm.probability,
                                                                impact: analysis.impacto || riskForm.impact,
                                                                category: analysis.categoria?.toLowerCase() === 'técnico' ? 'technical' :
                                                                         analysis.categoria?.toLowerCase() === 'financeiro' ? 'financial' :
                                                                         analysis.categoria?.toLowerCase() === 'operacional' ? 'operational' :
                                                                         analysis.categoria?.toLowerCase() === 'externo' ? 'external' : riskForm.category,
                                                                mitigation: analysis.mitigacao || riskForm.mitigation
                                                            });
                                                            addNotification('success', 'IA Análise Completa', 'Campos preenchidos com sugestões da IA');
                                                        }
                                                    }}
                                                    disabled={aiLoading}
                                                    className="mt-2 w-full px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 flex items-center justify-center gap-2 text-sm"
                                                >
                                                    {aiLoading ? (
                                                        <>
                                                            <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                            Analisando...
                                                        </>
                                                    ) : (
                                                        <>
                                                            <i data-lucide="sparkles" className="w-4 h-4"></i>
                                                            Analisar Risco com IA
                                                        </>
                                                    )}
                                                </button>
                                            )}
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Probabilidade (1-5)</label>
                                                <input type="number" min="1" max="5" className="w-full border rounded px-3 py-2" value={riskForm.probability} onChange={(e) => setRiskForm({ ...riskForm, probability: parseInt(e.target.value) })} />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Impacto (1-5)</label>
                                                <input type="number" min="1" max="5" className="w-full border rounded px-3 py-2" value={riskForm.impact} onChange={(e) => setRiskForm({ ...riskForm, impact: parseInt(e.target.value) })} />
                                            </div>
                                        </div>
                                        <textarea placeholder="Plano de mitigação" className="w-full border rounded px-3 py-2" rows="2" value={riskForm.mitigation} onChange={(e) => setRiskForm({ ...riskForm, mitigation: e.target.value })} />
                                        <input type="text" placeholder="Responsável" className="w-full border rounded px-3 py-2" value={riskForm.owner} onChange={(e) => setRiskForm({ ...riskForm, owner: e.target.value })} />
                                        <select className="w-full border rounded px-3 py-2" value={riskForm.category} onChange={(e) => setRiskForm({ ...riskForm, category: e.target.value })}>
                                            <option value="technical">Técnico</option>
                                            <option value="financial">Financeiro</option>
                                            <option value="operational">Operacional</option>
                                            <option value="external">Externo</option>
                                        </select>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowRiskModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addRisk} className="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">Registrar Risco</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Sistema de Stakeholders
            const StakeholdersManager = () => {
                const [stakeholderForm, setStakeholderForm] = useState({ name: '', role: '', email: '', phone: '', interest: 3, power: 3, strategy: '' });
                const [showStakeholderModal, setShowStakeholderModal] = useState(false);

                const addStakeholder = () => {
                    const newStakeholder = { ...stakeholderForm, id: Date.now(), projectId: activeProject?.id, createdAt: new Date().toISOString() };
                    setStakeholders([...stakeholders, newStakeholder]);
                    setShowStakeholderModal(false);
                    setStakeholderForm({ name: '', role: '', email: '', phone: '', interest: 3, power: 3, strategy: '' });
                    addNotification('success', 'Stakeholder Adicionado', 'Novo stakeholder registrado com sucesso');
                };

                const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject?.id);

                // Matriz Poder/Interesse
                const getQuadrant = (power, interest) => {
                    if (power >= 3 && interest >= 3) return 'manage';
                    if (power >= 3 && interest < 3) return 'satisfy';
                    if (power < 3 && interest >= 3) return 'inform';
                    return 'monitor';
                };

                const quadrants = {
                    manage: projectStakeholders.filter(s => getQuadrant(s.power, s.interest) === 'manage'),
                    satisfy: projectStakeholders.filter(s => getQuadrant(s.power, s.interest) === 'satisfy'),
                    inform: projectStakeholders.filter(s => getQuadrant(s.power, s.interest) === 'inform'),
                    monitor: projectStakeholders.filter(s => getQuadrant(s.power, s.interest) === 'monitor')
                };

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Gestão de Stakeholders</h2>
                            <button onClick={() => setShowStakeholderModal(true)} className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2">
                                <i data-lucide="users" className="w-4 h-4"></i> Novo Stakeholder
                            </button>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div className="card">
                                <h3 className="text-lg font-semibold mb-4">Matriz Poder/Interesse</h3>
                                <div className="stakeholder-matrix">
                                    <div className="matrix-quadrant bg-red-50">
                                        <div className="quadrant-label text-red-700">Gerenciar de Perto ({quadrants.manage.length})</div>
                                        {quadrants.manage.map(s => (
                                            <div key={s.id} className="stakeholder-badge">{s.name}</div>
                                        ))}
                                    </div>
                                    <div className="matrix-quadrant bg-yellow-50">
                                        <div className="quadrant-label text-yellow-700">Manter Satisfeito ({quadrants.satisfy.length})</div>
                                        {quadrants.satisfy.map(s => (
                                            <div key={s.id} className="stakeholder-badge">{s.name}</div>
                                        ))}
                                    </div>
                                    <div className="matrix-quadrant bg-blue-50">
                                        <div className="quadrant-label text-blue-700">Manter Informado ({quadrants.inform.length})</div>
                                        {quadrants.inform.map(s => (
                                            <div key={s.id} className="stakeholder-badge">{s.name}</div>
                                        ))}
                                    </div>
                                    <div className="matrix-quadrant bg-gray-50">
                                        <div className="quadrant-label text-gray-700">Monitorar ({quadrants.monitor.length})</div>
                                        {quadrants.monitor.map(s => (
                                            <div key={s.id} className="stakeholder-badge">{s.name}</div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            <div className="card">
                                <h3 className="text-lg font-semibold mb-4">Lista de Stakeholders</h3>
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {projectStakeholders.map(stakeholder => (
                                        <div key={stakeholder.id} className="p-3 bg-gray-50 rounded border">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <h4 className="font-semibold">{stakeholder.name}</h4>
                                                    <p className="text-sm text-gray-600">{stakeholder.role}</p>
                                                    <p className="text-xs text-gray-500">{stakeholder.email}</p>
                                                </div>
                                                <div className="text-right text-xs">
                                                    <div>Poder: {stakeholder.power}/5</div>
                                                    <div>Interesse: {stakeholder.interest}/5</div>
                                                </div>
                                            </div>
                                            {stakeholder.strategy && (
                                                <p className="text-sm mt-2 text-gray-700">Estratégia: {stakeholder.strategy}</p>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Modal Novo Stakeholder */}
                        {showStakeholderModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                    <h3 className="text-xl font-bold mb-4">Novo Stakeholder</h3>
                                    <div className="space-y-4">
                                        <input type="text" placeholder="Nome completo" className="w-full border rounded px-3 py-2" value={stakeholderForm.name} onChange={(e) => setStakeholderForm({ ...stakeholderForm, name: e.target.value })} />
                                        <input type="text" placeholder="Cargo/Função" className="w-full border rounded px-3 py-2" value={stakeholderForm.role} onChange={(e) => setStakeholderForm({ ...stakeholderForm, role: e.target.value })} />
                                        <input type="email" placeholder="Email" className="w-full border rounded px-3 py-2" value={stakeholderForm.email} onChange={(e) => setStakeholderForm({ ...stakeholderForm, email: e.target.value })} />
                                        <input type="tel" placeholder="Telefone" className="w-full border rounded px-3 py-2" value={stakeholderForm.phone} onChange={(e) => setStakeholderForm({ ...stakeholderForm, phone: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Poder (1-5)</label>
                                                <input type="number" min="1" max="5" className="w-full border rounded px-3 py-2" value={stakeholderForm.power} onChange={(e) => setStakeholderForm({ ...stakeholderForm, power: parseInt(e.target.value) })} />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Interesse (1-5)</label>
                                                <input type="number" min="1" max="5" className="w-full border rounded px-3 py-2" value={stakeholderForm.interest} onChange={(e) => setStakeholderForm({ ...stakeholderForm, interest: parseInt(e.target.value) })} />
                                            </div>
                                        </div>
                                        <textarea placeholder="Estratégia de engajamento" className="w-full border rounded px-3 py-2" rows="2" value={stakeholderForm.strategy} onChange={(e) => setStakeholderForm({ ...stakeholderForm, strategy: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowStakeholderModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addStakeholder} className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">Adicionar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo de Relatórios
            const ReportsModule = () => {
                const projectTasks = tasks.filter(t => t.projectId === activeProject?.id);
                const projectRisks = risks.filter(r => r.projectId === activeProject?.id);
                const projectStakeholders = stakeholders.filter(s => s.projectId === activeProject?.id);

                const stats = {
                    tasksCompleted: projectTasks.filter(t => t.status === 'done').length,
                    tasksTotal: projectTasks.length,
                    risksOpen: projectRisks.filter(r => r.status === 'open').length,
                    risksCritical: projectRisks.filter(r => r.score >= 15 && r.status === 'open').length,
                    stakeholdersTotal: projectStakeholders.length,
                    completionRate: projectTasks.length > 0 ? Math.round((projectTasks.filter(t => t.status === 'done').length / projectTasks.length) * 100) : 0
                };

                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold mb-6">Relatórios e Análises</h2>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div className="card bg-blue-50">
                                <h3 className="text-sm font-medium text-blue-700">Taxa de Conclusão</h3>
                                <p className="text-3xl font-bold text-blue-900">{stats.completionRate}%</p>
                                <div className="progress-bar mt-2">
                                    <div className="progress-fill" style={{ width: `${stats.completionRate}%` }}></div>
                                </div>
                            </div>
                            <div className="card bg-green-50">
                                <h3 className="text-sm font-medium text-green-700">Tarefas Concluídas</h3>
                                <p className="text-3xl font-bold text-green-900">{stats.tasksCompleted}/{stats.tasksTotal}</p>
                            </div>
                            <div className="card bg-orange-50">
                                <h3 className="text-sm font-medium text-orange-700">Riscos Abertos</h3>
                                <p className="text-3xl font-bold text-orange-900">{stats.risksOpen}</p>
                                <p className="text-xs text-orange-600 mt-1">{stats.risksCritical} críticos</p>
                            </div>
                            <div className="card bg-purple-50">
                                <h3 className="text-sm font-medium text-purple-700">Stakeholders</h3>
                                <p className="text-3xl font-bold text-purple-900">{stats.stakeholdersTotal}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="card">
                                <h3 className="text-lg font-semibold mb-4">Resumo do Projeto</h3>
                                <div className="space-y-3">
                                    <div className="flex justify-between py-2 border-b">
                                        <span className="text-gray-600">Nome:</span>
                                        <span className="font-medium">{activeProject?.name}</span>
                                    </div>
                                    <div className="flex justify-between py-2 border-b">
                                        <span className="text-gray-600">Status:</span>
                                        <span className={`badge ${activeProject?.status === 'active' ? 'badge-success' : 'badge-info'}`}>{activeProject?.status}</span>
                                    </div>
                                    <div className="flex justify-between py-2 border-b">
                                        <span className="text-gray-600">Data Início:</span>
                                        <span className="font-medium">{activeProject?.startDate ? new Date(activeProject.startDate).toLocaleDateString('pt-BR') : 'N/A'}</span>
                                    </div>
                                    <div className="flex justify-between py-2 border-b">
                                        <span className="text-gray-600">Data Fim:</span>
                                        <span className="font-medium">{activeProject?.endDate ? new Date(activeProject.endDate).toLocaleDateString('pt-BR') : 'N/A'}</span>
                                    </div>
                                    <div className="flex justify-between py-2">
                                        <span className="text-gray-600">Orçamento:</span>
                                        <span className="font-medium">{activeProject?.budget || 'N/A'}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="card">
                                <h3 className="text-lg font-semibold mb-4">Principais Indicadores</h3>
                                <div className="space-y-4">
                                    <div>
                                        <div className="flex justify-between mb-1">
                                            <span className="text-sm">Progresso Geral</span>
                                            <span className="text-sm font-medium">{stats.completionRate}%</span>
                                        </div>
                                        <div className="progress-bar">
                                            <div className="progress-fill" style={{ width: `${stats.completionRate}%` }}></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div className="flex justify-between mb-1">
                                            <span className="text-sm">Riscos Mitigados</span>
                                            <span className="text-sm font-medium">{projectRisks.filter(r => r.status === 'mitigated').length}/{projectRisks.length}</span>
                                        </div>
                                        <div className="progress-bar">
                                            <div className="progress-fill bg-orange-500" style={{ width: `${projectRisks.length > 0 ? (projectRisks.filter(r => r.status === 'mitigated').length / projectRisks.length) * 100 : 0}%` }}></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div className="flex justify-between mb-1">
                                            <span className="text-sm">Engajamento Stakeholders</span>
                                            <span className="text-sm font-medium">{stats.stakeholdersTotal} registrados</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="mt-6 flex gap-4">
                            <button onClick={exportToPDF} className="px-6 py-3 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2">
                                <i data-lucide="file-text" className="w-5 h-5"></i> Exportar Relatório PDF
                            </button>
                            <button onClick={syncWithGoogleCalendar} className="px-6 py-3 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2">
                                <i data-lucide="calendar" className="w-5 h-5"></i> Exportar para Calendário
                            </button>
                        </div>
                    </div>
                );
            };

            // Módulo ISO: Não Conformidades e Ações Corretivas (8.7, 10.2)
            const NonConformitiesModule = () => {
                const [nonConformities, setNonConformities] = useState([]);
                const [showNCModal, setShowNCModal] = useState(false);
                const [ncForm, setNcForm] = useState({ title: '', description: '', source: 'internal', severity: 'minor', responsable: '', rootCause: '', correctiveAction: '', preventiveAction: '', deadline: '' });

                useEffect(() => {
                    const saved = localStorage.getItem('pmbok_nonconformities');
                    if (saved) setNonConformities(JSON.parse(saved));
                }, []);

                useEffect(() => {
                    localStorage.setItem('pmbok_nonconformities', JSON.stringify(nonConformities));
                }, [nonConformities]);

                const addNC = () => {
                    const newNC = { ...ncForm, id: Date.now(), projectId: activeProject?.id, status: 'open', createdAt: new Date().toISOString() };
                    setNonConformities([...nonConformities, newNC]);
                    setShowNCModal(false);
                    setNcForm({ title: '', description: '', source: 'internal', severity: 'minor', responsable: '', rootCause: '', correctiveAction: '', preventiveAction: '', deadline: '' });
                    addNotification('warning', 'NC Registrada', 'Não conformidade registrada com sucesso');
                };

                const updateNCStatus = (id, newStatus) => {
                    setNonConformities(nonConformities.map(nc => nc.id === id ? { ...nc, status: newStatus, closedAt: new Date().toISOString() } : nc));
                    addNotification('success', 'NC Atualizada', `Status alterado para ${newStatus}`);
                };

                const projectNCs = nonConformities.filter(nc => nc.projectId === activeProject?.id);
                const openNCs = projectNCs.filter(nc => nc.status === 'open');
                const closedNCs = projectNCs.filter(nc => nc.status === 'closed');

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Não Conformidades (ISO 8.7, 10.2)</h2>
                                <p className="text-sm text-gray-600">Controle de não conformidades e ações corretivas</p>
                            </div>
                            <button onClick={() => setShowNCModal(true)} className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 flex items-center gap-2">
                                <i data-lucide="alert-octagon" className="w-4 h-4"></i> Registrar NC
                            </button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div className="card bg-red-50">
                                <h3 className="text-sm font-medium text-red-700">NCs Abertas</h3>
                                <p className="text-3xl font-bold text-red-900">{openNCs.length}</p>
                            </div>
                            <div className="card bg-green-50">
                                <h3 className="text-sm font-medium text-green-700">NCs Fechadas</h3>
                                <p className="text-3xl font-bold text-green-900">{closedNCs.length}</p>
                            </div>
                            <div className="card bg-blue-50">
                                <h3 className="text-sm font-medium text-blue-700">Total</h3>
                                <p className="text-3xl font-bold text-blue-900">{projectNCs.length}</p>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6">
                            <h3 className="text-lg font-semibold mb-4">Registro de Não Conformidades</h3>
                            <div className="space-y-4">
                                {projectNCs.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">Nenhuma não conformidade registrada</p>
                                ) : (
                                    projectNCs.map(nc => (
                                        <div key={nc.id} className={`border-l-4 p-4 rounded ${nc.status === 'open' ? 'border-red-500 bg-red-50' : 'border-green-500 bg-green-50'}`}>
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <h4 className="font-semibold text-lg">{nc.title}</h4>
                                                    <p className="text-sm text-gray-600">{nc.description}</p>
                                                </div>
                                                <span className={`badge ${nc.severity === 'critical' ? 'badge-danger' : nc.severity === 'major' ? 'badge-warning' : 'badge-info'}`}>
                                                    {nc.severity}
                                                </span>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4 mt-3 text-sm">
                                                <div><strong>Fonte:</strong> {nc.source}</div>
                                                <div><strong>Responsável:</strong> {nc.responsable}</div>
                                                <div><strong>Prazo:</strong> {nc.deadline ? new Date(nc.deadline).toLocaleDateString('pt-BR') : 'N/A'}</div>
                                                <div><strong>Status:</strong> <span className={`badge ${nc.status === 'open' ? 'badge-danger' : 'badge-success'}`}>{nc.status}</span></div>
                                            </div>
                                            {nc.rootCause && (
                                                <div className="mt-3 p-3 bg-white rounded">
                                                    <strong className="text-sm">Causa Raiz:</strong>
                                                    <p className="text-sm text-gray-700">{nc.rootCause}</p>
                                                </div>
                                            )}
                                            {nc.correctiveAction && (
                                                <div className="mt-2 p-3 bg-white rounded">
                                                    <strong className="text-sm">Ação Corretiva:</strong>
                                                    <p className="text-sm text-gray-700">{nc.correctiveAction}</p>
                                                </div>
                                            )}
                                            {nc.status === 'open' && (
                                                <button onClick={() => updateNCStatus(nc.id, 'closed')} className="mt-3 px-4 py-2 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                                                    Fechar NC
                                                </button>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {showNCModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
                                    <h3 className="text-xl font-bold mb-4">Registrar Não Conformidade</h3>
                                    <div className="space-y-4">
                                        <input type="text" placeholder="Título da NC" className="w-full border rounded px-3 py-2" value={ncForm.title} onChange={(e) => setNcForm({ ...ncForm, title: e.target.value })} />
                                        <div>
                                            <textarea placeholder="Descrição detalhada" className="w-full border rounded px-3 py-2" rows="3" value={ncForm.description} onChange={(e) => setNcForm({ ...ncForm, description: e.target.value })} />
                                            {geminiApiKey && ncForm.description.length > 20 && (
                                                <button
                                                    onClick={async () => {
                                                        const analysis = await analyzeNonConformityWithAI(ncForm.description);
                                                        if (analysis) {
                                                            setNcForm({
                                                                ...ncForm,
                                                                severity: analysis.gravidade?.toLowerCase() === 'baixa' ? 'minor' :
                                                                         analysis.gravidade?.toLowerCase() === 'média' ? 'major' :
                                                                         analysis.gravidade?.toLowerCase() === 'alta' || analysis.gravidade?.toLowerCase() === 'crítica' ? 'critical' : ncForm.severity,
                                                                rootCause: analysis.causasRaiz || ncForm.rootCause,
                                                                correctiveAction: analysis.acoesCorretivas || ncForm.correctiveAction,
                                                                preventiveAction: analysis.acoesPreventivas || ncForm.preventiveAction
                                                            });
                                                            addNotification('success', 'IA Análise Completa', 'Campos preenchidos com sugestões da IA');
                                                        }
                                                    }}
                                                    disabled={aiLoading}
                                                    className="mt-2 w-full px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 flex items-center justify-center gap-2 text-sm"
                                                >
                                                    {aiLoading ? (
                                                        <>
                                                            <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                            Analisando...
                                                        </>
                                                    ) : (
                                                        <>
                                                            <i data-lucide="sparkles" className="w-4 h-4"></i>
                                                            Analisar NC com IA
                                                        </>
                                                    )}
                                                </button>
                                            )}
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Fonte</label>
                                                <select className="w-full border rounded px-3 py-2" value={ncForm.source} onChange={(e) => setNcForm({ ...ncForm, source: e.target.value })}>
                                                    <option value="internal">Auditoria Interna</option>
                                                    <option value="external">Auditoria Externa</option>
                                                    <option value="customer">Reclamação Cliente</option>
                                                    <option value="process">Processo</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Severidade</label>
                                                <select className="w-full border rounded px-3 py-2" value={ncForm.severity} onChange={(e) => setNcForm({ ...ncForm, severity: e.target.value })}>
                                                    <option value="minor">Menor</option>
                                                    <option value="major">Maior</option>
                                                    <option value="critical">Crítica</option>
                                                </select>
                                            </div>
                                        </div>
                                        <input type="text" placeholder="Responsável" className="w-full border rounded px-3 py-2" value={ncForm.responsable} onChange={(e) => setNcForm({ ...ncForm, responsable: e.target.value })} />
                                        <textarea placeholder="Análise de Causa Raiz (5 Porquês, Ishikawa)" className="w-full border rounded px-3 py-2" rows="2" value={ncForm.rootCause} onChange={(e) => setNcForm({ ...ncForm, rootCause: e.target.value })} />
                                        <textarea placeholder="Ação Corretiva" className="w-full border rounded px-3 py-2" rows="2" value={ncForm.correctiveAction} onChange={(e) => setNcForm({ ...ncForm, correctiveAction: e.target.value })} />
                                        <textarea placeholder="Ação Preventiva" className="w-full border rounded px-3 py-2" rows="2" value={ncForm.preventiveAction} onChange={(e) => setNcForm({ ...ncForm, preventiveAction: e.target.value })} />
                                        <input type="date" className="w-full border rounded px-3 py-2" value={ncForm.deadline} onChange={(e) => setNcForm({ ...ncForm, deadline: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowNCModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addNC} className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Registrar NC</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo ISO: Política da Qualidade (5.2)
            const QualityPolicyModule = () => {
                const [policy, setPolicy] = useState({ text: '', approvedBy: '', approvedDate: '', version: '1.0', commitments: [] });
                const [isEditing, setIsEditing] = useState(false);

                useEffect(() => {
                    const saved = localStorage.getItem('pmbok_quality_policy');
                    if (saved) setPolicy(JSON.parse(saved));
                }, []);

                useEffect(() => {
                    localStorage.setItem('pmbok_quality_policy', JSON.stringify(policy));
                }, [policy]);

                const savePolicy = () => {
                    setPolicy({ ...policy, approvedDate: new Date().toISOString() });
                    setIsEditing(false);
                    addNotification('success', 'Política Salva', 'Política da Qualidade atualizada com sucesso');
                };

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Política da Qualidade (ISO 5.2)</h2>
                                <p className="text-sm text-gray-600">Definição e comunicação da política da qualidade</p>
                            </div>
                            <button onClick={() => setIsEditing(!isEditing)} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2">
                                <i data-lucide={isEditing ? 'x' : 'edit'} className="w-4 h-4"></i>
                                {isEditing ? 'Cancelar' : 'Editar'}
                            </button>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6">
                            {isEditing ? (
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Política da Qualidade</label>
                                        <textarea className="w-full border rounded px-3 py-2" rows="10" value={policy.text} onChange={(e) => setPolicy({ ...policy, text: e.target.value })} placeholder="Digite a política da qualidade da organização...&#10;&#10;Exemplo:&#10;'Nossa organização está comprometida em:&#10;- Satisfazer os requisitos dos clientes&#10;- Melhoria contínua dos processos&#10;- Conformidade com requisitos aplicáveis&#10;- Desenvolvimento de competências da equipe'" />
                                        {geminiApiKey && (
                                            <button
                                                onClick={async () => {
                                                    const generatedPolicy = await generateQualityPolicyWithAI(
                                                        currentUser?.company || 'Organização',
                                                        activeProject?.name || 'Gestão de Projetos'
                                                    );
                                                    if (generatedPolicy) {
                                                        setPolicy({ ...policy, text: generatedPolicy });
                                                        addNotification('success', 'Política Gerada', 'Política da Qualidade gerada pela IA com sucesso!');
                                                    }
                                                }}
                                                disabled={aiLoading}
                                                className="mt-2 w-full px-3 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 flex items-center justify-center gap-2 text-sm"
                                            >
                                                {aiLoading ? (
                                                    <>
                                                        <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                        Gerando...
                                                    </>
                                                ) : (
                                                    <>
                                                        <i data-lucide="sparkles" className="w-4 h-4"></i>
                                                        Gerar Política com IA
                                                    </>
                                                )}
                                            </button>
                                        )}
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Aprovado por</label>
                                            <input type="text" className="w-full border rounded px-3 py-2" value={policy.approvedBy} onChange={(e) => setPolicy({ ...policy, approvedBy: e.target.value })} placeholder="Nome do Diretor/CEO" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Versão</label>
                                            <input type="text" className="w-full border rounded px-3 py-2" value={policy.version} onChange={(e) => setPolicy({ ...policy, version: e.target.value })} />
                                        </div>
                                    </div>
                                    <button onClick={savePolicy} className="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600">Salvar Política</button>
                                </div>
                            ) : (
                                <div>
                                    {policy.text ? (
                                        <div>
                                            <div className="prose max-w-none">
                                                <div className="whitespace-pre-wrap border-l-4 border-blue-500 pl-4 py-2 bg-blue-50 rounded">{policy.text}</div>
                                            </div>
                                            <div className="mt-6 pt-6 border-t">
                                                <div className="grid grid-cols-3 gap-4 text-sm">
                                                    <div><strong>Aprovado por:</strong> {policy.approvedBy || 'Não definido'}</div>
                                                    <div><strong>Data:</strong> {policy.approvedDate ? new Date(policy.approvedDate).toLocaleDateString('pt-BR') : 'Não aprovado'}</div>
                                                    <div><strong>Versão:</strong> {policy.version}</div>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center py-12 text-gray-500">
                                            <i data-lucide="file-text" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                            <p>Nenhuma política da qualidade definida</p>
                                            <button onClick={() => setIsEditing(true)} className="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Criar Política</button>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        <div className="mt-6 bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                            <h4 className="font-semibold mb-2">Requisitos ISO 9001:2015 - Cláusula 5.2</h4>
                            <ul className="text-sm space-y-1 text-gray-700">
                                <li>✓ Apropriada ao propósito e contexto da organização</li>
                                <li>✓ Provê estrutura para estabelecer objetivos da qualidade</li>
                                <li>✓ Inclui compromisso em satisfazer requisitos aplicáveis</li>
                                <li>✓ Inclui compromisso com melhoria contínua do SGQ</li>
                                <li>✓ Disponível como informação documentada</li>
                                <li>✓ Comunicada, compreendida e aplicada na organização</li>
                                <li>✓ Disponível para partes interessadas relevantes</li>
                            </ul>
                        </div>
                    </div>
                );
            };

            // Módulo WBS (Work Breakdown Structure)
            const WBSModule = () => {
                const [wbsForm, setWbsForm] = useState({ id: '', name: '', parent: '', level: 1, deliverable: '', responsible: '', status: 'not_started' });
                const [showWbsModal, setShowWbsModal] = useState(false);

                const addWbsItem = () => {
                    const newItem = { ...wbsForm, id: Date.now(), projectId: activeProject?.id };
                    setWbs([...wbs, newItem]);
                    setWbsForm({ id: '', name: '', parent: '', level: 1, deliverable: '', responsible: '', status: 'not_started' });
                    setShowWbsModal(false);
                    addNotification('success', 'WBS Item Criado', 'Item adicionado à estrutura analítica');
                };

                const filteredWbs = wbs.filter(item => !activeProject || item.projectId === activeProject.id);
                const wbsTree = filteredWbs.filter(item => !item.parent);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">WBS - Estrutura Analítica do Projeto</h2>
                                <p className="text-sm text-gray-600">Work Breakdown Structure (PMBOK 7)</p>
                            </div>
                            <button onClick={() => setShowWbsModal(true)} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2">
                                <i data-lucide="plus" className="w-4 h-4"></i> Novo Item WBS
                            </button>
                        </div>

                        {filteredWbs.length === 0 ? (
                            <div className="bg-white rounded-lg p-8 text-center">
                                <i data-lucide="network" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                <p className="text-gray-500">Nenhum item WBS criado</p>
                            </div>
                        ) : (
                            <div className="bg-white rounded-lg p-6">
                                {wbsTree.map(item => (
                                    <div key={item.id} className="mb-4 p-4 border rounded-lg">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <h3 className="font-bold text-lg">{item.name}</h3>
                                                <p className="text-sm text-gray-600 mt-1">Nível {item.level} | {item.deliverable}</p>
                                                <p className="text-sm text-gray-500">Responsável: {item.responsible}</p>
                                                <span className={`inline-block mt-2 px-2 py-1 text-xs rounded ${
                                                    item.status === 'completed' ? 'bg-green-100 text-green-700' :
                                                    item.status === 'in_progress' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-700'
                                                }`}>
                                                    {item.status === 'completed' ? 'Concluído' : item.status === 'in_progress' ? 'Em Progresso' : 'Não Iniciado'}
                                                </span>
                                            </div>
                                        </div>
                                        {filteredWbs.filter(sub => sub.parent === item.id.toString()).map(subItem => (
                                            <div key={subItem.id} className="ml-6 mt-3 p-3 border-l-2 border-blue-300 bg-blue-50">
                                                <h4 className="font-semibold">{subItem.name}</h4>
                                                <p className="text-xs text-gray-600">{subItem.deliverable}</p>
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        )}

                        {showWbsModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Novo Item WBS</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Nome do Item" className="w-full border rounded px-3 py-2" value={wbsForm.name} onChange={(e) => setWbsForm({ ...wbsForm, name: e.target.value })} />
                                        <select className="w-full border rounded px-3 py-2" value={wbsForm.parent} onChange={(e) => setWbsForm({ ...wbsForm, parent: e.target.value })}>
                                            <option value="">Item Raiz (Nível 1)</option>
                                            {filteredWbs.filter(i => i.level === 1).map(item => (
                                                <option key={item.id} value={item.id}>{item.name}</option>
                                            ))}
                                        </select>
                                        <input placeholder="Entrega Associada" className="w-full border rounded px-3 py-2" value={wbsForm.deliverable} onChange={(e) => setWbsForm({ ...wbsForm, deliverable: e.target.value })} />
                                        <input placeholder="Responsável" className="w-full border rounded px-3 py-2" value={wbsForm.responsible} onChange={(e) => setWbsForm({ ...wbsForm, responsible: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowWbsModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addWbsItem} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Criar Item</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo Lições Aprendidas
            const LessonsLearnedModule = () => {
                const [lessonForm, setLessonForm] = useState({ title: '', description: '', category: 'technical', phase: 'planning', impact: 'medium' });
                const [showLessonModal, setShowLessonModal] = useState(false);

                const addLesson = () => {
                    const newLesson = { ...lessonForm, id: Date.now(), projectId: activeProject?.id, date: new Date().toISOString() };
                    setLessons([...lessons, newLesson]);
                    setLessonForm({ title: '', description: '', category: 'technical', phase: 'planning', impact: 'medium' });
                    setShowLessonModal(false);
                    addNotification('success', 'Lição Registrada', 'Lição aprendida salva com sucesso');
                };

                const filteredLessons = lessons.filter(l => !activeProject || l.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Lições Aprendidas</h2>
                                <p className="text-sm text-gray-600">Registro de aprendizados do projeto (PMBOK 7)</p>
                            </div>
                            <button onClick={() => setShowLessonModal(true)} className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2">
                                <i data-lucide="lightbulb" className="w-4 h-4"></i> Nova Lição
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredLessons.map(lesson => (
                                <div key={lesson.id} className="bg-white rounded-lg p-6 shadow">
                                    <div className="flex justify-between items-start mb-3">
                                        <h3 className="font-bold text-lg">{lesson.title}</h3>
                                        <div className="flex gap-2">
                                            <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">{lesson.category}</span>
                                            <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">{lesson.phase}</span>
                                        </div>
                                    </div>
                                    <p className="text-gray-700 mb-3">{lesson.description}</p>
                                    <div className="flex items-center justify-between text-sm text-gray-500">
                                        <span>Impacto: {lesson.impact === 'high' ? 'Alto' : lesson.impact === 'medium' ? 'Médio' : 'Baixo'}</span>
                                        <span>{new Date(lesson.date).toLocaleDateString('pt-BR')}</span>
                                    </div>
                                </div>
                            ))}
                            {filteredLessons.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="lightbulb" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhuma lição aprendida registrada</p>
                                </div>
                            )}
                        </div>

                        {showLessonModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Registrar Lição Aprendida</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Título da Lição" className="w-full border rounded px-3 py-2" value={lessonForm.title} onChange={(e) => setLessonForm({ ...lessonForm, title: e.target.value })} />
                                        <textarea placeholder="Descrição detalhada" className="w-full border rounded px-3 py-2" rows="4" value={lessonForm.description} onChange={(e) => setLessonForm({ ...lessonForm, description: e.target.value })} />
                                        <div className="grid grid-cols-3 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Categoria</label>
                                                <select className="w-full border rounded px-3 py-2" value={lessonForm.category} onChange={(e) => setLessonForm({ ...lessonForm, category: e.target.value })}>
                                                    <option value="technical">Técnico</option>
                                                    <option value="management">Gestão</option>
                                                    <option value="communication">Comunicação</option>
                                                    <option value="team">Equipe</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Fase</label>
                                                <select className="w-full border rounded px-3 py-2" value={lessonForm.phase} onChange={(e) => setLessonForm({ ...lessonForm, phase: e.target.value })}>
                                                    <option value="planning">Planejamento</option>
                                                    <option value="execution">Execução</option>
                                                    <option value="monitoring">Monitoramento</option>
                                                    <option value="closing">Encerramento</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Impacto</label>
                                                <select className="w-full border rounded px-3 py-2" value={lessonForm.impact} onChange={(e) => setLessonForm({ ...lessonForm, impact: e.target.value })}>
                                                    <option value="high">Alto</option>
                                                    <option value="medium">Médio</option>
                                                    <option value="low">Baixo</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowLessonModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addLesson} className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">Salvar Lição</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo Gestão de Entregas (Deliverables)
            const DeliverablesModule = () => {
                const [delivForm, setDelivForm] = useState({ name: '', description: '', deadline: '', status: 'pending', responsible: '', type: 'document' });
                const [showDelivModal, setShowDelivModal] = useState(false);

                const addDeliverable = () => {
                    const newDeliv = { ...delivForm, id: Date.now(), projectId: activeProject?.id, createdAt: new Date().toISOString() };
                    setDeliverables([...deliverables, newDeliv]);
                    setDelivForm({ name: '', description: '', deadline: '', status: 'pending', responsible: '', type: 'document' });
                    setShowDelivModal(false);
                    addNotification('success', 'Entrega Criada', 'Entregável adicionado ao projeto');
                };

                const filteredDeliverables = deliverables.filter(d => !activeProject || d.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Gestão de Entregas</h2>
                                <p className="text-sm text-gray-600">Controle de deliverables do projeto</p>
                            </div>
                            <button onClick={() => setShowDelivModal(true)} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2">
                                <i data-lucide="package" className="w-4 h-4"></i> Nova Entrega
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredDeliverables.map(deliv => (
                                <div key={deliv.id} className="bg-white rounded-lg p-6 shadow border-l-4" style={{borderLeftColor: deliv.status === 'completed' ? '#10B981' : deliv.status === 'in_progress' ? '#F59E0B' : '#6B7280'}}>
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <h3 className="font-bold text-lg">{deliv.name}</h3>
                                            <p className="text-sm text-gray-600 mt-1">{deliv.description}</p>
                                        </div>
                                        <span className={`px-3 py-1 rounded text-sm font-medium ${
                                            deliv.status === 'completed' ? 'bg-green-100 text-green-700' :
                                            deliv.status === 'in_progress' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-700'
                                        }`}>
                                            {deliv.status === 'completed' ? 'Entregue' : deliv.status === 'in_progress' ? 'Em Andamento' : 'Pendente'}
                                        </span>
                                    </div>
                                    <div className="flex items-center justify-between text-sm">
                                        <span className="text-gray-600">Responsável: {deliv.responsible}</span>
                                        <span className="text-gray-600">Prazo: {new Date(deliv.deadline).toLocaleDateString('pt-BR')}</span>
                                        <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">{deliv.type}</span>
                                    </div>
                                </div>
                            ))}
                            {filteredDeliverables.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="package" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhum entregável cadastrado</p>
                                </div>
                            )}
                        </div>

                        {showDelivModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Novo Entregável</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Nome da Entrega" className="w-full border rounded px-3 py-2" value={delivForm.name} onChange={(e) => setDelivForm({ ...delivForm, name: e.target.value })} />
                                        <textarea placeholder="Descrição" className="w-full border rounded px-3 py-2" rows="3" value={delivForm.description} onChange={(e) => setDelivForm({ ...delivForm, description: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input type="date" className="w-full border rounded px-3 py-2" value={delivForm.deadline} onChange={(e) => setDelivForm({ ...delivForm, deadline: e.target.value })} />
                                            <input placeholder="Responsável" className="w-full border rounded px-3 py-2" value={delivForm.responsible} onChange={(e) => setDelivForm({ ...delivForm, responsible: e.target.value })} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <select className="w-full border rounded px-3 py-2" value={delivForm.type} onChange={(e) => setDelivForm({ ...delivForm, type: e.target.value })}>
                                                <option value="document">Documento</option>
                                                <option value="software">Software</option>
                                                <option value="report">Relatório</option>
                                                <option value="presentation">Apresentação</option>
                                                <option value="other">Outro</option>
                                            </select>
                                            <select className="w-full border rounded px-3 py-2" value={delivForm.status} onChange={(e) => setDelivForm({ ...delivForm, status: e.target.value })}>
                                                <option value="pending">Pendente</option>
                                                <option value="in_progress">Em Andamento</option>
                                                <option value="completed">Entregue</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowDelivModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addDeliverable} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Criar Entrega</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo Gestão de Comunicações
            const CommunicationsModule = () => {
                const [commForm, setCommForm] = useState({ title: '', type: 'email', frequency: 'weekly', audience: '', channel: '', responsible: '' });
                const [showCommModal, setShowCommModal] = useState(false);

                const addCommunication = () => {
                    const newComm = { ...commForm, id: Date.now(), projectId: activeProject?.id };
                    setCommunications([...communications, newComm]);
                    setCommForm({ title: '', type: 'email', frequency: 'weekly', audience: '', channel: '', responsible: '' });
                    setShowCommModal(false);
                    addNotification('success', 'Comunicação Registrada', 'Plano de comunicação atualizado');
                };

                const filteredComms = communications.filter(c => !activeProject || c.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Gestão de Comunicações</h2>
                                <p className="text-sm text-gray-600">Plano de comunicação do projeto (PMBOK 7)</p>
                            </div>
                            <button onClick={() => setShowCommModal(true)} className="px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 flex items-center gap-2">
                                <i data-lucide="message-square" className="w-4 h-4"></i> Nova Comunicação
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredComms.map(comm => (
                                <div key={comm.id} className="bg-white rounded-lg p-6 shadow">
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="flex-1">
                                            <h3 className="font-bold text-lg">{comm.title}</h3>
                                            <div className="flex gap-3 mt-2">
                                                <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs">{comm.type}</span>
                                                <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs">{comm.frequency}</span>
                                                <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">{comm.channel}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 text-sm text-gray-600 mt-3">
                                        <div>Público: {comm.audience}</div>
                                        <div>Responsável: {comm.responsible}</div>
                                    </div>
                                </div>
                            ))}
                            {filteredComms.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="message-square" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhum plano de comunicação definido</p>
                                </div>
                            )}
                        </div>

                        {showCommModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Nova Comunicação</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Título/Assunto" className="w-full border rounded px-3 py-2" value={commForm.title} onChange={(e) => setCommForm({ ...commForm, title: e.target.value })} />
                                        <div className="grid grid-cols-3 gap-4">
                                            <select className="w-full border rounded px-3 py-2" value={commForm.type} onChange={(e) => setCommForm({ ...commForm, type: e.target.value })}>
                                                <option value="email">E-mail</option>
                                                <option value="meeting">Reunião</option>
                                                <option value="report">Relatório</option>
                                                <option value="presentation">Apresentação</option>
                                            </select>
                                            <select className="w-full border rounded px-3 py-2" value={commForm.frequency} onChange={(e) => setCommForm({ ...commForm, frequency: e.target.value })}>
                                                <option value="daily">Diária</option>
                                                <option value="weekly">Semanal</option>
                                                <option value="biweekly">Quinzenal</option>
                                                <option value="monthly">Mensal</option>
                                            </select>
                                            <input placeholder="Canal" className="w-full border rounded px-3 py-2" value={commForm.channel} onChange={(e) => setCommForm({ ...commForm, channel: e.target.value })} />
                                        </div>
                                        <input placeholder="Público-alvo" className="w-full border rounded px-3 py-2" value={commForm.audience} onChange={(e) => setCommForm({ ...commForm, audience: e.target.value })} />
                                        <input placeholder="Responsável" className="w-full border rounded px-3 py-2" value={commForm.responsible} onChange={(e) => setCommForm({ ...commForm, responsible: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowCommModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addCommunication} className="px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600">Salvar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo Project Charter
            const ProjectCharterModule = () => {
                const [charter, setCharter] = useState(() => {
                    const saved = localStorage.getItem('projectCharters');
                    return saved ? JSON.parse(saved) : [];
                });
                const [charterForm, setCharterForm] = useState({
                    projectName: '', purpose: '', objectives: '', scope: '', deliverables: '',
                    constraints: '', assumptions: '', budget: '', stakeholders: '', approver: ''
                });
                const [showCharterModal, setShowCharterModal] = useState(false);

                const addCharter = () => {
                    const newCharter = { ...charterForm, id: Date.now(), projectId: activeProject?.id, createdAt: new Date().toISOString() };
                    const updated = [...charter, newCharter];
                    setCharter(updated);
                    localStorage.setItem('projectCharters', JSON.stringify(updated));
                    setCharterForm({ projectName: '', purpose: '', objectives: '', scope: '', deliverables: '', constraints: '', assumptions: '', budget: '', stakeholders: '', approver: '' });
                    setShowCharterModal(false);
                    addNotification('success', 'Charter Criado', 'Termo de Abertura do Projeto criado');
                };

                const filteredCharters = charter.filter(c => !activeProject || c.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Project Charter</h2>
                                <p className="text-sm text-gray-600">Termo de Abertura do Projeto (PMBOK 7)</p>
                            </div>
                            <button onClick={() => setShowCharterModal(true)} className="px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600 flex items-center gap-2">
                                <i data-lucide="file-badge" className="w-4 h-4"></i> Novo Charter
                            </button>
                        </div>

                        {filteredCharters.length === 0 ? (
                            <div className="bg-white rounded-lg p-8 text-center">
                                <i data-lucide="file-badge" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                <p className="text-gray-500">Nenhum Project Charter criado</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {filteredCharters.map(ch => (
                                    <div key={ch.id} className="bg-white rounded-lg p-6 shadow">
                                        <h3 className="text-xl font-bold mb-4">{ch.projectName}</h3>
                                        <div className="grid gap-4">
                                            <div><strong>Propósito:</strong> <p className="text-gray-700">{ch.purpose}</p></div>
                                            <div><strong>Objetivos:</strong> <p className="text-gray-700">{ch.objectives}</p></div>
                                            <div><strong>Escopo:</strong> <p className="text-gray-700">{ch.scope}</p></div>
                                            <div><strong>Entregas Principais:</strong> <p className="text-gray-700">{ch.deliverables}</p></div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><strong>Orçamento:</strong> <p className="text-gray-700">{ch.budget}</p></div>
                                                <div><strong>Aprovador:</strong> <p className="text-gray-700">{ch.approver}</p></div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {showCharterModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
                                <div className="bg-white rounded-lg p-6 max-w-3xl w-full mx-4 my-8">
                                    <h3 className="text-xl font-bold mb-4">Criar Project Charter</h3>
                                    <div className="space-y-4 max-h-96 overflow-y-auto">
                                        <input placeholder="Nome do Projeto" className="w-full border rounded px-3 py-2" value={charterForm.projectName} onChange={(e) => setCharterForm({ ...charterForm, projectName: e.target.value })} />
                                        <textarea placeholder="Propósito do Projeto" className="w-full border rounded px-3 py-2" rows="2" value={charterForm.purpose} onChange={(e) => setCharterForm({ ...charterForm, purpose: e.target.value })} />
                                        <textarea placeholder="Objetivos" className="w-full border rounded px-3 py-2" rows="2" value={charterForm.objectives} onChange={(e) => setCharterForm({ ...charterForm, objectives: e.target.value })} />
                                        <textarea placeholder="Escopo" className="w-full border rounded px-3 py-2" rows="2" value={charterForm.scope} onChange={(e) => setCharterForm({ ...charterForm, scope: e.target.value })} />
                                        <textarea placeholder="Entregas Principais" className="w-full border rounded px-3 py-2" rows="2" value={charterForm.deliverables} onChange={(e) => setCharterForm({ ...charterForm, deliverables: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input placeholder="Orçamento Estimado" className="w-full border rounded px-3 py-2" value={charterForm.budget} onChange={(e) => setCharterForm({ ...charterForm, budget: e.target.value })} />
                                            <input placeholder="Aprovador/Patrocinador" className="w-full border rounded px-3 py-2" value={charterForm.approver} onChange={(e) => setCharterForm({ ...charterForm, approver: e.target.value })} />
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowCharterModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addCharter} className="px-4 py-2 bg-teal-500 text-white rounded hover:bg-teal-600">Criar Charter</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo ISO: Objetivos da Qualidade (ISO 6.2)
            const QualityObjectivesModule = () => {
                const [objForm, setObjForm] = useState({ objective: '', indicator: '', target: '', responsible: '', deadline: '', status: 'active' });
                const [showObjModal, setShowObjModal] = useState(false);

                const addObjective = () => {
                    const newObj = { ...objForm, id: Date.now(), projectId: activeProject?.id };
                    setQualityObjectives([...qualityObjectives, newObj]);
                    setObjForm({ objective: '', indicator: '', target: '', responsible: '', deadline: '', status: 'active' });
                    setShowObjModal(false);
                    addNotification('success', 'Objetivo Criado', 'Objetivo da qualidade registrado (ISO 6.2)');
                };

                const filteredObjectives = qualityObjectives.filter(o => !activeProject || o.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Objetivos da Qualidade</h2>
                                <p className="text-sm text-gray-600">ISO 9001:2015 - Cláusula 6.2</p>
                            </div>
                            <button onClick={() => setShowObjModal(true)} className="px-4 py-2 bg-emerald-500 text-white rounded hover:bg-emerald-600 flex items-center gap-2">
                                <i data-lucide="target" className="w-4 h-4"></i> Novo Objetivo
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredObjectives.map(obj => (
                                <div key={obj.id} className="bg-white rounded-lg p-6 shadow border-l-4 border-emerald-500">
                                    <div className="flex justify-between items-start mb-3">
                                        <h3 className="font-bold text-lg">{obj.objective}</h3>
                                        <span className={`px-2 py-1 rounded text-xs ${obj.status === 'achieved' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>
                                            {obj.status === 'achieved' ? 'Alcançado' : 'Ativo'}
                                        </span>
                                    </div>
                                    <div className="grid gap-2 text-sm">
                                        <div><strong>Indicador:</strong> {obj.indicator}</div>
                                        <div><strong>Meta:</strong> {obj.target}</div>
                                        <div><strong>Responsável:</strong> {obj.responsible}</div>
                                        <div><strong>Prazo:</strong> {new Date(obj.deadline).toLocaleDateString('pt-BR')}</div>
                                    </div>
                                </div>
                            ))}
                            {filteredObjectives.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="target" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhum objetivo da qualidade definido</p>
                                </div>
                            )}
                        </div>

                        {showObjModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Novo Objetivo da Qualidade</h3>
                                    <div className="space-y-4">
                                        <textarea placeholder="Objetivo" className="w-full border rounded px-3 py-2" rows="2" value={objForm.objective} onChange={(e) => setObjForm({ ...objForm, objective: e.target.value })} />
                                        <input placeholder="Indicador de Desempenho" className="w-full border rounded px-3 py-2" value={objForm.indicator} onChange={(e) => setObjForm({ ...objForm, indicator: e.target.value })} />
                                        <input placeholder="Meta" className="w-full border rounded px-3 py-2" value={objForm.target} onChange={(e) => setObjForm({ ...objForm, target: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input placeholder="Responsável" className="w-full border rounded px-3 py-2" value={objForm.responsible} onChange={(e) => setObjForm({ ...objForm, responsible: e.target.value })} />
                                            <input type="date" className="w-full border rounded px-3 py-2" value={objForm.deadline} onChange={(e) => setObjForm({ ...objForm, deadline: e.target.value })} />
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowObjModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addObjective} className="px-4 py-2 bg-emerald-500 text-white rounded hover:bg-emerald-600">Criar Objetivo</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo ISO: Controle de Mudanças (ISO 6.3)
            const ChangeControlModule = () => {
                const [changeForm, setChangeForm] = useState({ title: '', description: '', reason: '', impact: 'low', status: 'pending', requestedBy: '' });
                const [showChangeModal, setShowChangeModal] = useState(false);

                const addChange = () => {
                    const newChange = { ...changeForm, id: Date.now(), projectId: activeProject?.id, date: new Date().toISOString() };
                    setChanges([...changes, newChange]);
                    setChangeForm({ title: '', description: '', reason: '', impact: 'low', status: 'pending', requestedBy: '' });
                    setShowChangeModal(false);
                    addNotification('success', 'Mudança Registrada', 'Solicitação de mudança criada (ISO 6.3)');
                };

                const filteredChanges = changes.filter(c => !activeProject || c.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Controle de Mudanças</h2>
                                <p className="text-sm text-gray-600">ISO 9001:2015 - Cláusula 6.3</p>
                            </div>
                            <button onClick={() => setShowChangeModal(true)} className="px-4 py-2 bg-amber-500 text-white rounded hover:bg-amber-600 flex items-center gap-2">
                                <i data-lucide="git-branch" className="w-4 h-4"></i> Nova Mudança
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredChanges.map(change => (
                                <div key={change.id} className="bg-white rounded-lg p-6 shadow">
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="flex-1">
                                            <h3 className="font-bold text-lg">{change.title}</h3>
                                            <p className="text-sm text-gray-600 mt-1">{change.description}</p>
                                        </div>
                                        <div className="flex flex-col gap-1">
                                            <span className={`px-2 py-1 rounded text-xs text-center ${
                                                change.status === 'approved' ? 'bg-green-100 text-green-700' :
                                                change.status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'
                                            }`}>
                                                {change.status === 'approved' ? 'Aprovada' : change.status === 'rejected' ? 'Rejeitada' : 'Pendente'}
                                            </span>
                                            <span className={`px-2 py-1 rounded text-xs text-center ${
                                                change.impact === 'high' ? 'bg-red-100 text-red-700' :
                                                change.impact === 'medium' ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'
                                            }`}>
                                                Impacto: {change.impact === 'high' ? 'Alto' : change.impact === 'medium' ? 'Médio' : 'Baixo'}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="text-sm text-gray-600 mt-3">
                                        <div><strong>Razão:</strong> {change.reason}</div>
                                        <div><strong>Solicitado por:</strong> {change.requestedBy}</div>
                                        <div><strong>Data:</strong> {new Date(change.date).toLocaleDateString('pt-BR')}</div>
                                    </div>
                                </div>
                            ))}
                            {filteredChanges.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="git-branch" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhuma mudança registrada</p>
                                </div>
                            )}
                        </div>

                        {showChangeModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Solicitar Mudança</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Título da Mudança" className="w-full border rounded px-3 py-2" value={changeForm.title} onChange={(e) => setChangeForm({ ...changeForm, title: e.target.value })} />
                                        <textarea placeholder="Descrição" className="w-full border rounded px-3 py-2" rows="3" value={changeForm.description} onChange={(e) => setChangeForm({ ...changeForm, description: e.target.value })} />
                                        <textarea placeholder="Razão/Justificativa" className="w-full border rounded px-3 py-2" rows="2" value={changeForm.reason} onChange={(e) => setChangeForm({ ...changeForm, reason: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <select className="w-full border rounded px-3 py-2" value={changeForm.impact} onChange={(e) => setChangeForm({ ...changeForm, impact: e.target.value })}>
                                                <option value="low">Impacto Baixo</option>
                                                <option value="medium">Impacto Médio</option>
                                                <option value="high">Impacto Alto</option>
                                            </select>
                                            <input placeholder="Solicitado por" className="w-full border rounded px-3 py-2" value={changeForm.requestedBy} onChange={(e) => setChangeForm({ ...changeForm, requestedBy: e.target.value })} />
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowChangeModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addChange} className="px-4 py-2 bg-amber-500 text-white rounded hover:bg-amber-600">Registrar Mudança</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo ISO: Gestão de Fornecedores (ISO 8.4)
            const SuppliersModule = () => {
                const [suppForm, setSuppForm] = useState({ name: '', category: '', contact: '', email: '', evaluation: 'pending', performance: 5, notes: '' });
                const [showSuppModal, setShowSuppModal] = useState(false);

                const addSupplier = () => {
                    const newSupp = { ...suppForm, id: Date.now(), projectId: activeProject?.id, addedDate: new Date().toISOString() };
                    setSuppliers([...suppliers, newSupp]);
                    setSuppForm({ name: '', category: '', contact: '', email: '', evaluation: 'pending', performance: 5, notes: '' });
                    setShowSuppModal(false);
                    addNotification('success', 'Fornecedor Cadastrado', 'Fornecedor adicionado ao sistema (ISO 8.4)');
                };

                const filteredSuppliers = suppliers.filter(s => !activeProject || s.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Gestão de Fornecedores</h2>
                                <p className="text-sm text-gray-600">ISO 9001:2015 - Cláusula 8.4</p>
                            </div>
                            <button onClick={() => setShowSuppModal(true)} className="px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600 flex items-center gap-2">
                                <i data-lucide="truck" className="w-4 h-4"></i> Novo Fornecedor
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredSuppliers.map(supp => (
                                <div key={supp.id} className="bg-white rounded-lg p-6 shadow">
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="flex-1">
                                            <h3 className="font-bold text-lg">{supp.name}</h3>
                                            <p className="text-sm text-gray-600">{supp.category}</p>
                                        </div>
                                        <div className="flex flex-col gap-1">
                                            <span className={`px-2 py-1 rounded text-xs text-center ${
                                                supp.evaluation === 'approved' ? 'bg-green-100 text-green-700' :
                                                supp.evaluation === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'
                                            }`}>
                                                {supp.evaluation === 'approved' ? 'Aprovado' : supp.evaluation === 'rejected' ? 'Reprovado' : 'Pendente'}
                                            </span>
                                            <div className="flex items-center gap-1 text-xs">
                                                <i data-lucide="star" className="w-3 h-3 text-yellow-500"></i>
                                                <span>{supp.performance}/10</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3 text-sm text-gray-600">
                                        <div><strong>Contato:</strong> {supp.contact}</div>
                                        <div><strong>Email:</strong> {supp.email}</div>
                                    </div>
                                    {supp.notes && <p className="text-sm text-gray-600 mt-2"><strong>Observações:</strong> {supp.notes}</p>}
                                </div>
                            ))}
                            {filteredSuppliers.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="truck" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhum fornecedor cadastrado</p>
                                </div>
                            )}
                        </div>

                        {showSuppModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Cadastrar Fornecedor</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Nome do Fornecedor" className="w-full border rounded px-3 py-2" value={suppForm.name} onChange={(e) => setSuppForm({ ...suppForm, name: e.target.value })} />
                                        <input placeholder="Categoria/Serviço" className="w-full border rounded px-3 py-2" value={suppForm.category} onChange={(e) => setSuppForm({ ...suppForm, category: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input placeholder="Contato" className="w-full border rounded px-3 py-2" value={suppForm.contact} onChange={(e) => setSuppForm({ ...suppForm, contact: e.target.value })} />
                                            <input placeholder="Email" className="w-full border rounded px-3 py-2" value={suppForm.email} onChange={(e) => setSuppForm({ ...suppForm, email: e.target.value })} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <select className="w-full border rounded px-3 py-2" value={suppForm.evaluation} onChange={(e) => setSuppForm({ ...suppForm, evaluation: e.target.value })}>
                                                <option value="pending">Avaliação Pendente</option>
                                                <option value="approved">Aprovado</option>
                                                <option value="rejected">Reprovado</option>
                                            </select>
                                            <select className="w-full border rounded px-3 py-2" value={suppForm.performance} onChange={(e) => setSuppForm({ ...suppForm, performance: e.target.value })}>
                                                <option value="10">Desempenho: 10</option>
                                                <option value="9">Desempenho: 9</option>
                                                <option value="8">Desempenho: 8</option>
                                                <option value="7">Desempenho: 7</option>
                                                <option value="6">Desempenho: 6</option>
                                                <option value="5">Desempenho: 5</option>
                                                <option value="4">Desempenho: 4</option>
                                                <option value="3">Desempenho: 3</option>
                                                <option value="2">Desempenho: 2</option>
                                                <option value="1">Desempenho: 1</option>
                                            </select>
                                        </div>
                                        <textarea placeholder="Observações" className="w-full border rounded px-3 py-2" rows="2" value={suppForm.notes} onChange={(e) => setSuppForm({ ...suppForm, notes: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowSuppModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addSupplier} className="px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600">Cadastrar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo ISO: Auditorias Internas (ISO 9.2)
            const InternalAuditsModule = () => {
                const [auditForm, setAuditForm] = useState({ title: '', scope: '', auditor: '', date: '', findings: '', status: 'scheduled', type: 'internal' });
                const [showAuditModal, setShowAuditModal] = useState(false);

                const addAudit = () => {
                    const newAudit = { ...auditForm, id: Date.now(), projectId: activeProject?.id };
                    setAudits([...audits, newAudit]);
                    setAuditForm({ title: '', scope: '', auditor: '', date: '', findings: '', status: 'scheduled', type: 'internal' });
                    setShowAuditModal(false);
                    addNotification('success', 'Auditoria Criada', 'Auditoria registrada no sistema (ISO 9.2)');
                };

                const filteredAudits = audits.filter(a => !activeProject || a.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Auditorias Internas</h2>
                                <p className="text-sm text-gray-600">ISO 9001:2015 - Cláusula 9.2</p>
                            </div>
                            <button onClick={() => setShowAuditModal(true)} className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 flex items-center gap-2">
                                <i data-lucide="clipboard-check" className="w-4 h-4"></i> Nova Auditoria
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredAudits.map(audit => (
                                <div key={audit.id} className="bg-white rounded-lg p-6 shadow">
                                    <div className="flex justify-between items-start mb-3">
                                        <div className="flex-1">
                                            <h3 className="font-bold text-lg">{audit.title}</h3>
                                            <p className="text-sm text-gray-600 mt-1">{audit.scope}</p>
                                        </div>
                                        <div className="flex flex-col gap-1">
                                            <span className={`px-2 py-1 rounded text-xs text-center ${
                                                audit.status === 'completed' ? 'bg-green-100 text-green-700' :
                                                audit.status === 'in_progress' ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'
                                            }`}>
                                                {audit.status === 'completed' ? 'Concluída' : audit.status === 'in_progress' ? 'Em Andamento' : 'Agendada'}
                                            </span>
                                            <span className="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs text-center">
                                                {audit.type === 'internal' ? 'Interna' : 'Externa'}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="grid gap-2 text-sm text-gray-600">
                                        <div><strong>Auditor:</strong> {audit.auditor}</div>
                                        <div><strong>Data:</strong> {new Date(audit.date).toLocaleDateString('pt-BR')}</div>
                                        {audit.findings && <div><strong>Constatações:</strong> {audit.findings}</div>}
                                    </div>
                                </div>
                            ))}
                            {filteredAudits.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="clipboard-check" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhuma auditoria registrada</p>
                                </div>
                            )}
                        </div>

                        {showAuditModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Registrar Auditoria</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Título da Auditoria" className="w-full border rounded px-3 py-2" value={auditForm.title} onChange={(e) => setAuditForm({ ...auditForm, title: e.target.value })} />
                                        <textarea placeholder="Escopo" className="w-full border rounded px-3 py-2" rows="2" value={auditForm.scope} onChange={(e) => setAuditForm({ ...auditForm, scope: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input placeholder="Auditor" className="w-full border rounded px-3 py-2" value={auditForm.auditor} onChange={(e) => setAuditForm({ ...auditForm, auditor: e.target.value })} />
                                            <input type="date" className="w-full border rounded px-3 py-2" value={auditForm.date} onChange={(e) => setAuditForm({ ...auditForm, date: e.target.value })} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <select className="w-full border rounded px-3 py-2" value={auditForm.type} onChange={(e) => setAuditForm({ ...auditForm, type: e.target.value })}>
                                                <option value="internal">Auditoria Interna</option>
                                                <option value="external">Auditoria Externa</option>
                                            </select>
                                            <select className="w-full border rounded px-3 py-2" value={auditForm.status} onChange={(e) => setAuditForm({ ...auditForm, status: e.target.value })}>
                                                <option value="scheduled">Agendada</option>
                                                <option value="in_progress">Em Andamento</option>
                                                <option value="completed">Concluída</option>
                                            </select>
                                        </div>
                                        <textarea placeholder="Constatações/Achados" className="w-full border rounded px-3 py-2" rows="3" value={auditForm.findings} onChange={(e) => setAuditForm({ ...auditForm, findings: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowAuditModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addAudit} className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Registrar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo ISO: Análise Crítica pela Direção (ISO 9.3)
            const ManagementReviewModule = () => {
                const [reviewForm, setReviewForm] = useState({ title: '', date: '', participants: '', topics: '', decisions: '', actionItems: '', status: 'scheduled' });
                const [showReviewModal, setShowReviewModal] = useState(false);

                const addReview = () => {
                    const newReview = { ...reviewForm, id: Date.now(), projectId: activeProject?.id };
                    setManagementReviews([...managementReviews, newReview]);
                    setReviewForm({ title: '', date: '', participants: '', topics: '', decisions: '', actionItems: '', status: 'scheduled' });
                    setShowReviewModal(false);
                    addNotification('success', 'Análise Registrada', 'Análise crítica pela direção registrada (ISO 9.3)');
                };

                const filteredReviews = managementReviews.filter(r => !activeProject || r.projectId === activeProject.id);

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Análise Crítica pela Direção</h2>
                                <p className="text-sm text-gray-600">ISO 9001:2015 - Cláusula 9.3</p>
                            </div>
                            <button onClick={() => setShowReviewModal(true)} className="px-4 py-2 bg-violet-500 text-white rounded hover:bg-violet-600 flex items-center gap-2">
                                <i data-lucide="briefcase" className="w-4 h-4"></i> Nova Análise
                            </button>
                        </div>

                        <div className="grid gap-4">
                            {filteredReviews.map(review => (
                                <div key={review.id} className="bg-white rounded-lg p-6 shadow border-l-4 border-violet-500">
                                    <div className="flex justify-between items-start mb-3">
                                        <h3 className="font-bold text-lg">{review.title}</h3>
                                        <span className={`px-2 py-1 rounded text-xs ${review.status === 'completed' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>
                                            {review.status === 'completed' ? 'Realizada' : 'Agendada'}
                                        </span>
                                    </div>
                                    <div className="grid gap-3 text-sm">
                                        <div><strong>Data:</strong> {new Date(review.date).toLocaleDateString('pt-BR')}</div>
                                        <div><strong>Participantes:</strong> {review.participants}</div>
                                        <div><strong>Tópicos:</strong> <p className="text-gray-700 mt-1">{review.topics}</p></div>
                                        {review.decisions && <div><strong>Decisões:</strong> <p className="text-gray-700 mt-1">{review.decisions}</p></div>}
                                        {review.actionItems && <div><strong>Plano de Ação:</strong> <p className="text-gray-700 mt-1">{review.actionItems}</p></div>}
                                    </div>
                                </div>
                            ))}
                            {filteredReviews.length === 0 && (
                                <div className="bg-white rounded-lg p-8 text-center">
                                    <i data-lucide="briefcase" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                    <p className="text-gray-500">Nenhuma análise crítica registrada</p>
                                </div>
                            )}
                        </div>

                        {showReviewModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 my-8">
                                    <h3 className="text-xl font-bold mb-4">Registrar Análise Crítica</h3>
                                    <div className="space-y-4">
                                        <input placeholder="Título da Análise" className="w-full border rounded px-3 py-2" value={reviewForm.title} onChange={(e) => setReviewForm({ ...reviewForm, title: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input type="date" className="w-full border rounded px-3 py-2" value={reviewForm.date} onChange={(e) => setReviewForm({ ...reviewForm, date: e.target.value })} />
                                            <select className="w-full border rounded px-3 py-2" value={reviewForm.status} onChange={(e) => setReviewForm({ ...reviewForm, status: e.target.value })}>
                                                <option value="scheduled">Agendada</option>
                                                <option value="completed">Realizada</option>
                                            </select>
                                        </div>
                                        <input placeholder="Participantes (separados por vírgula)" className="w-full border rounded px-3 py-2" value={reviewForm.participants} onChange={(e) => setReviewForm({ ...reviewForm, participants: e.target.value })} />
                                        <textarea placeholder="Tópicos Abordados" className="w-full border rounded px-3 py-2" rows="2" value={reviewForm.topics} onChange={(e) => setReviewForm({ ...reviewForm, topics: e.target.value })} />
                                        <textarea placeholder="Decisões Tomadas" className="w-full border rounded px-3 py-2" rows="2" value={reviewForm.decisions} onChange={(e) => setReviewForm({ ...reviewForm, decisions: e.target.value })} />
                                        <textarea placeholder="Itens de Ação" className="w-full border rounded px-3 py-2" rows="2" value={reviewForm.actionItems} onChange={(e) => setReviewForm({ ...reviewForm, actionItems: e.target.value })} />
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowReviewModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addReview} className="px-4 py-2 bg-violet-500 text-white rounded hover:bg-violet-600">Registrar</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo Backup e Restore
            const BackupRestoreModule = () => {
                const exportData = () => {
                    const data = {
                        projects, tasks, risks, stakeholders, wbs, lessons, deliverables,
                        communications, changes, suppliers, audits, managementReviews, qualityObjectives,
                        exportDate: new Date().toISOString(),
                        version: '2.0'
                    };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `pmbok-backup-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    addNotification('success', 'Backup Criado', 'Dados exportados com sucesso!');
                };

                const importData = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const data = JSON.parse(event.target.result);
                                if (window.confirm('Isso irá substituir todos os dados atuais. Deseja continuar?')) {
                                    setProjects(data.projects || []);
                                    setTasks(data.tasks || []);
                                    setRisks(data.risks || []);
                                    setStakeholders(data.stakeholders || []);
                                    setWbs(data.wbs || []);
                                    setLessons(data.lessons || []);
                                    setDeliverables(data.deliverables || []);
                                    setCommunications(data.communications || []);
                                    setChanges(data.changes || []);
                                    setSuppliers(data.suppliers || []);
                                    setAudits(data.audits || []);
                                    setManagementReviews(data.managementReviews || []);
                                    setQualityObjectives(data.qualityObjectives || []);
                                    addNotification('success', 'Dados Restaurados', 'Backup importado com sucesso!');
                                }
                            } catch (error) {
                                addNotification('error', 'Erro', 'Arquivo de backup inválido');
                            }
                        };
                        reader.readAsText(file);
                    }
                };

                return (
                    <div className="p-6">
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold">Backup e Restore</h2>
                            <p className="text-sm text-gray-600">Exportar e importar dados do sistema</p>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-lg p-6 shadow">
                                <div className="flex items-center justify-center mb-4">
                                    <i data-lucide="download" className="w-16 h-16 text-blue-500"></i>
                                </div>
                                <h3 className="text-lg font-bold text-center mb-2">Exportar Dados</h3>
                                <p className="text-sm text-gray-600 text-center mb-4">
                                    Crie um backup completo de todos os dados do sistema
                                </p>
                                <button onClick={exportData} className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                                    Exportar Backup
                                </button>
                            </div>

                            <div className="bg-white rounded-lg p-6 shadow">
                                <div className="flex items-center justify-center mb-4">
                                    <i data-lucide="upload" className="w-16 h-16 text-green-500"></i>
                                </div>
                                <h3 className="text-lg font-bold text-center mb-2">Importar Dados</h3>
                                <p className="text-sm text-gray-600 text-center mb-4">
                                    Restaurar dados de um arquivo de backup
                                </p>
                                <input type="file" accept=".json" onChange={importData} className="hidden" id="import-file" />
                                <label htmlFor="import-file" className="block w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 text-center cursor-pointer">
                                    Selecionar Arquivo
                                </label>
                            </div>
                        </div>

                        <div className="mt-6 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                            <div className="flex">
                                <i data-lucide="alert-triangle" className="w-5 h-5 text-yellow-600 mr-2"></i>
                                <div className="text-sm">
                                    <p className="font-semibold text-yellow-800">Atenção</p>
                                    <p className="text-yellow-700">A importação de dados irá substituir todos os dados atuais do sistema. Faça um backup antes de importar.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Módulo IA: Análise Preditiva de Custos
            const CostPredictionModule = () => {
                const [costForm, setCostForm] = useState({ category: 'labor', description: '', amount: '', date: '', type: 'actual' });
                const [showCostModal, setShowCostModal] = useState(false);
                const [analyzing, setAnalyzing] = useState(false);
                const [showPrediction, setShowPrediction] = useState(false);

                const addCost = () => {
                    const newCost = { ...costForm, id: Date.now(), projectId: activeProject?.id, createdAt: new Date().toISOString() };
                    setCosts([...costs, newCost]);
                    setCostForm({ category: 'labor', description: '', amount: '', date: '', type: 'actual' });
                    setShowCostModal(false);
                    addNotification('success', 'Custo Registrado', 'Custo adicionado ao projeto');
                };

                const analyzeCostsWithAI = async () => {
                    if (!geminiApiKey) {
                        addNotification('error', 'IA não configurada', 'Configure a chave API do Gemini primeiro');
                        return;
                    }

                    if (filteredCosts.length < 3) {
                        addNotification('warning', 'Dados insuficientes', 'Registre pelo menos 3 custos para análise preditiva');
                        return;
                    }

                    setAnalyzing(true);

                    const totalActual = filteredCosts.filter(c => c.type === 'actual').reduce((sum, c) => sum + parseFloat(c.amount), 0);
                    const budget = activeProject?.budget || 0;
                    const costsByCategory = filteredCosts.reduce((acc, cost) => {
                        acc[cost.category] = (acc[cost.category] || 0) + parseFloat(cost.amount);
                        return acc;
                    }, {});

                    const prompt = `Você é um especialista em análise financeira de projetos PMBOK 7.

Dados do Projeto:
- Orçamento Total: R$ ${budget.toLocaleString('pt-BR')}
- Custos Registrados até agora: R$ ${totalActual.toLocaleString('pt-BR')}
- Percentual Consumido: ${((totalActual / budget) * 100).toFixed(1)}%

Custos por Categoria:
${Object.entries(costsByCategory).map(([cat, val]) => `- ${cat}: R$ ${val.toLocaleString('pt-BR')}`).join('\n')}

Histórico de Custos (últimos registros):
${filteredCosts.slice(-5).map(c => `${c.date}: ${c.category} - R$ ${parseFloat(c.amount).toLocaleString('pt-BR')} (${c.description})`).join('\n')}

Faça uma análise preditiva completa e retorne APENAS um JSON válido (sem markdown, sem texto adicional) com esta estrutura exata:
{
  "custoProjetado": número (custo total projetado até o fim do projeto),
  "risco": "baixo" | "médio" | "alto" | "crítico",
  "probabilidadeEstouro": número (0-100, probabilidade de estourar orçamento),
  "economiaOuEstouro": número (negativo = estouro, positivo = economia),
  "tendencias": ["tendência 1", "tendência 2", "tendência 3"],
  "recomendacoes": ["ação 1", "ação 2", "ação 3"],
  "alertas": ["alerta 1", "alerta 2"],
  "prevMensal": número (previsão de custo médio mensal),
  "categoriaRisco": "string (categoria com maior risco)"
}`;

                    const result = await callGeminiAPI(prompt);
                    setAnalyzing(false);

                    if (result) {
                        try {
                            // Limpar markdown se houver
                            let cleanResult = result.trim();
                            if (cleanResult.startsWith('```')) {
                                cleanResult = cleanResult.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                            }
                            const prediction = JSON.parse(cleanResult);
                            setCostPrediction(prediction);
                            setShowPrediction(true);
                            addNotification('success', 'Análise Concluída', 'Previsão de custos gerada com IA');
                        } catch (e) {
                            console.error('Erro ao parsear previsão:', e);
                            addNotification('error', 'Erro na análise', 'Não foi possível processar a resposta da IA');
                        }
                    }
                };

                const filteredCosts = costs.filter(c => !activeProject || c.projectId === activeProject.id);
                const totalActual = filteredCosts.filter(c => c.type === 'actual').reduce((sum, c) => sum + parseFloat(c.amount), 0);
                const totalPlanned = filteredCosts.filter(c => c.type === 'planned').reduce((sum, c) => sum + parseFloat(c.amount), 0);
                const budget = activeProject?.budget || 0;
                const consumed = budget > 0 ? ((totalActual / budget) * 100).toFixed(1) : 0;

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h2 className="text-2xl font-bold">Análise Preditiva de Custos com IA</h2>
                                <p className="text-sm text-gray-600">Previsão inteligente usando Gemini AI</p>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={analyzeCostsWithAI}
                                    disabled={analyzing || !geminiApiKey}
                                    className="px-4 py-2 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded hover:from-purple-600 hover:to-blue-600 flex items-center gap-2 disabled:opacity-50"
                                >
                                    {analyzing ? (
                                        <>
                                            <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                            Analisando...
                                        </>
                                    ) : (
                                        <>
                                            <i data-lucide="brain" className="w-4 h-4"></i>
                                            Analisar com IA
                                        </>
                                    )}
                                </button>
                                <button onClick={() => setShowCostModal(true)} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2">
                                    <i data-lucide="plus" className="w-4 h-4"></i> Novo Custo
                                </button>
                            </div>
                        </div>

                        {/* Resumo de Orçamento */}
                        <div className="grid md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-white rounded-lg p-6 shadow">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600">Orçamento Total</p>
                                        <p className="text-2xl font-bold text-blue-600">R$ {budget.toLocaleString('pt-BR')}</p>
                                    </div>
                                    <i data-lucide="wallet" className="w-10 h-10 text-blue-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg p-6 shadow">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600">Custos Reais</p>
                                        <p className="text-2xl font-bold text-orange-600">R$ {totalActual.toLocaleString('pt-BR')}</p>
                                    </div>
                                    <i data-lucide="trending-up" className="w-10 h-10 text-orange-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg p-6 shadow">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600">Saldo Restante</p>
                                        <p className={`text-2xl font-bold ${budget - totalActual < 0 ? 'text-red-600' : 'text-green-600'}`}>
                                            R$ {(budget - totalActual).toLocaleString('pt-BR')}
                                        </p>
                                    </div>
                                    <i data-lucide="dollar-sign" className="w-10 h-10 text-green-500"></i>
                                </div>
                            </div>
                            <div className="bg-white rounded-lg p-6 shadow">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600">% Consumido</p>
                                        <p className={`text-2xl font-bold ${consumed > 90 ? 'text-red-600' : consumed > 70 ? 'text-orange-600' : 'text-green-600'}`}>
                                            {consumed}%
                                        </p>
                                    </div>
                                    <i data-lucide="pie-chart" className="w-10 h-10 text-purple-500"></i>
                                </div>
                            </div>
                        </div>

                        {/* Previsão da IA */}
                        {showPrediction && costPrediction && (
                            <div className="bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 rounded-lg p-6 mb-6">
                                <div className="flex items-start gap-4">
                                    <div className="flex-shrink-0">
                                        <div className="w-16 h-16 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                                            <i data-lucide="sparkles" className="w-8 h-8 text-white"></i>
                                        </div>
                                    </div>
                                    <div className="flex-1">
                                        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                            <span>Previsão Inteligente</span>
                                            <span className={`px-3 py-1 rounded text-sm ${
                                                costPrediction.risco === 'crítico' ? 'bg-red-100 text-red-700' :
                                                costPrediction.risco === 'alto' ? 'bg-orange-100 text-orange-700' :
                                                costPrediction.risco === 'médio' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'
                                            }`}>
                                                Risco: {costPrediction.risco.toUpperCase()}
                                            </span>
                                        </h3>

                                        <div className="grid md:grid-cols-3 gap-4 mb-4">
                                            <div className="bg-white rounded p-4 shadow-sm">
                                                <p className="text-sm text-gray-600 mb-1">Custo Projetado</p>
                                                <p className="text-xl font-bold text-purple-600">R$ {costPrediction.custoProjetado?.toLocaleString('pt-BR')}</p>
                                            </div>
                                            <div className="bg-white rounded p-4 shadow-sm">
                                                <p className="text-sm text-gray-600 mb-1">Prob. de Estouro</p>
                                                <p className="text-xl font-bold text-orange-600">{costPrediction.probabilidadeEstouro}%</p>
                                            </div>
                                            <div className="bg-white rounded p-4 shadow-sm">
                                                <p className="text-sm text-gray-600 mb-1">{costPrediction.economiaOuEstouro >= 0 ? 'Economia' : 'Estouro'}</p>
                                                <p className={`text-xl font-bold ${costPrediction.economiaOuEstouro >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                    R$ {Math.abs(costPrediction.economiaOuEstouro)?.toLocaleString('pt-BR')}
                                                </p>
                                            </div>
                                        </div>

                                        {costPrediction.alertas && costPrediction.alertas.length > 0 && (
                                            <div className="bg-red-50 border-l-4 border-red-400 p-4 mb-4">
                                                <h4 className="font-bold text-red-800 mb-2 flex items-center gap-2">
                                                    <i data-lucide="alert-triangle" className="w-5 h-5"></i>
                                                    Alertas
                                                </h4>
                                                <ul className="text-sm text-red-700 space-y-1">
                                                    {costPrediction.alertas.map((alerta, i) => (
                                                        <li key={i}>⚠️ {alerta}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}

                                        <div className="grid md:grid-cols-2 gap-4">
                                            <div>
                                                <h4 className="font-bold mb-2 flex items-center gap-2">
                                                    <i data-lucide="trending-up" className="w-4 h-4"></i>
                                                    Tendências Identificadas
                                                </h4>
                                                <ul className="text-sm space-y-1">
                                                    {costPrediction.tendencias?.map((t, i) => (
                                                        <li key={i} className="flex items-start gap-2">
                                                            <span className="text-blue-500">📊</span>
                                                            <span>{t}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                            <div>
                                                <h4 className="font-bold mb-2 flex items-center gap-2">
                                                    <i data-lucide="lightbulb" className="w-4 h-4"></i>
                                                    Recomendações
                                                </h4>
                                                <ul className="text-sm space-y-1">
                                                    {costPrediction.recomendacoes?.map((r, i) => (
                                                        <li key={i} className="flex items-start gap-2">
                                                            <span className="text-green-500">✓</span>
                                                            <span>{r}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Lista de Custos */}
                        <div className="bg-white rounded-lg p-6 shadow">
                            <h3 className="font-bold text-lg mb-4">Histórico de Custos</h3>
                            <div className="space-y-3">
                                {filteredCosts.length === 0 ? (
                                    <div className="text-center py-8">
                                        <i data-lucide="inbox" className="w-16 h-16 mx-auto mb-4 text-gray-300"></i>
                                        <p className="text-gray-500">Nenhum custo registrado</p>
                                    </div>
                                ) : (
                                    filteredCosts.map(cost => (
                                        <div key={cost.id} className="flex items-center justify-between p-4 border rounded hover:bg-gray-50">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-3 mb-1">
                                                    <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                        cost.type === 'actual' ? 'bg-orange-100 text-orange-700' : 'bg-blue-100 text-blue-700'
                                                    }`}>
                                                        {cost.type === 'actual' ? 'Real' : 'Planejado'}
                                                    </span>
                                                    <span className="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs font-medium">
                                                        {cost.category}
                                                    </span>
                                                    <span className="text-sm text-gray-600">{new Date(cost.date).toLocaleDateString('pt-BR')}</span>
                                                </div>
                                                <p className="text-sm text-gray-700">{cost.description}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-xl font-bold text-gray-900">R$ {parseFloat(cost.amount).toLocaleString('pt-BR')}</p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        {/* Modal Adicionar Custo */}
                        {showCostModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-2xl w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Registrar Custo</h3>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <select className="w-full border rounded px-3 py-2" value={costForm.category} onChange={(e) => setCostForm({ ...costForm, category: e.target.value })}>
                                                <option value="labor">Mão de Obra</option>
                                                <option value="materials">Materiais</option>
                                                <option value="equipment">Equipamentos</option>
                                                <option value="services">Serviços</option>
                                                <option value="travel">Viagens</option>
                                                <option value="other">Outros</option>
                                            </select>
                                            <select className="w-full border rounded px-3 py-2" value={costForm.type} onChange={(e) => setCostForm({ ...costForm, type: e.target.value })}>
                                                <option value="actual">Custo Real</option>
                                                <option value="planned">Custo Planejado</option>
                                            </select>
                                        </div>
                                        <input placeholder="Descrição do custo" className="w-full border rounded px-3 py-2" value={costForm.description} onChange={(e) => setCostForm({ ...costForm, description: e.target.value })} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input type="number" placeholder="Valor (R$)" className="w-full border rounded px-3 py-2" value={costForm.amount} onChange={(e) => setCostForm({ ...costForm, amount: e.target.value })} />
                                            <input type="date" className="w-full border rounded px-3 py-2" value={costForm.date} onChange={(e) => setCostForm({ ...costForm, date: e.target.value })} />
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-6">
                                        <button onClick={() => setShowCostModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">Cancelar</button>
                                        <button onClick={addCost} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Registrar Custo</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Módulo de Configuração de IA
            const AISettingsModule = () => {
                const [apiKeyInput, setApiKeyInput] = useState(geminiApiKey);
                const [showKey, setShowKey] = useState(false);

                const saveApiKey = () => {
                    setGeminiApiKey(apiKeyInput);
                    addNotification('success', 'Chave Salva', 'Chave API do Gemini configurada com sucesso!');
                };

                const testConnection = async () => {
                    if (!apiKeyInput) {
                        addNotification('error', 'Erro', 'Digite uma chave API primeiro');
                        return;
                    }

                    addNotification('info', 'Testando', 'Testando conexão com Gemini AI...');
                    setAiLoading(true);

                    const tempKey = geminiApiKey;
                    setGeminiApiKey(apiKeyInput);

                    const result = await chatWithAI('Olá, você está funcionando?');

                    if (result) {
                        addNotification('success', 'Sucesso!', 'Conexão com Gemini AI estabelecida!');
                    } else {
                        setGeminiApiKey(tempKey);
                    }

                    setAiLoading(false);
                };

                return (
                    <div className="p-6">
                        <div className="mb-6">
                            <h2 className="text-2xl font-bold">Configurações de IA</h2>
                            <p className="text-sm text-gray-600">Configure a integração com Google Gemini AI</p>
                        </div>

                        <div className="bg-white rounded-lg shadow p-6 max-w-2xl">
                            <div className="mb-6">
                                <div className="flex items-start gap-3 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                                    <i data-lucide="info" className="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"></i>
                                    <div className="text-sm">
                                        <p className="font-semibold mb-2">Como obter sua chave API do Gemini (Gratuita):</p>
                                        <ol className="list-decimal ml-4 space-y-1">
                                            <li>Acesse <a href="https://ai.google.dev/" target="_blank" className="text-blue-600 underline">https://ai.google.dev/</a></li>
                                            <li>Clique em "Get API Key" ou "Get Started"</li>
                                            <li>Faça login com sua conta Google</li>
                                            <li>Crie um novo projeto (ou use um existente)</li>
                                            <li>Copie a chave API gerada</li>
                                            <li>Cole a chave abaixo</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Chave API do Google Gemini</label>
                                    <div className="flex gap-2">
                                        <input
                                            type={showKey ? "text" : "password"}
                                            className="flex-1 border rounded px-3 py-2 font-mono text-sm"
                                            value={apiKeyInput}
                                            onChange={(e) => setApiKeyInput(e.target.value)}
                                            placeholder="AIza..."
                                        />
                                        <button
                                            onClick={() => setShowKey(!showKey)}
                                            className="px-3 py-2 border rounded hover:bg-gray-50"
                                        >
                                            <i data-lucide={showKey ? "eye-off" : "eye"} className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>

                                <div className="flex gap-2">
                                    <button
                                        onClick={saveApiKey}
                                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2"
                                    >
                                        <i data-lucide="save" className="w-4 h-4"></i>
                                        Salvar Chave
                                    </button>
                                    <button
                                        onClick={testConnection}
                                        disabled={aiLoading || !apiKeyInput}
                                        className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                                    >
                                        {aiLoading ? (
                                            <>
                                                <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                Testando...
                                            </>
                                        ) : (
                                            <>
                                                <i data-lucide="zap" className="w-4 h-4"></i>
                                                Testar Conexão
                                            </>
                                        )}
                                    </button>
                                </div>

                                {geminiApiKey && (
                                    <div className="p-3 bg-green-50 border-l-4 border-green-500 rounded">
                                        <div className="flex items-center gap-2">
                                            <i data-lucide="check-circle" className="w-4 h-4 text-green-600"></i>
                                            <span className="text-sm text-green-800">Chave API configurada e salva</span>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="mt-8 pt-6 border-t">
                                <h3 className="font-semibold mb-3">Recursos de IA Disponíveis:</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="flex items-start gap-2 text-sm">
                                        <i data-lucide="sparkles" className="w-4 h-4 text-purple-500 mt-0.5"></i>
                                        <span>Análise automática de riscos</span>
                                    </div>
                                    <div className="flex items-start gap-2 text-sm">
                                        <i data-lucide="file-text" className="w-4 h-4 text-blue-500 mt-0.5"></i>
                                        <span>Geração de política da qualidade</span>
                                    </div>
                                    <div className="flex items-start gap-2 text-sm">
                                        <i data-lucide="alert-triangle" className="w-4 h-4 text-red-500 mt-0.5"></i>
                                        <span>Análise de não conformidades</span>
                                    </div>
                                    <div className="flex items-start gap-2 text-sm">
                                        <i data-lucide="message-circle" className="w-4 h-4 text-green-500 mt-0.5"></i>
                                        <span>Chat assistente PMBOK/ISO</span>
                                    </div>
                                </div>
                            </div>

                            <div className="mt-6 p-4 bg-gray-50 rounded text-xs text-gray-600">
                                <p className="font-semibold mb-1">Privacidade e Segurança:</p>
                                <ul className="list-disc ml-4 space-y-0.5">
                                    <li>Sua chave API é armazenada apenas localmente no seu navegador</li>
                                    <li>Nenhum dado é enviado para servidores terceiros além da API do Google</li>
                                    <li>Você pode remover a chave a qualquer momento limpando o localStorage</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                );
            };

            // Componente de Chat com IA
            const AIAssistant = () => {
                const [messages, setMessages] = useState([]);
                const [inputMessage, setInputMessage] = useState('');
                const chatEndRef = useRef(null);

                const scrollToBottom = () => {
                    chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
                };

                useEffect(scrollToBottom, [messages]);

                const sendMessage = async () => {
                    if (!inputMessage.trim()) return;
                    if (!geminiApiKey) {
                        addNotification('error', 'API Key Ausente', 'Configure a chave API nas configurações de IA');
                        return;
                    }

                    const userMsg = { role: 'user', content: inputMessage, timestamp: new Date() };
                    setMessages([...messages, userMsg]);
                    setInputMessage('');

                    const response = await chatWithAI(inputMessage);

                    if (response) {
                        const aiMsg = { role: 'assistant', content: response, timestamp: new Date() };
                        setMessages(prev => [...prev, aiMsg]);
                    }
                };

                const quickActions = [
                    { label: 'Explicar PMBOK 7', prompt: 'Explique brevemente o PMBOK 7 e seus princípios' },
                    { label: 'Dicas ISO 9001', prompt: 'Quais são as principais dicas para implementar ISO 9001?' },
                    { label: 'Gestão de Riscos', prompt: 'Como fazer uma boa gestão de riscos em projetos?' },
                    { label: 'Stakeholders', prompt: 'Como gerenciar stakeholders efetivamente?' }
                ];

                const handleQuickAction = (prompt) => {
                    setInputMessage(prompt);
                };

                if (!showAiChat) return null;

                return (
                    <div className="fixed bottom-4 right-4 w-96 h-[500px] bg-white rounded-lg shadow-2xl flex flex-col z-50">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4 rounded-t-lg flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <i data-lucide="bot" className="w-5 h-5"></i>
                                <div>
                                    <h3 className="font-semibold">Assistente IA</h3>
                                    <p className="text-xs opacity-90">PMBOK 7 & ISO 9001</p>
                                </div>
                            </div>
                            <button onClick={() => setShowAiChat(false)} className="hover:bg-white/20 p-1 rounded">
                                <i data-lucide="x" className="w-5 h-5"></i>
                            </button>
                        </div>

                        {/* Messages */}
                        <div className="flex-1 overflow-y-auto p-4 space-y-3">
                            {messages.length === 0 ? (
                                <div className="text-center py-8">
                                    <i data-lucide="sparkles" className="w-12 h-12 mx-auto mb-3 text-purple-300"></i>
                                    <p className="text-sm text-gray-600 mb-4">Olá! Como posso ajudar com seu projeto?</p>
                                    <div className="space-y-2">
                                        {quickActions.map((action, idx) => (
                                            <button
                                                key={idx}
                                                onClick={() => handleQuickAction(action.prompt)}
                                                className="block w-full text-left px-3 py-2 text-sm bg-gray-50 hover:bg-gray-100 rounded"
                                            >
                                                {action.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            ) : (
                                messages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[80%] rounded-lg px-3 py-2 ${msg.role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-800'}`}>
                                            <p className="text-sm whitespace-pre-wrap">{msg.content}</p>
                                            <p className="text-xs opacity-70 mt-1">{new Date(msg.timestamp).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</p>
                                        </div>
                                    </div>
                                ))
                            )}
                            {aiLoading && (
                                <div className="flex justify-start">
                                    <div className="bg-gray-100 rounded-lg px-3 py-2">
                                        <div className="flex gap-1">
                                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={chatEndRef} />
                        </div>

                        {/* Input */}
                        <div className="border-t p-3">
                            {!geminiApiKey && (
                                <div className="mb-2 p-2 bg-yellow-50 border-l-2 border-yellow-400 text-xs text-yellow-800">
                                    Configure a chave API nas configurações primeiro
                                </div>
                            )}
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    className="flex-1 border rounded px-3 py-2 text-sm"
                                    placeholder="Digite sua pergunta..."
                                    value={inputMessage}
                                    onChange={(e) => setInputMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                    disabled={aiLoading || !geminiApiKey}
                                />
                                <button
                                    onClick={sendMessage}
                                    disabled={aiLoading || !geminiApiKey || !inputMessage.trim()}
                                    className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <i data-lucide="send" className="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Layout Principal
            const MainLayout = () => {
                const handleLogout = () => {
                    setCurrentUser(null);
                    setIsLoggedIn(false);
                    setShowLogin(true);
                    localStorage.removeItem('pmbok_currentUser');
                    addNotification('info', 'Logout', 'Você saiu do sistema');
                };

                const menuItems = [
                    { id: 'dashboard', name: t('dashboard'), icon: 'layout-dashboard' },
                    { id: 'projects', name: t('projects'), icon: 'folder' },
                    { id: 'divider-pmbok', name: '─── PMBOK 7 ───', icon: null, disabled: true },
                    { id: 'project-charter', name: 'Project Charter', icon: 'file-badge' },
                    { id: 'tasks', name: 'Tarefas Kanban', icon: 'check-square' },
                    { id: 'wbs', name: 'WBS', icon: 'network' },
                    { id: 'deliverables', name: 'Entregas', icon: 'package' },
                    { id: 'communications', name: 'Comunicações', icon: 'message-square' },
                    { id: 'lessons-learned', name: 'Lições Aprendidas', icon: 'lightbulb' },
                    { id: 'risks', name: 'Riscos', icon: 'alert-triangle' },
                    { id: 'stakeholders', name: 'Stakeholders', icon: 'users' },
                    { id: 'reports', name: 'Relatórios', icon: 'file-text' },
                    { id: 'divider-iso', name: '─── ISO 9001 ───', icon: null, disabled: true },
                    { id: 'quality-policy', name: 'Política Qualidade', icon: 'shield-check' },
                    { id: 'quality-objectives', name: 'Objetivos Qualidade', icon: 'target' },
                    { id: 'non-conformities', name: 'Não Conformidades', icon: 'alert-octagon' },
                    { id: 'change-control', name: 'Controle Mudanças', icon: 'git-branch' },
                    { id: 'suppliers', name: 'Fornecedores', icon: 'truck' },
                    { id: 'audits', name: 'Auditorias', icon: 'clipboard-check' },
                    { id: 'management-review', name: 'Análise Direção', icon: 'briefcase' },
                    { id: 'divider-system', name: '─── Sistema ───', icon: null, disabled: true },
                    { id: 'backup-restore', name: 'Backup/Restore', icon: 'database' },
                    { id: 'divider-ai', name: '─── Inteligência Artificial ───', icon: null, disabled: true },
                    { id: 'cost-prediction', name: 'Análise Preditiva Custos', icon: 'trending-up' },
                    { id: 'ai-settings', name: 'Configurar IA', icon: 'brain' },
                    { id: 'settings', name: t('settings'), icon: 'settings' }
                ];

                return (
                    <div className={`min-h-screen ${darkMode ? 'dark bg-gray-900' : 'bg-gray-50'}`}>
                        {/* Header */}
                        <header className="bg-white shadow-sm border-b">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex justify-between items-center h-16">
                                    <div className="flex items-center">
                                        <h1 className="text-xl font-bold">PMBOK 7 Manager Pro</h1>
                                        <select
                                            className="ml-4 border rounded px-2 py-1"
                                            value={activeProject?.id || ''}
                                            onChange={(e) => {
                                                const project = projects.find(p => p.id === parseInt(e.target.value));
                                                setActiveProject(project);
                                            }}
                                        >
                                            <option value="">Selecione um projeto</option>
                                            {projects
                                                .filter(p => !currentUser || p.userId === currentUser.id)
                                                .map(project => (
                                                    <option key={project.id} value={project.id}>{project.name}</option>
                                                ))}
                                        </select>
                                        <button
                                            onClick={() => setShowModal('project')}
                                            className="ml-2 px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600"
                                        >
                                            <i data-lucide="plus" className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <button
                                            onClick={() => setDarkMode(!darkMode)}
                                            className="p-2 rounded hover:bg-gray-100"
                                        >
                                            <i data-lucide={darkMode ? 'sun' : 'moon'} className="w-5 h-5"></i>
                                        </button>
                                        <button
                                            onClick={() => setLanguage(language === 'pt' ? 'en' : 'pt')}
                                            className="px-3 py-1 border rounded text-sm"
                                        >
                                            {language === 'pt' ? 'EN' : 'PT'}
                                        </button>
                                        <div className="flex items-center gap-2">
                                            <span className="text-sm">{currentUser?.name}</span>
                                            <button
                                                onClick={handleLogout}
                                                className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600"
                                            >
                                                {t('logout')}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="flex">
                            {/* Sidebar */}
                            <div className="w-64 bg-white shadow-md h-screen">
                                <nav className="p-4">
                                    <ul className="space-y-2">
                                        {menuItems.map(item => (
                                            <li key={item.id}>
                                                {item.disabled ? (
                                                    <div className="px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">
                                                        {item.name}
                                                    </div>
                                                ) : (
                                                    <button
                                                        onClick={() => setActiveView(item.id)}
                                                        className={`w-full text-left px-3 py-2 rounded flex items-center gap-3 ${
                                                            activeView === item.id
                                                                ? 'bg-blue-50 text-blue-600'
                                                                : 'text-gray-700 hover:bg-gray-50'
                                                        }`}
                                                    >
                                                        {item.icon && <i data-lucide={item.icon} className="w-4 h-4"></i>}
                                                        {item.name}
                                                    </button>
                                                )}
                                            </li>
                                        ))}
                                    </ul>
                                </nav>
                            </div>

                            {/* Main Content */}
                            <div className="flex-1 p-6">
                                {activeView === 'dashboard' && <Dashboard />}
                                {activeView === 'projects' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">{t('projects')}</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {projects
                                                .filter(p => !currentUser || p.userId === currentUser.id)
                                                .map(project => (
                                                    <div key={project.id} className="border rounded-lg p-4 hover:shadow-lg transition-shadow">
                                                        <h3 className="font-semibold">{project.name}</h3>
                                                        <p className="text-sm text-gray-600 mt-1">{project.description}</p>
                                                        <div className="mt-3 flex justify-between items-center">
                                                            <span className={`px-2 py-1 text-xs rounded ${
                                                                project.status === 'active' ? 'bg-green-100 text-green-800' :
                                                                project.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                                                project.status === 'on-hold' ? 'bg-yellow-100 text-yellow-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`}>
                                                                {project.status}
                                                            </span>
                                                            <button
                                                                onClick={() => setActiveProject(project)}
                                                                className="text-blue-500 hover:underline text-sm"
                                                            >
                                                                Abrir
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                        </div>
                                    </div>
                                )}
                                {activeView === 'settings' && (
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h2 className="text-2xl font-bold mb-4">{t('settings')}</h2>
                                        <div className="space-y-4">
                                            <div>
                                                <h3 className="font-semibold mb-2">Perfil do Usuário</h3>
                                                <p>Nome: {currentUser?.name}</p>
                                                <p>Email: {currentUser?.email}</p>
                                                <p>Empresa: {currentUser?.company}</p>
                                                <p>Cargo: {currentUser?.role}</p>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Preferências</h3>
                                                <label className="flex items-center gap-2">
                                                    <input
                                                        type="checkbox"
                                                        checked={darkMode}
                                                        onChange={(e) => setDarkMode(e.target.checked)}
                                                    />
                                                    Modo Escuro
                                                </label>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-2">Idioma</h3>
                                                <select
                                                    value={language}
                                                    onChange={(e) => setLanguage(e.target.value)}
                                                    className="border rounded px-3 py-2"
                                                >
                                                    <option value="pt">Português</option>
                                                    <option value="en">English</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {activeView === 'tasks' && <TasksKanban />}
                                {activeView === 'wbs' && <WBSModule />}
                                {activeView === 'lessons-learned' && <LessonsLearnedModule />}
                                {activeView === 'deliverables' && <DeliverablesModule />}
                                {activeView === 'communications' && <CommunicationsModule />}
                                {activeView === 'project-charter' && <ProjectCharterModule />}
                                {activeView === 'risks' && <RisksManager />}
                                {activeView === 'stakeholders' && <StakeholdersManager />}
                                {activeView === 'reports' && <ReportsModule />}
                                {activeView === 'quality-policy' && <QualityPolicyModule />}
                                {activeView === 'quality-objectives' && <QualityObjectivesModule />}
                                {activeView === 'change-control' && <ChangeControlModule />}
                                {activeView === 'non-conformities' && <NonConformitiesModule />}
                                {activeView === 'suppliers' && <SuppliersModule />}
                                {activeView === 'audits' && <InternalAuditsModule />}
                                {activeView === 'management-review' && <ManagementReviewModule />}
                                {activeView === 'backup-restore' && <BackupRestoreModule />}
                                {activeView === 'cost-prediction' && <CostPredictionModule />}
                                {activeView === 'ai-settings' && <AISettingsModule />}
                            </div>
                        </div>

                        {/* AI Assistant Floating Button */}
                        {geminiApiKey && (
                            <button
                                onClick={() => setShowAiChat(!showAiChat)}
                                className="fixed bottom-4 right-4 w-14 h-14 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-full shadow-lg hover:shadow-xl transition-all hover:scale-110 flex items-center justify-center z-40"
                                title="Assistente IA"
                            >
                                <i data-lucide="bot" className="w-6 h-6"></i>
                            </button>
                        )}

                        {/* AI Chat Window */}
                        <AIAssistant />

                        {/* Modals */}
                        {showModal === 'project' && (
                            <ProjectModal
                                project={editingItem}
                                onSave={(project) => {
                                    if (editingItem) {
                                        setProjects(projects.map(p => p.id === project.id ? project : p));
                                    } else {
                                        setProjects([...projects, project]);
                                        setActiveProject(project);
                                    }
                                    setShowModal(null);
                                    setEditingItem(null);
                                    addNotification('success', 'Sucesso', 'Projeto salvo com sucesso!');
                                }}
                                onClose={() => {
                                    setShowModal(null);
                                    setEditingItem(null);
                                }}
                            />
                        )}
                    </div>
                );
            };

            // Renderização principal
            if (showLogin && !isLoggedIn) {
                return (
                    <>
                        <LoginSystem />
                        <NotificationSystem />
                    </>
                );
            }

            return (
                <>
                    <MainLayout />
                    <NotificationSystem />
                </>
            );
        };

        // Renderizar aplicação
        ReactDOM.createRoot(document.getElementById('root')).render(<PMBOKManagerPro />);
        
        // Inicializar ícones
        setTimeout(() => {
            lucide.createIcons();
        }, 100);
    </script>
</body>
</html>
